(function($,undef){"use strict";var debug=false;window.FileUpload_Debug=function(){if(debug&&console.log)if($.browser.msie){var output="Log: ";$.each(arguments,function(){output+=this});console.log(output)}else console.log.apply(console,arguments)};window.FileUpload_ToJSONIfPossible=function(responseText){if(responseText)try{return $.parseJSON(responseText)}catch(e){window.FileUpload_Debug(e)}return responseText}})(jQuery,"undefined");(function($,undef,debug){"use strict";var default_options={chunkEndpoint:"",finalEndpoint:"",beforeFinalSend:function(){},multipartEndpoint:"",completeRetries:300,defaultDataType:"json",defaultContentType:"application/x-www-form-urlencoded; charset=UTF-8",numberOfSimultaneousFileUploads:2,serializeFormData:true,chunkSize:5242880,maxFileSize:4294967296,runtimes:["HTMLRuntime","FlashRuntime","FrameRuntime"],autoUpload:false,deleteOnFailure:false,flashPath:"../swf/",ajaxLoader:"../img/ajax-loader.gif",fileLoading:"Loading file",fileComplete:"Complete",fileSize:"File too large"};function assert(expr,exception){if(expr)throw exception}function FileUpload(element,options){assert(element.nodeName.toLowerCase()!=="form","Invalid element, expected form nodeName");this.options=$.extend({},default_options,options||{});this.element=$(element);this.runtime=this.createRuntime();assert(!this.runtime,"No runtime supported");if(this.options.layout){this.element.addClass("layout-"+this.options.layout.toLowerCase());this.layout=new FileUpload.Layout[this.options.layout](this);this.layout.create()}this.runtime.create(this)}FileUpload.defaultOptions=default_options;FileUpload.hasSupport=function(runtimes){try{return new FileUpload(document.createElement("form"),{runtimes:runtimes||["HTMLRuntime","FlashRuntime"]})!==null}catch(e){return false}};FileUpload.formatBytes=function(bytes){var output=bytes/1024;if(output<1024)return output.toFixed(2)+"KB";output=output/1024;if(output<1024)return output.toFixed(2)+"MB";return(output/1024).toFixed(2)+"GB"};FileUpload.prototype.createRuntime=function(){var runtimeIndex,runtimes=this.options.runtimes;for(runtimeIndex=0;runtimeIndex<runtimes.length;runtimeIndex++){var runtimeName=runtimes[runtimeIndex];var Runtime=FileUpload.Runtime[runtimeName];if(Runtime.supports()){this.runtimeName=runtimeName;return new Runtime(this)}}return null};FileUpload.prototype.triggerEvent=function(eventName){if($.isFunction(this.options[eventName]))this.options[eventName].apply(this,$.makeArray(arguments).slice(1));this.element.trigger("FileUpload_"+eventName,$.makeArray(arguments).slice(1))};FileUpload.prototype.on=function(eventName,handler){var eventNames=$.map(eventName.split(" "),function(value){return"FileUpload_"+value+".FileUpload"}).join(" ");this.element.on(eventNames,handler)};$.each(["send","abort","remove"],function(){var functionName=this;FileUpload.prototype[functionName]=function(){this.runtime[functionName].apply(this.runtime,arguments)}});FileUpload.prototype.finalizeSend=function(file,success,responseHandler){responseHandler=responseHandler||$.noop;var submitData=$.extend({},{FileUploadId:file.fuid,FileUploadName:encodeURIComponent(file.name),FileUploadType:file.type,FileUploadSuccess:success,FileUploadSize:file.size},this.options.data||{});if(this.options.serializeFormData)$.each(this.element.serializeArray(),function(i,item){submitData[item.name]=item.value});var self=this;$.ajax(this.options.finalEndpoint,{beforeSend:this.options.beforeFinalSend,type:"post",dataType:this.options.defaultDataType,data:submitData,contentType:this.options.defaultContentType,success:function(response){responseHandler(false,response);self.triggerEvent("filefinish",file,success,false,response)},error:function(xhr){var text=window.FileUpload_ToJSONIfPossible(xhr.responseText);responseHandler(true,text);self.triggerEvent("filefinish",file,success,true,text)},file:file})};FileUpload.prototype.destroy=function(){if(this.layout){this.element.removeClass("layout-"+this.options.layout.toLowerCase());this.layout.destroy(this);delete this.layout}this.runtime.destroy(this);delete this.runtime;this.element.unbind(".FileUpload")};window.FileUpload=FileUpload})(jQuery,"undefined",FileUpload_Debug);(function($,undef,debug){"use strict";FileUpload.File=function(fuid,name,size,type){this.fuid=fuid||0;this.name=name||"unknown";this.size=size||0;this.type=type||"application/octet-stream"}})(jQuery,"undefined",FileUpload_Debug);(function($,undef,debug){"use strict";function Runtime(){}Runtime.create=function(name,runtimeCode){var runtime=function(fileUpload){this.fileUpload=fileUpload};$.extend(runtime.prototype,Runtime.prototype,runtimeCode);FileUpload.Runtime[name]=runtime;FileUpload.Runtime[name].supports=runtimeCode.supports};$.each(["create","destroy","send","abort","supports","remove","uploading"],function(){Runtime.prototype[this]=$.noop});Runtime.prototype.abort=function(fileId){if(fileId&&this.files[fileId]){debug("Aborting file id:",fileId);this.files[fileId].abort()}else if(!fileId){this.fileUpload.triggerEvent("abort");debug("Aborting all file uploads");this.fileStack=[];$.each(this.files,function(){this.abort()})}};Runtime.prototype.remove=function(fileId){if(fileId&&this.files[fileId]){var file=this.files[fileId];if(file.isUploading())throw"Abort or complete in order to remove";file.destroy();delete this.files[fileId]}else if(!fileId){if(this.uploading())throw"Abort or complete in order to remove";$.each(this.files,function(){this.destroy()});this.files={}}};FileUpload.Runtime=Runtime})(jQuery,"undefined",FileUpload_Debug);(function($,undef,debug){"use strict";function Layout(){}Layout.create=function(name,layoutCode){var layout=function(fileUpload){this.fileUpload=fileUpload};$.extend(layout.prototype,Layout.prototype,layoutCode);window.FileUpload.Layout[name]=layout};Layout.prototype.create=Layout.prototype.destroy=$.noop;FileUpload.Layout=Layout})(jQuery,"undefined",FileUpload_Debug);(function($,undef,debug){"use strict";FileUpload.Runtime.create("HTMLRuntime",{create:function(){this.filesUploading=0;this.files={};this.counter=0;var self=this,HTMLFile=FileUpload.Runtime.HTMLRuntime.File;this.fileUpload.element.on("change.FileUpload",":file",function(e){var target=e.target,newFiles=[];$.each(target.files,function(){var htmlFile=new HTMLFile(this,self.createFileOptions(self.counter));if(this.size>self.fileUpload.options.maxFileSize)self.fileUpload.triggerEvent("filesizeerror",htmlFile.info);else{self.files[self.counter]=new HTMLFile(this,self.createFileOptions(self.counter));newFiles.push(self.files[self.counter].info);self.counter++}});self.fileUpload.triggerEvent("select",newFiles);if(self.fileUpload.options.autoUpload)self.fileUpload.send();if(self.fileUpload.options.clearInputOnChange)target.value=""})},destroy:function(){if(this.timer)clearTimeout(this.timer);$.each(this.files,function(){this.destroy()});this.files=this.fileStack=null},createFileOptions:function(counter){var self=this,options=$.extend({},this.fileUpload.options,{finalize:function(success){var innerSelf=this;self.fileUpload.finalizeSend(this.info,success,function(isError,response,onComplete){if(!isError&&success){if(!innerSelf.aborted){debug("Deleting file with counter",innerSelf.options.counter);delete self.files[innerSelf.options.counter]}}else if(self.fileUpload.options.deleteOnFailure)delete self.files[innerSelf.options.counter]});self.filesUploading--},progress:function(percentage,bytesLoaded,progressEvent,xhrOptions){self.percentLoaded[this.info.fuid]=percentage;var percentTotal=0;$.each(self.percentLoaded,function(){percentTotal+=this});self.fileUpload.triggerEvent("totalprogress",Math.min(100,Math.ceil(percentTotal/self.stackCount)));self.fileUpload.triggerEvent("fileprogress",this.info,percentage)},counter:counter});var defaultEventHandler=function(eventName){return function(chunk){self.fileUpload.triggerEvent(eventName,this.info,chunk)}};$.each(["beforeStart","beforeSend","success","error"],function(){options[this]=defaultEventHandler("file"+this.toLowerCase())});return options},uploading:function(){return!!this.timeout},send:function(fileId){if(!this.uploading()){this.stackLoaded=0;this.percentLoaded={};this.stackSize=0;this.stackCount=0;this.fileStack=[]}var self=this;if(!fileId){$.each(this.files,function(counter){if($.inArray(counter,self.fileStack)===-1&&!self.files[counter].isUploading()){self.fileStack.push(counter);self.stackSize+=this.file.size;self.stackCount++}})}else if(this.files[fileId]&&!this.files[fileId].isUploading()){this.fileStack.push(fileId);this.stackSize+=this.files[fileId].file.size;this.stackCount++}debug("Total stack size: ",this.stackSize);this.fileUpload.triggerEvent("beforestart",{fileStack:this.fileStack,stackSize:this.stackSize,fileId:fileId,running:this.uploading()});this.fileStack=this.fileStack.reverse();if(!this.uploading())this.timeout=setInterval(function(){if(self.fileStack.length===0){clearInterval(self.timeout);self.timeout=null}else if(self.filesUploading<self.fileUpload.options.numberOfSimultaneousFileUploads){var counter=self.fileStack.pop();if(self.files[counter]){debug("Uploading file: ",counter,self.fileStack,self.files);self.files[counter].upload();self.filesUploading++}}},500)},supports:function(){if(typeof File===undef||typeof Blob===undef)return false;var isFn=$.isFunction;return isFn(Blob.prototype.webkitSlice)||isFn(Blob.prototype.mozSlice)||isFn(Blob.prototype.slice)}});$.ajaxPrefilter(function(options){options.xhr=function createStandardXhrWithUpload(){var xhr=$.ajaxSettings.xhr();if(xhr.upload)$.each(options.upload||{},function(event,listener){var optionsWrapper=function(e){return listener.call(this,e,options)};xhr.upload.addEventListener(event,optionsWrapper,false)});return xhr}})})(jQuery,"undefined",FileUpload_Debug);(function($,undef,debug){"use strict";var default_options={method:"post",chunkEndpoint:"",dataType:"html",numberOfSimultaneousChunkUploads:1,numberOfRetriesBeforeFailure:1e3,chunkSize:5242880,beforeStart:$.noop,beforeSend:$.noop,success:$.noop,error:$.noop,finalize:$.noop,progress:$.noop};function File(file,options){this.options=$.extend({},default_options,options||{});this.file=file;this.info=new FileUpload.File(this.options.counter,file.name,file.size,file.type);this.totalChunks=Math.ceil(file.size/this.options.chunkSize);this.chunksUploading=0;this.chunksUploaded=0}File.prototype.destroy=function(){if(this.timer)clearTimeout(this.timer);this.chunks=this.xhr=null};File.prototype.slice=function(start,end){if(this.file.slice)return this.file.slice(start,end);if(this.file.mozSlice)return this.file.mozSlice(start,end);return this.file.webkitSlice(start,end)};File.prototype.isUploading=function(){return!!this.timeout};File.prototype.upload=function(){debug("Starting upload process for file");if(this.isUploading()){debug("File is in uploading state, exit");return false}this.chunks=[];this.chunksLoaded=[];this.xhr={};this.uploaded=0;var startPosition=0,endPosition=this.options.chunkSize,index=0;while(startPosition<this.file.size){if(endPosition>this.file.size)endPosition=this.file.size;this.chunks.push({id:index,start:startPosition,end:endPosition,failures:0});index++;startPosition=endPosition;endPosition+=this.options.chunkSize}this.chunks=this.chunks.reverse();this.options.beforeStart.call(this);var self=this;this.percentage=0;this.aborted=false;this.timeout=setInterval(function(){if(self.chunks.length===0&&self.chunksUploading===0){clearInterval(self.timeout);self.timeout=null;self.finalize(self.chunksUploaded===self.totalChunks)}else if(!self.aborted)if(self.chunksUploading<self.options.numberOfSimultaneousChunkUploads&&self.chunks.length!==0)self.send()},500);return true};File.prototype.progressHandler=function(e,options){var self=this;setTimeout(function(){var bytesLoaded=0;$.each(self.chunksLoaded,function(){bytesLoaded+=this.end-this.start});bytesLoaded+=e.loaded;self.percentage=Math.max(self.percentage,Math.min(100,Math.ceil(bytesLoaded/self.file.size*100)));self.options.progress.call(self,self.percentage,bytesLoaded,e,options);debug("File progress: ",self.file.name," = ",self.percentage,"% (chunk:",options.chunk.id,")")},0)};File.prototype.send=function(){var chunk=this.chunks.pop(),blob=this.slice(chunk.start,chunk.end);debug("Sending a new file chunk",chunk);var options=this.options,self=this;var ajaxOptions={dataType:options.dataType,type:options.method,data:blob,timeout:3e4*(chunk.failures+1),contentType:"application/octet-stream",processData:false,chunk:chunk,upload:{progress:$.proxy(this.progressHandler,this),load:$.proxy(this.progressHandler,this)},beforeSend:function(xhr,settings){xhr.setRequestHeader("X-File-Chunk",settings.chunk.id);xhr.setRequestHeader("X-File-Start",settings.chunk.start);xhr.setRequestHeader("X-File-End",settings.chunk.end);xhr.setRequestHeader("X-File-Id",self.info.fuid);xhr.setRequestHeader("X-File-Name",encodeURIComponent(self.info.name));xhr.setRequestHeader("X-File-Size",self.info.size);xhr.setRequestHeader("X-File-Type",self.info.type);self.xhr[settings.chunk.id]=xhr;self.options.beforeSend.apply(self,$.merge([this.chunk],arguments))},success:function(){self.chunksUploaded++;self.chunksUploading--;self.chunksLoaded.push(this.chunk);delete self.xhr[this.chunk.id];self.options.success.apply(self,$.merge([this.chunk],arguments))},error:function(e,statusText){var errorChunk=this.chunk;debug("Failed to upload chunk",errorChunk,statusText);if(statusText!=="abort"&&errorChunk.failures<options.numberOfRetriesBeforeFailure){errorChunk.failures++;self.chunks.push(errorChunk);debug("Retrying to upload chunk",errorChunk)}self.chunksUploading--;delete self.xhr[errorChunk.id];self.options.error.apply(self,$.merge([this.chunk],arguments))}};$.ajax(options.chunkEndpoint,ajaxOptions);this.chunksUploading++};File.prototype.abort=function(){debug("Aborting file upload");this.aborted=true;this.chunks=[];this.chunksUploaded=0;$.each(this.xhr||[],function(){this.abort()})};File.prototype.finalize=function(success){debug("Finalizing file upload, success state: ",success);this.chunksUploading=0;this.options.finalize.apply(this,arguments)};window.FileUpload.Runtime.HTMLRuntime.File=File})(jQuery,"undefined",FileUpload_Debug);(function($,undef,debug){"use strict";var instanceCounter=0;var instances={};FileUpload.Runtime.create("FlashRuntime",{create:function(){var instanceId=this.instanceId=++instanceCounter;var options=this.fileUpload.options;this.fileUpload.options.numberOfRetriesBeforeFailure=1e3;var wrapElement=this.wrapElement=this.fileUpload.element.find(options.flashWrapper||":file");$("<div />").attr("id","runtime_"+this.instanceId).insertAfter(wrapElement);$(window).on("resize.FileUpload scroll.FileUpload DOMNodeInserted.FileUpload",$.proxy(this.positionAndResize,this));instances[instanceId]=this;this.embedSWF()},destroy:function(){this.getMovieObject().remove();$(window).unbind(".FileUpload")},init:function(){this.getMovie().setOptions(this.fileUpload.options);this.positionAndResize()},send:function(fileId){this.getMovie().upload(fileId||-1)},abort:function(fileId){this.getMovie().abort(fileId||-1)},remove:function(fileId){this.getMovie().remove(fileId||-1)},uploading:function(){return this.getMovie().uploading()},embedSWF:function(){var flashPath=this.fileUpload.options.flashPath;var flashvars={id:this.instanceId};var params={menu:"false",scale:"noScale",allowFullscreen:"true",allowNetworking:"all",allowScriptAccess:"always",bgcolor:"",wmode:"transparent"};var attributes={id:"flash_runtime_"+this.instanceId};swfobject.embedSWF(flashPath+"fileupload.swf","runtime_"+this.instanceId,"100%","100%","11.1.0",flashPath+"expressInstall.swf",flashvars,params,attributes)},handleFlashEvent:function(eventName,eventArgs){if(eventName==="filefinish"){var self=this;this.fileUpload.finalizeSend.call(this.fileUpload,eventArgs[0],eventArgs[1],function(isError,response,onComplete){if(eventArgs[1]&&!isError||self.fileUpload.options.deleteOnFailure)self.getMovie().deleteFile(eventArgs[0].fuid)})}else this.fileUpload.triggerEvent.apply(this.fileUpload,$.merge([eventName],eventArgs))},positionAndResize:function(){this.getMovieObject().css($.extend(this.wrapElement.position(),{position:"absolute",outline:0})).width(this.wrapElement.outerWidth()).height(this.wrapElement.outerHeight())},getMovieObject:function(){return $("#flash_runtime_"+this.instanceId)},getMovie:function(){var name="flash_runtime_"+this.instanceId;return document[name]||window[name]},supports:function(){return swfobject.hasFlashPlayerVersion("10")}});FileUpload.Runtime.FlashRuntime.EventHandler=function(instanceId,args){var instance=instances[instanceId],safeCall="handleFlashEvent";var eventName=args[0],eventArgs=[];if(args.length>1)eventArgs=args.slice(1);debug("Flash event:",eventName,eventArgs);if(eventName!=="abort")if($.isFunction(instance[eventName]))instance[eventName].apply(instance,eventArgs);else if($.isFunction(instance[safeCall]))instance[safeCall].call(instance,eventName,eventArgs)}})(jQuery,"undefined",FileUpload_Debug);(function($,undef,debug){"use strict";FileUpload.Runtime.create("FrameRuntime",{create:function(){if(!this.fileUpload.options.multipartEndpoint)throw"Unable to use FrameRuntime, define multipartEndpoint in options";this.filesUploading=0;this.counter=0;this.files={};this.percentLoaded={};var self=this,FrameFile=FileUpload.Runtime.FrameRuntime.File;this.fileUpload.element.on("change.FileUpload",":file",function(e){var target=$(e.target);target.clone(true).insertBefore(target).val("");var file=new FrameFile(target,self.createFileOptions(self.counter));self.files[self.counter]=file;self.counter++;self.fileUpload.triggerEvent("select",[file.info]);if(self.fileUpload.options.autoUpload)self.fileUpload.send()})},destroy:function(){if(this.timer)clearTimeout(this.timer);$.each(this.files,function(){this.destroy()});this.files=null},send:function(fileId){if(!this.uploading()){this.fileStack=[];this.stackComplete=0;this.stackCount=0;this.percentLoaded={}}var self=this;if(!fileId){$.each(this.files,function(counter){if($.inArray(counter,self.fileStack)===-1&&!self.files[counter].isUploading()){self.fileStack.push(counter);self.stackCount++}})}else if(this.files[fileId]){this.fileStack.push(fileId);this.stackCount++}debug("Total stack count: ",this.stackCount);this.fileUpload.triggerEvent("beforestart",{fileStack:this.fileStack,stackSize:0,fileId:fileId,running:this.uploading()});this.fileStack=this.fileStack.reverse();if(!this.uploading())this.timeout=setInterval(function(){if(self.fileStack.length===0){clearInterval(self.timeout);self.timeout=null}else if(self.filesUploading<self.fileUpload.options.numberOfSimultaneousFileUploads){var counter=self.fileStack.pop();debug("Uploading file: ",counter,self.fileStack,self.files);self.files[counter].upload();self.filesUploading++}},500)},uploading:function(){return!!this.timeout},createFileOptions:function(counter){var self=this;function handleSuccessOrError(success){return function(){var innerSelf=this;self.fileUpload.finalizeSend(this.info,success,function(isError,response,onComplete){if(!isError&&success){var c=innerSelf.options.counter;debug("Deleting file with counter",c);self.files[c].destroy();delete self.files[c]}});self.filesUploading--;self.stackComplete++}}return $.extend({},this.fileUpload.options,{counter:counter,beforeStart:function(){self.fileUpload.triggerEvent("filebeforestart",this.info)},progress:function(percentage){self.percentLoaded[this.info.fuid]=percentage;var percentTotal=0;$.each(self.percentLoaded,function(){percentTotal+=this});self.fileUpload.triggerEvent("totalprogress",Math.min(100,Math.ceil(percentTotal/self.stackCount)));self.fileUpload.triggerEvent("fileprogress",this.info,percentage)},success:handleSuccessOrError(true),error:handleSuccessOrError(false)})},supports:function(){return true}})})(jQuery,"undefined",FileUpload_Debug);(function($,undef,debug){"use strict";var default_options={beforeStart:$.noop,success:$.noop,progress:$.noop};function File(fileElement,options){this.options=$.extend({},default_options,options);var path=fileElement.val(),tokens=path.split(/\\|\//),name=tokens[tokens.length-1];this.info=new FileUpload.File(this.options.counter,name);this.createFormWrapper(fileElement);this.uploading=false}File.prototype.upload=function(){if(this.isUploading()){debug("File already in upload state");return false}this.options.beforeStart.call(this);this.uploading=true;this.frameElement.removeClass("abort");this.formElement.submit();return true};File.prototype.isUploading=function(){return false};File.prototype.abort=function(){this.frameElement.attr("src","about:blank").addClass("abort")};File.prototype.destroy=function(){this.frameElement.add(this.formElement).remove()};File.prototype.handleFrameComplete=function(){try{var response=this.frameElement[0].contentWindow.document.body.innerHTML,type="success";debug("Frame Loaded");debug(response);try{response=$.parseJSON($("<span />").append(response).text())||{}}catch(e){debug("Failed to parse JSON response",e.message);type="error";response={}}if(response.error||response.exception||this.frameElement.hasClass("abort"))type="error";if(response.request){this.info.size=response.request.fileSize;this.info.type=response.request.fileType}this.options.progress.call(this,100);this.options[type].call(this,response)}catch(ad){debug("Failed to get frame contents (Access Denied?): ",ad)}this.uploading=false};File.prototype.createFormWrapper=function(domElement){var hash="Form_"+Math.round(Math.random()*1e5);var endpoint=this.options.multipartEndpoint;var form=this.formElement=$("<form />").append(domElement).attr({action:endpoint,enctype:"multipart/form-data",method:"post",id:hash,target:hash}).addClass("fileupload-frame");form.insertBefore("body").hide();form.append($('<input type="text" name="X-File-Id" />').val(this.info.fuid));form.append($('<input type="text" name="X-File-Name" />').val(this.info.name));form.append($('<input type="text" name="X-File-Type" />').val(this.info.type));form.append($('<input type="text" name="X-File-Size" />').val(this.info.size));var frame=this.frameElement=$('<iframe src="javascript:;" name="'+hash+'" />').on("load",$.proxy(this.handleFrameComplete,this)).attr({id:"IFrame_"+hash}).hide().insertBefore(form)};window.FileUpload.Runtime.FrameRuntime.File=File})(jQuery,"undefined",FileUpload_Debug);(function($,undef,debug){"use strict";FileUpload.Layout.create("Simple",{create:function(){this.progressBar=$("<div />").insertAfter(this.fileUpload.element.find(":file")).addClass("progress").append($("<div/>").addClass("progress-bar progress-bar-striped"));if(this.fileUpload.runtimeName==="FlashRuntime"){this.flashContainer=this.fileUpload.element.find("#simple-flash-wrapper");if(this.flashContainer.size()!==0){this.fileUpload.options.flashWrapper="#simple-flash-wrapper :button";this.fileUpload.element.find(":file").hide();this.flashContainer.show()}}var self=this;this.fileUpload.element.on("submit.FileUpload",function(e){e.preventDefault();self.progressBar.find(".progress-bar").text("");self.fileUpload.send()});this.fileUpload.on("select",function(e,files){if(self.flashContainer){var fileArray=[];$.each(files,function(){fileArray.push(this.name)});self.flashContainer.find(".selection").text(fileArray.join(", "))}});this.fileUpload.on("filebebeforeloading",function(){self.appendLoadingIfNotPresent()});this.fileUpload.on("fileloading",function(e,file,percentage){var bar=self.progressBar.find(".progress-bar").text(self.fileUpload.options.fileLoading+" ("+percentage+"%)");if(bar.width()<120)bar.width(120)});this.fileUpload.on("filesizeerror",function(e,file){self.progressBar.find(".progress-bar").addClass("progress-bar-danger").removeClass("active").width("100%").text(self.fileUpload.options.fileSize)});this.fileUpload.on("beforestart totalprogress",function(e,ui){var isStart=e.type==="FileUpload_beforestart";if(isStart){self.stackFileFailures=0;self.stackFileCount=0;self.stackSizeCount=ui.fileStack.length;if(self.stackSizeCount>0){self.appendLoadingIfNotPresent();self.fileUpload.element.find(":submit").addClass("disabled")}}self.handleProgress(isStart?0:ui)});this.fileUpload.on("filefinish",$.proxy(this.handleFileFinalize,this));this.fileUpload.on("abort",$.proxy(this.handleAbort,this));this.fileUpload.element.find("button.abort, input.abort").on("click.FileUpload",function(){self.fileUpload.element.find(":submit").removeClass("disabled");self.fileUpload.abort()})},destroy:function(){this.progressBar.remove();if(this.flashContainer&&this.flashContainer.size()!==0){this.flashContainer.hide();this.fileUpload.element.find(":file").show()}this.fileUpload.element.find("button.abort, input.abort").unbind(".FileUpload")},handleProgress:function(width){this.width=Math.max(this.width||0,width);var bar=this.progressBar.find(".progress-bar").width(width+"%");if(width===0)bar.addClass("active").removeClass("progress-bar-danger progress-bar-warning progress-bar-success");else bar.text(width+"%")},handleAbort:function(){this.progressBar.find(".progress-bar").addClass("progress-bar-danger").removeClass("active")},handleFileFinalize:function(e,file,success,isError,response){this.progressBar.removeClass("active");if(!success)this.stackFileFailures++;this.stackFileCount++;if(this.stackFileCount===this.stackSizeCount){this.fileUpload.element.find(".ajax-loading").remove();this.fileUpload.element.find(":submit").removeClass("disabled");var className="progress-bar-success";if(isError||this.stackFileFailures===this.stackSizeCount)className="progress-bar-danger";else if(this.stackFileFailures>0)className="progress-bar-warning";this.progressBar.find(".progress-bar").text(this.fileUpload.options.fileComplete).addClass(className).removeClass("active")}},appendLoadingIfNotPresent:function(){var loader=$("<img />").addClass("ajax-loading").attr("src",this.fileUpload.options.ajaxLoader);if(this.flashContainer&&this.flashContainer.size()!==0&&this.flashContainer.find(".ajax-loading").size()===0)loader.appendTo(this.flashContainer);else if(this.fileUpload.element.find(".ajax-loading").size()===0)loader.insertAfter(this.fileUpload.element.find(":file"))}})})(jQuery,"undefined",FileUpload_Debug);(function($,undef,debug){"use strict";FileUpload.Layout.create("Complex",{create:function(){if(this.fileUpload.runtimeName==="FlashRuntime"){this.fileUpload.options.flashWrapper="#complex-flash-wrapper";this.fileUpload.element.find(":file").hide()}this.table=this.fileUpload.element.find("table");this.tbody=this.table.find("tbody");this.fileUpload.on("select",$.proxy(this.handleFileSelect,this));this.fileUpload.on("filebebeforeloading",$.proxy(this.handleFileStart,this));this.fileUpload.on("filebeforestart",$.proxy(this.handleFileStart,this));this.fileUpload.on("filefinish",$.proxy(this.handleFileComplete,this));this.fileUpload.on("fileprogress",$.proxy(this.handleFileProgress,this));this.fileUpload.on("fileloading",$.proxy(this.handleFileLoading,this));this.fileUpload.on("filesizeerror",$.proxy(this.handleFileSizeError,this));var self=this;this.table.on("click.FileUpload",".btn",function(e){var target=$(e.target),row=target.parents("tr:first"),id=row.attr("id").substring(5);if(target.hasClass("submit")||target.hasClass("retry")){debug("Uploading new file: ",id);self.fileUpload.send(id)}if(target.hasClass("cancel"))self.fileUpload.abort(id);if(target.hasClass("remove")){self.fileUpload.remove(id);row.fadeOut("fast",function(){row.remove()})}});this.fileUpload.element.find(".upload-all").on("click.FileUpload",function(){self.fileUpload.send()});this.fileUpload.element.find(".cancel-all").on("click.FileUpload",function(){self.fileUpload.abort()})},destroy:function(){this.fileUpload.element.find(".upload-all, .cancel-all").unbind(".FileUpload");this.table.unbind(".FileUpload");this.table.find("tr").not(".template").remove();if(this.fileUpload.runtimeName==="FlashRuntime")this.fileUpload.element.find(":file").show()},getFileRow:function(file,selector){var row=this.tbody.find("#file_"+file.fuid);if(selector)return row.find(selector);return row},handleFileSelect:function(e,files){var template=this.fileUpload.element.find(".template"),i;for(i=0;i<files.length;i++){var file=files[i],newTemplate=template.clone();newTemplate.removeClass("template").attr("id","file_"+file.fuid);newTemplate.find(".name").html(file.name);newTemplate.find(".size").html(FileUpload.formatBytes(file.size));newTemplate.appendTo(this.tbody);newTemplate.find(".submit, .remove").show()}},handleFileProgress:function(e,file,progress){this.getFileRow(file,".progress .progress-bar").data("progress",progress).width(progress+"%").text(progress+"%")},handleFileBeforeLoad:function(e,file){this.appendLoadingIfNotPresent(file)},handleFileLoading:function(e,file,percentage){var tableRow=this.getFileRow(file);var msg=this.fileUpload.options.fileLoading+" ("+percentage+"%)";var bar=this.getFileRow(file,".progress .progress-bar").text(msg);if(bar.width()<120)bar.width(120)},handleFileStart:function(e,file){var tableRow=this.getFileRow(file);var selector=".submit, .retry";if(e.type!=="FileUpload_filebeforestart")selector+=", .cancel";else tableRow.find(".cancel").removeClass("disabled");var buttons=tableRow.find(selector);setTimeout(function(){buttons.addClass("disabled")},0);tableRow.find(".remove").hide();tableRow.find(".cancel").show();this.appendLoadingIfNotPresent(file);tableRow.find(".progress-bar").removeClass("progress-bar-success progress-bar-danger").addClass("active");tableRow.addClass("is-loading")},handleFileComplete:function(e,file,success,isError){var tableRow=this.getFileRow(file);var failure=isError||!success,bar=tableRow.find(".progress .progress-bar");if(failure){tableRow.find(".retry").button("reset").removeClass("disabled").show();tableRow.find(".submit").button("reset").hide()}else bar.text(this.fileUpload.options.fileComplete);tableRow.find(".cancel").hide();tableRow.find(".remove").show();tableRow.find(".progress-bar").addClass(!failure?"progress-bar-success":"progress-bar-danger").removeClass("active");tableRow.find(".ajax-loading").remove();tableRow.removeClass("is-loading error").addClass("complete")},handleFileSizeError:function(e,info){$("<div />").addClass("alert alert-error").text(info.name+" "+this.fileUpload.options.fileSize).prepend($('<button type="button" class="close" data-dismiss="alert">×</button>')).prependTo(this.fileUpload.element)},appendLoadingIfNotPresent:function(file){var tableRow=this.getFileRow(file);var loader=$("<img />").addClass("ajax-loading").attr("src",this.fileUpload.options.ajaxLoader);if(tableRow.find(".ajax-loading").size()===0)tableRow.find("td:last").append(loader)}})})(jQuery,"undefined",FileUpload_Debug);(function($,undef){"use strict";var default_options={layout:"Simple"};$.fn.extend({fileupload:function(options){var args=Array.prototype.slice.call(arguments);return $.each(this,function(){var element=$(this),instance=element.data("fileupload");if(instance){if(typeof options==="string"&&$.isFunction(instance[options])){instance[options].apply(instance,args.slice(1));if(options==="destroy")element.removeData("fileupload")}}else element.data("fileupload",new FileUpload(this,$.extend({},default_options,options||{})))})}})})(jQuery,"undefined");(function($){$.timeago=function(timestamp){if(timestamp instanceof Date)return inWords(timestamp);else if(typeof timestamp=="string")return inWords($.timeago.parse(timestamp));else return inWords($.timeago.datetime(timestamp))};var $t=$.timeago;$.extend($.timeago,{settings:{refreshMillis:6e4,allowFuture:false,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]}},inWords:function(distanceMillis){var $l=this.settings.strings;var prefix=$l.prefixAgo;var suffix=$l.suffixAgo;if(this.settings.allowFuture){if(distanceMillis<0){prefix=$l.prefixFromNow;
suffix=$l.suffixFromNow}distanceMillis=Math.abs(distanceMillis)}var seconds=distanceMillis/1e3;var minutes=seconds/60;var hours=minutes/60;var days=hours/24;var years=days/365;function substitute(stringOrFunction,number){var string=$.isFunction(stringOrFunction)?stringOrFunction(number,distanceMillis):stringOrFunction;var value=$l.numbers&&$l.numbers[number]||number;return string.replace(/%d/i,value)}var words=seconds<45&&substitute($l.seconds,Math.round(seconds))||seconds<90&&substitute($l.minute,1)||minutes<45&&substitute($l.minutes,Math.round(minutes))||minutes<90&&substitute($l.hour,1)||hours<24&&substitute($l.hours,Math.round(hours))||hours<48&&substitute($l.day,1)||days<30&&substitute($l.days,Math.floor(days))||days<60&&substitute($l.month,1)||days<365&&substitute($l.months,Math.floor(days/30))||years<2&&substitute($l.year,1)||substitute($l.years,Math.floor(years));return $.trim([prefix,words,suffix].join(" "))},parse:function(iso8601){var s=$.trim(iso8601);s=s.replace(/\.\d\d\d+/,"");s=s.replace(/-/,"/").replace(/-/,"/");s=s.replace(/T/," ").replace(/Z/," UTC");s=s.replace(/([\+-]\d\d)\:?(\d\d)/," $1$2");return new Date(s)},datetime:function(elem){var isTime=$(elem).get(0).tagName.toLowerCase()=="time";var iso8601=isTime?$(elem).attr("datetime"):$(elem).attr("title");return $t.parse(iso8601)}});$.fn.timeago=function(){var self=this;self.each(refresh);var $s=$t.settings;if($s.refreshMillis>0){setInterval(function(){self.each(refresh)},$s.refreshMillis)}return self};function refresh(){var data=prepareData(this);if(!isNaN(data.datetime)){$(this).text(inWords(data.datetime))}return this}function prepareData(element){element=$(element);if(!element.data("timeago")){element.data("timeago",{datetime:$t.datetime(element)});var text=$.trim(element.text());if(text.length>0)element.attr("title",text)}return element.data("timeago")}function inWords(date){return $t.inWords(distance(date))}function distance(date){return(new Date).getTime()-date.getTime()}document.createElement("abbr");document.createElement("time")})(jQuery);(function($){$.timeago.regional={};$.timeago.regional["es"]={prefixAgo:"hace",prefixFromNow:"dentro de",suffixAgo:"",suffixFromNow:"",seconds:"menos de un minuto",minute:"un minuto",minutes:"unos %d minutos",hour:"una hora",hours:"%d horas",day:"un día",days:"%d días",month:"un mes",months:"%d meses",year:"un año",years:"%d años"};$.timeago.regional["fr"]={prefixAgo:"il y a",prefixFromNow:"d'ici",seconds:"moins d'une minute",minute:"environ une minute",minutes:"environ %d minutes",hour:"environ une heure",hours:"environ %d heures",day:"environ un jour",days:"environ %d jours",month:"environ un mois",months:"environ %d mois",year:"un an",years:"%d ans"};$.timeago.regional["pt"]={suffixAgo:"atrás",suffixFromNow:"a partir de agora",seconds:"menos de um minuto",minute:"cerca de um minuto",minutes:"%d minutos",hour:"cerca de uma hora",hours:"cerca de %d horas",day:"um dia",days:"%d dias",month:"cerca de um mês",months:"%d meses",year:"cerca de um ano",years:"%d anos"};$.timeago.regional["sv"]={prefixAgo:"för",prefixFromNow:"om",suffixAgo:"sedan",suffixFromNow:"",seconds:"mindre än en minut",minute:"ungefär en minut",minutes:"%d minuter",hour:"ungefär en timme",hours:"ungefär %d timmar",day:"en dag",days:"%d dagar",month:"ungefär en månad",months:"%d månader",year:"ungefär ett år",years:"%d år"};$.timeago.regional["zh"]={prefixAgo:null,prefixFromNow:"从现在开始",suffixAgo:"之前",suffixFromNow:null,seconds:"不到 1 分钟",minute:"大约 1 分钟",minutes:"%d 分钟",hour:"大约 1 小时",hours:"大约 %d 小时",day:"1 天",days:"%d 天",month:"大约 1 个月",months:"%d 月",year:"大约 1 年",years:"%d 年",numbers:[]};$.timeago.regional["ja"]={prefixAgo:"",prefixFromNow:"今から",suffixAgo:"前",suffixFromNow:"後",seconds:"ほんの数秒",minute:"約一分",minutes:"%d 分",hour:"大体一時間",hours:"大体 %d 時間位",day:"一日",days:"%d 日ほど",month:"大体一ヶ月",months:"%d ヶ月ほど",year:"丁度一年（虎舞流ｗ）",years:"%d 年"};function numpf(n,f,s,t){var n10=n%10;if(n10==1&&(n==1||n>20)){return f}else if(n10>1&&n10<5&&(n>20||n<10)){return s}else{return t}}$.timeago.regional["ru"]={prefixAgo:null,prefixFromNow:"через",suffixAgo:"назад",suffixFromNow:null,seconds:"меньше минуты",minute:"минуту",minutes:function(value){return numpf(value,"%d минута","%d минуты","%d минут")},hour:"час",hours:function(value){return numpf(value,"%d час","%d часа","%d часов")},day:"день",days:function(value){return numpf(value,"%d день","%d дня","%d дней")},month:"месяц",months:function(value){return numpf(value,"%d месяц","%d месяца","%d месяцев")},year:"год",years:function(value){return numpf(value,"%d год","%d года","%d лет")}};$.timeago.regional["tr"]={suffixAgo:"önce",suffixFromNow:null,seconds:"1 dakikadan",minute:"1 dakika",minutes:"%d dakika",hour:"1 saat",hours:"%d saat",day:"1 gün",days:"%d gün",month:"1 ay",months:"%d ay",year:"1 yıl",years:"%d yıl"};$.timeago.regional["ca"]={prefixAgo:"fa",prefixFromNow:"d'aqui a",suffixAgo:null,suffixFromNow:null,seconds:"menys d'un minut",minute:"un minut",minutes:"uns %d minuts",hour:"una hora",hours:"unes %d hores",day:"1 dia",days:"%d dies",month:"aproximadament un mes",months:"%d mesos",year:"aproximadament un any",years:"%d anys"};$.timeago.regional["de"]={prefixAgo:"vor",prefixFromNow:"in",suffixAgo:"",suffixFromNow:"",seconds:"wenigen Sekunden",minute:"etwa einer Minute",minutes:"%d Minuten",hour:"etwa einer Stunde",hours:"%d Stunden",day:"etwa einem Tag",days:"%d Tagen",month:"etwa einem Monat",months:"%d Monaten",year:"etwa einem Jahr",years:"%d Jahren"}})(jQuery);(function(c){function p(){var d,a={height:h.innerHeight,width:h.innerWidth};if(!a.height&&((d=i.compatMode)||!c.support.boxModel))d=d==="CSS1Compat"?k:i.body,a={height:d.clientHeight,width:d.clientWidth};return a}var m={},e,a,i=document,h=window,k=i.documentElement,j=c.expando;c.event.special.inview={add:function(a){m[a.guid+"-"+this[j]]={data:a,$element:c(this)}},remove:function(a){try{delete m[a.guid+"-"+this[j]]}catch(c){}}};c(h).bind("scroll resize",function(){e=a=null});setInterval(function(){var d=c(),j,l=0;c.each(m,function(a,b){var c=b.data.selector,e=b.$element;d=d.add(c?e.find(c):e)});if(j=d.length){e=e||p();for(a=a||{top:h.pageYOffset||k.scrollTop||i.body.scrollTop,left:h.pageXOffset||k.scrollLeft||i.body.scrollLeft};l<j;l++)if(c.contains(k,d[l])){var g=c(d[l]),f={height:g.height(),width:g.width()},b=g.offset(),n=g.data("inview"),o;if(!a||!e)break;b.top+f.height>a.top&&b.top<a.top+e.height&&b.left+f.width>a.left&&b.left<a.left+e.width?(o=a.left>b.left?"right":a.left+e.width<b.left+f.width?"left":"both",f=a.top>b.top?"bottom":a.top+e.height<b.top+f.height?"top":"both",b=o+"-"+f,(!n||n!==b)&&g.data("inview",b).trigger("inview",[!0,o,f])):n&&g.data("inview",!1).trigger("inview",[!1])}}},250)})(jQuery);(function($){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a256="",r64=[256],r256=[256],i=0;var UTF8={encode:function(strUni){var strUtf=strUni.replace(/[\u0080-\u07ff]/g,function(c){var cc=c.charCodeAt(0);return String.fromCharCode(192|cc>>6,128|cc&63)}).replace(/[\u0800-\uffff]/g,function(c){var cc=c.charCodeAt(0);return String.fromCharCode(224|cc>>12,128|cc>>6&63,128|cc&63)});return strUtf},decode:function(strUtf){var strUni=strUtf.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(c){var cc=(c.charCodeAt(0)&15)<<12|(c.charCodeAt(1)&63)<<6|c.charCodeAt(2)&63;return String.fromCharCode(cc)}).replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(c){var cc=(c.charCodeAt(0)&31)<<6|c.charCodeAt(1)&63;return String.fromCharCode(cc)});return strUni}};while(i<256){var c=String.fromCharCode(i);a256+=c;r256[i]=i;r64[i]=b64.indexOf(c);++i}function code(s,discard,alpha,beta,w1,w2){s=String(s);var buffer=0,i=0,length=s.length,result="",bitsInBuffer=0;while(i<length){var c=s.charCodeAt(i);c=c<256?alpha[c]:-1;buffer=(buffer<<w1)+c;bitsInBuffer+=w1;while(bitsInBuffer>=w2){bitsInBuffer-=w2;var tmp=buffer>>bitsInBuffer;result+=beta.charAt(tmp);buffer^=tmp<<bitsInBuffer}++i}if(!discard&&bitsInBuffer>0)result+=beta.charAt(buffer<<w2-bitsInBuffer);return result}var Plugin=$.base64=function(dir,input,encode){return input?Plugin[dir](input,encode):dir?null:this};Plugin.btoa=Plugin.encode=function(plain,utf8encode){plain=Plugin.raw===false||Plugin.utf8encode||utf8encode?UTF8.encode(plain):plain;plain=code(plain,false,r256,b64,8,6);return plain+"====".slice(plain.length%4||4)};Plugin.atob=Plugin.decode=function(coded,utf8decode){coded=String(coded).split("=");var i=coded.length;do{--i;coded[i]=code(coded[i],true,r64,a256,6,8)}while(i>0);coded=coded.join("");return Plugin.raw===false||Plugin.utf8decode||utf8decode?UTF8.decode(coded):coded}})(jQuery);+function($){"use strict";var Modal=function(element,options){this.options=options;this.$body=$(document.body);this.$element=$(element);this.$backdrop=this.isShown=null;this.scrollbarWidth=0;if(this.options.remote){this.$element.find("#clinked-portal .modal-content").load(this.options.remote,$.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))}};Modal.VERSION="3.3.2";Modal.TRANSITION_DURATION=300;Modal.BACKDROP_TRANSITION_DURATION=150;Modal.DEFAULTS={backdrop:true,keyboard:true,show:true};Modal.prototype.toggle=function(_relatedTarget){return this.isShown?this.hide():this.show(_relatedTarget)};Modal.prototype.show=function(_relatedTarget){var that=this;var e=$.Event("show.bs.modal",{relatedTarget:_relatedTarget});this.$element.trigger(e);if(this.isShown||e.isDefaultPrevented())return;this.isShown=true;this.checkScrollbar();this.setScrollbar();this.$body.addClass("modal-open");this.escape();this.resize();this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',$.proxy(this.hide,this));this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass("fade");if(!that.$element.parent().length){that.$element.appendTo(that.$body)}that.$element.show().scrollTop(0);if(that.options.backdrop)that.adjustBackdrop();that.adjustDialog();if(transition){that.$element[0].offsetWidth}that.$element.addClass("in").attr("aria-hidden",false);that.enforceFocus();var e=$.Event("shown.bs.modal",{relatedTarget:_relatedTarget});transition?that.$element.find("#clinked-portal .modal-dialog").one("bsTransitionEnd",function(){that.$element.trigger("focus").trigger(e)}).emulateTransitionEnd(Modal.TRANSITION_DURATION):that.$element.trigger("focus").trigger(e)})};Modal.prototype.hide=function(e){if(e)e.preventDefault();e=$.Event("hide.bs.modal");this.$element.trigger(e);if(!this.isShown||e.isDefaultPrevented())return;this.isShown=false;this.escape();this.resize();$(document).off("focusin.bs.modal");this.$element.removeClass("in").attr("aria-hidden",true).off("click.dismiss.bs.modal");$.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",$.proxy(this.hideModal,this)).emulateTransitionEnd(Modal.TRANSITION_DURATION):this.hideModal()};Modal.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(e){if(this.$element[0]!==e.target&&!this.$element.has(e.target).length){this.$element.trigger("focus")}},this))};Modal.prototype.escape=function(){if(this.isShown&&this.options.keyboard){this.$element.on("keydown.dismiss.bs.modal",$.proxy(function(e){e.which==27&&this.hide()},this))}else if(!this.isShown){this.$element.off("keydown.dismiss.bs.modal")}};Modal.prototype.resize=function(){if(this.isShown){$(window).on("resize.bs.modal",$.proxy(this.handleUpdate,this))}else{$(window).off("resize.bs.modal")}};Modal.prototype.hideModal=function(){var that=this;this.$element.hide();this.backdrop(function(){that.$body.removeClass("modal-open");that.resetAdjustments();that.resetScrollbar();that.$element.trigger("hidden.bs.modal")})};Modal.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null};Modal.prototype.backdrop=function(callback){var that=this;var animate=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').prependTo(this.$element).on("click.dismiss.bs.modal",$.proxy(function(e){if(e.target!==e.currentTarget)return;this.options.backdrop=="static"?this.$element[0].focus.call(this.$element[0]):this.hide.call(this)},this));if(doAnimate)this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");if(!callback)return;doAnimate?this.$backdrop.one("bsTransitionEnd",callback).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var callbackRemove=function(){that.removeBackdrop();callback&&callback()};$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",callbackRemove).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION):callbackRemove()}else if(callback){callback()}};Modal.prototype.handleUpdate=function(){if(this.options.backdrop)this.adjustBackdrop();this.adjustDialog()};Modal.prototype.adjustBackdrop=function(){this.$backdrop.css("height",0).css("height",this.$element[0].scrollHeight)};Modal.prototype.adjustDialog=function(){var modalIsOverflowing=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&modalIsOverflowing?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!modalIsOverflowing?this.scrollbarWidth:""})};Modal.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})};Modal.prototype.checkScrollbar=function(){this.bodyIsOverflowing=document.body.scrollHeight>document.documentElement.clientHeight;this.scrollbarWidth=this.measureScrollbar()};Modal.prototype.setScrollbar=function(){var bodyPad=parseInt(this.$body.css("padding-right")||0,10);if(this.bodyIsOverflowing)this.$body.css("padding-right",bodyPad+this.scrollbarWidth)};Modal.prototype.resetScrollbar=function(){this.$body.css("padding-right","")};Modal.prototype.measureScrollbar=function(){var scrollDiv=document.createElement("div");scrollDiv.className="modal-scrollbar-measure";this.$body.append(scrollDiv);var scrollbarWidth=scrollDiv.offsetWidth-scrollDiv.clientWidth;this.$body[0].removeChild(scrollDiv);return scrollbarWidth};function Plugin(option,_relatedTarget){return this.each(function(){var $this=$(this);var data=$this.data("bs.modal");var options=$.extend({},Modal.DEFAULTS,$this.data(),typeof option=="object"&&option);if(!data)$this.data("bs.modal",data=new Modal(this,options));if(typeof option=="string")data[option](_relatedTarget);else if(options.show)data.show(_relatedTarget)})}var old=$.fn.modal;$.fn.modal=Plugin;$.fn.modal.Constructor=Modal;$.fn.modal.noConflict=function(){$.fn.modal=old;return this};$(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this);var href=$this.attr("href");var $target=$($this.attr("data-target")||href&&href.replace(/.*(?=#[^\s]+$)/,""));var option=$target.data("bs.modal")?"toggle":$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());if($this.is("a"))e.preventDefault();$target.one("show.bs.modal",function(showEvent){if(showEvent.isDefaultPrevented())return;$target.one("hidden.bs.modal",function(){$this.is(":visible")&&$this.trigger("focus")})});Plugin.call($target,option,this)})}(jQuery);var requirejs,require,define;(function(ba){function G(b){return"[object Function]"===K.call(b)}function H(b){return"[object Array]"===K.call(b)}function v(b,c){if(b){var d;for(d=0;d<b.length&&(!b[d]||!c(b[d],d,b));d+=1);}}function T(b,c){if(b){var d;for(d=b.length-1;-1<d&&(!b[d]||!c(b[d],d,b));d-=1);}}function t(b,c){return fa.call(b,c)}function m(b,c){return t(b,c)&&b[c]}function B(b,c){for(var d in b)if(t(b,d)&&c(b[d],d))break}function U(b,c,d,e){c&&B(c,function(c,g){if(d||!t(b,g))e&&"object"===typeof c&&c&&!H(c)&&!G(c)&&!(c instanceof RegExp)?(b[g]||(b[g]={}),U(b[g],c,d,e)):b[g]=c});return b}function u(b,c){return function(){return c.apply(b,arguments)}}function ca(b){throw b}function da(b){if(!b)return b;var c=ba;v(b.split("."),function(b){c=c[b]});return c}function C(b,c,d,e){c=Error(c+"\nhttp://requirejs.org/docs/errors.html#"+b);c.requireType=b;c.requireModules=e;d&&(c.originalError=d);return c}function ga(b){function c(a,k,b){var f,l,c,d,e,g,i,p,k=k&&k.split("/"),h=j.map,n=h&&h["*"];if(a){a=a.split("/");l=a.length-1;j.nodeIdCompat&&Q.test(a[l])&&(a[l]=a[l].replace(Q,""));"."===a[0].charAt(0)&&k&&(l=k.slice(0,k.length-1),a=l.concat(a));l=a;for(c=0;c<l.length;c++)if(d=l[c],"."===d)l.splice(c,1),c-=1;else if(".."===d&&!(0===c||1==c&&".."===l[2]||".."===l[c-1])&&0<c)l.splice(c-1,2),c-=2;a=a.join("/")}if(b&&h&&(k||n)){l=a.split("/");c=l.length;a:for(;0<c;c-=1){e=l.slice(0,c).join("/");if(k)for(d=k.length;0<d;d-=1)if(b=m(h,k.slice(0,d).join("/")))if(b=m(b,e)){f=b;g=c;break a}!i&&(n&&m(n,e))&&(i=m(n,e),p=c)}!f&&i&&(f=i,g=p);f&&(l.splice(0,g,f),a=l.join("/"))}return(f=m(j.pkgs,a))?f:a}function d(a){z&&v(document.getElementsByTagName("script"),function(k){if(k.getAttribute("data-requiremodule")===a&&k.getAttribute("data-requirecontext")===i.contextName)return k.parentNode.removeChild(k),!0})}function e(a){var k=m(j.paths,a);if(k&&H(k)&&1<k.length)return k.shift(),i.require.undef(a),i.makeRequire(null,{skipMap:!0})([a]),!0}function n(a){var k,c=a?a.indexOf("!"):-1;-1<c&&(k=a.substring(0,c),a=a.substring(c+1,a.length));return[k,a]}function p(a,k,b,f){var l,d,e=null,g=k?k.name:null,j=a,p=!0,h="";a||(p=!1,a="_@r"+(K+=1));a=n(a);e=a[0];a=a[1];e&&(e=c(e,g,f),d=m(r,e));a&&(e?h=d&&d.normalize?d.normalize(a,function(a){return c(a,g,f)}):-1===a.indexOf("!")?c(a,g,f):a:(h=c(a,g,f),a=n(h),e=a[0],h=a[1],b=!0,l=i.nameToUrl(h)));b=e&&!d&&!b?"_unnormalized"+(O+=1):"";return{prefix:e,name:h,parentMap:k,unnormalized:!!b,url:l,originalName:j,isDefine:p,id:(e?e+"!"+h:h)+b}}function s(a){var k=a.id,b=m(h,k);b||(b=h[k]=new i.Module(a));return b}function q(a,k,b){var f=a.id,c=m(h,f);if(t(r,f)&&(!c||c.defineEmitComplete))"defined"===k&&b(r[f]);else if(c=s(a),c.error&&"error"===k)b(c.error);else c.on(k,b)}function w(a,b){var c=a.requireModules,f=!1;if(b)b(a);else if(v(c,function(b){if(b=m(h,b))b.error=a,b.events.error&&(f=!0,b.emit("error",a))}),!f)g.onError(a)}function x(){R.length&&(ha.apply(A,[A.length,0].concat(R)),R=[])}function y(a){delete h[a];delete V[a]}function F(a,b,c){var f=a.map.id;a.error?a.emit("error",a.error):(b[f]=!0,v(a.depMaps,function(f,d){var e=f.id,g=m(h,e);g&&(!a.depMatched[d]&&!c[e])&&(m(b,e)?(a.defineDep(d,r[e]),a.check()):F(g,b,c))}),c[f]=!0)}function D(){var a,b,c=(a=1e3*j.waitSeconds)&&i.startTime+a<(new Date).getTime(),f=[],l=[],g=!1,h=!0;if(!W){W=!0;B(V,function(a){var i=a.map,j=i.id;if(a.enabled&&(i.isDefine||l.push(a),!a.error))if(!a.inited&&c)e(j)?g=b=!0:(f.push(j),d(j));else if(!a.inited&&(a.fetched&&i.isDefine)&&(g=!0,!i.prefix))return h=!1});if(c&&f.length)return a=C("timeout","Load timeout for modules: "+f,null,f),a.contextName=i.contextName,w(a);h&&v(l,function(a){F(a,{},{})});if((!c||b)&&g)if((z||ea)&&!X)X=setTimeout(function(){X=0;D()},50);W=!1}}function E(a){t(r,a[0])||s(p(a[0],null,!0)).init(a[1],a[2])}function I(a){var a=a.currentTarget||a.srcElement,b=i.onScriptLoad;a.detachEvent&&!Y?a.detachEvent("onreadystatechange",b):a.removeEventListener("load",b,!1);b=i.onScriptError;(!a.detachEvent||Y)&&a.removeEventListener("error",b,!1);return{node:a,id:a&&a.getAttribute("data-requiremodule")}}function J(){var a;for(x();A.length;){a=A.shift();if(null===a[0])return w(C("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));E(a)}}var W,Z,i,L,X,j={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},h={},V={},$={},A=[],r={},S={},aa={},K=1,O=1;L={require:function(a){return a.require?a.require:a.require=i.makeRequire(a.map)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports?r[a.map.id]=a.exports:a.exports=r[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return m(j.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}};Z=function(a){this.events=m($,a.id)||{};this.map=a;this.shim=m(j.shim,a.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};Z.prototype={init:function(a,b,c,f){f=f||{};if(!this.inited){this.factory=b;if(c)this.on("error",c);else this.events.error&&(c=u(this,function(a){this.emit("error",a)}));this.depMaps=a&&a.slice(0);this.errback=c;this.inited=!0;this.ignore=f.ignore;f.enabled||this.enabled?this.enable():this.check()}},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0;i.startTime=(new Date).getTime();var a=this.map;if(this.shim)i.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],u(this,function(){return a.prefix?this.callPlugin():this.load()}));else return a.prefix?this.callPlugin():this.load()}},load:function(){var a=this.map.url;S[a]||(S[a]=!0,i.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id;b=this.depExports;var f=this.exports,l=this.factory;if(this.inited)if(this.error)this.emit("error",this.error);else{if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(G(l)){if(this.events.error&&this.map.isDefine||g.onError!==ca)try{f=i.execCb(c,l,b,f)}catch(d){a=d}else f=i.execCb(c,l,b,f);this.map.isDefine&&void 0===f&&((b=this.module)?f=b.exports:this.usingExports&&(f=this.exports));if(a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",w(this.error=a)}else f=l;this.exports=f;if(this.map.isDefine&&!this.ignore&&(r[c]=f,g.onResourceLoad))g.onResourceLoad(i,this.map,this.depMaps);y(c);this.defined=!0}this.defining=!1;this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=p(a.prefix);this.depMaps.push(d);q(d,"defined",u(this,function(f){var l,d;d=m(aa,this.map.id);var e=this.map.name,P=this.map.parentMap?this.map.parentMap.name:null,n=i.makeRequire(a.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(f.normalize&&(e=f.normalize(e,function(a){return c(a,P,!0)})||""),f=p(a.prefix+"!"+e,this.map.parentMap),q(f,"defined",u(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),d=m(h,f.id)){this.depMaps.push(f);if(this.events.error)d.on("error",u(this,function(a){this.emit("error",a)}));d.enable()}}else d?(this.map.url=i.nameToUrl(d),this.load()):(l=u(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),l.error=u(this,function(a){this.inited=!0;this.error=a;a.requireModules=[b];B(h,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&y(a.map.id)});w(a)}),l.fromText=u(this,function(f,c){var d=a.name,e=p(d),P=M;c&&(f=c);P&&(M=!1);s(e);t(j.config,b)&&(j.config[d]=j.config[b]);try{g.exec(f)}catch(h){return w(C("fromtexteval","fromText eval for "+b+" failed: "+h,h,[b]))}P&&(M=!0);this.depMaps.push(e);i.completeLoad(d);n([d],l)}),f.load(a.name,n,l,j))}));i.enable(d,this);this.pluginMaps[d.id]=d},enable:function(){V[this.map.id]=this;this.enabling=this.enabled=!0;v(this.depMaps,u(this,function(a,b){var c,f;if("string"===typeof a){a=p(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap);this.depMaps[b]=a;if(c=m(L,a.id)){this.depExports[b]=c(this);return}this.depCount+=1;q(a,"defined",u(this,function(a){this.defineDep(b,a);this.check()}));this.errback&&q(a,"error",u(this,this.errback))}c=a.id;f=h[c];!t(L,c)&&(f&&!f.enabled)&&i.enable(a,this)}));B(this.pluginMaps,u(this,function(a){var b=m(h,a.id);b&&!b.enabled&&i.enable(a,this)}));this.enabling=!1;this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]);c.push(b)},emit:function(a,b){v(this.events[a],function(a){a(b)});"error"===a&&delete this.events[a]}};i={config:j,contextName:b,registry:h,defined:r,urlFetched:S,defQueue:A,Module:Z,makeModuleMap:p,nextTick:g.nextTick,onError:w,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=j.shim,c={paths:!0,bundles:!0,config:!0,map:!0};B(a,function(a,b){c[b]?(j[b]||(j[b]={}),U(j[b],a,!0,!0)):j[b]=a});a.bundles&&B(a.bundles,function(a,b){v(a,function(a){a!==b&&(aa[a]=b)})});a.shim&&(B(a.shim,function(a,c){H(a)&&(a={deps:a});if((a.exports||a.init)&&!a.exportsFn)a.exportsFn=i.makeShimExports(a);b[c]=a}),j.shim=b);a.packages&&v(a.packages,function(a){var b,a="string"===typeof a?{name:a}:a;b=a.name;a.location&&(j.paths[b]=a.location);j.pkgs[b]=a.name+"/"+(a.main||"main").replace(ia,"").replace(Q,"")});B(h,function(a,b){!a.inited&&!a.map.unnormalized&&(a.map=p(b))});if(a.deps||a.callback)i.require(a.deps||[],a.callback)},makeShimExports:function(a){return function(){var b;a.init&&(b=a.init.apply(ba,arguments));return b||a.exports&&da(a.exports)}},makeRequire:function(a,e){function j(c,d,m){var n,q;e.enableBuildCallback&&(d&&G(d))&&(d.__requireJsBuild=!0);if("string"===typeof c){if(G(d))return w(C("requireargs","Invalid require call"),m);if(a&&t(L,c))return L[c](h[a.id]);if(g.get)return g.get(i,c,a,j);n=p(c,a,!1,!0);n=n.id;return!t(r,n)?w(C("notloaded",'Module name "'+n+'" has not been loaded yet for context: '+b+(a?"":". Use require([])"))):r[n]}J();i.nextTick(function(){J();q=s(p(null,a));q.skipMap=e.skipMap;q.init(c,d,m,{enabled:!0});D()});return j}e=e||{};U(j,{isBrowser:z,toUrl:function(b){var d,e=b.lastIndexOf("."),k=b.split("/")[0];if(-1!==e&&(!("."===k||".."===k)||1<e))d=b.substring(e,b.length),b=b.substring(0,e);return i.nameToUrl(c(b,a&&a.id,!0),d,!0)},defined:function(b){return t(r,p(b,a,!1,!0).id)},specified:function(b){b=p(b,a,!1,!0).id;return t(r,b)||t(h,b)}});a||(j.undef=function(b){x();var c=p(b,a,!0),e=m(h,b);d(b);delete r[b];delete S[c.url];delete $[b];T(A,function(a,c){a[0]===b&&A.splice(c,1)});e&&(e.events.defined&&($[b]=e.events),y(b))});return j},enable:function(a){m(h,a.id)&&s(a).enable()},completeLoad:function(a){var b,c,d=m(j.shim,a)||{},g=d.exports;for(x();A.length;){c=A.shift();if(null===c[0]){c[0]=a;if(b)break;b=!0}else c[0]===a&&(b=!0);E(c)}c=m(h,a);if(!b&&!t(r,a)&&c&&!c.inited){if(j.enforceDefine&&(!g||!da(g)))return e(a)?void 0:w(C("nodefine","No define call for "+a,null,[a]));E([a,d.deps||[],d.exportsFn])}D()},nameToUrl:function(a,b,c){var d,e,h;(d=m(j.pkgs,a))&&(a=d);if(d=m(aa,a))return i.nameToUrl(d,b,c);if(g.jsExtRegExp.test(a))d=a+(b||"");else{d=j.paths;a=a.split("/");for(e=a.length;0<e;e-=1)if(h=a.slice(0,e).join("/"),h=m(d,h)){H(h)&&(h=h[0]);a.splice(0,e,h);break}d=a.join("/");d+=b||(/^data\:|\?/.test(d)||c?"":".js");d=("/"===d.charAt(0)||d.match(/^[\w\+\.\-]+:/)?"":j.baseUrl)+d}return j.urlArgs?d+((-1===d.indexOf("?")?"?":"&")+j.urlArgs):d},load:function(a,b){g.load(i,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||ja.test((a.currentTarget||a.srcElement).readyState))N=null,a=I(a),i.completeLoad(a.id)},onScriptError:function(a){var b=I(a);if(!e(b.id))return w(C("scripterror","Script error for: "+b.id,a,[b.id]))}};i.require=i.makeRequire();return i}var g,x,y,D,I,E,N,J,s,O,ka=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,la=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,Q=/\.js$/,ia=/^\.\//;x=Object.prototype;var K=x.toString,fa=x.hasOwnProperty,ha=Array.prototype.splice,z=!!("undefined"!==typeof window&&"undefined"!==typeof navigator&&window.document),ea=!z&&"undefined"!==typeof importScripts,ja=z&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,Y="undefined"!==typeof opera&&"[object Opera]"===opera.toString(),F={},q={},R=[],M=!1;if("undefined"===typeof define){if("undefined"!==typeof requirejs){if(G(requirejs))return;q=requirejs;requirejs=void 0}"undefined"!==typeof require&&!G(require)&&(q=require,require=void 0);g=requirejs=function(b,c,d,e){var n,p="_";!H(b)&&"string"!==typeof b&&(n=b,H(c)?(b=c,c=d,d=e):b=[]);n&&n.context&&(p=n.context);(e=m(F,p))||(e=F[p]=g.s.newContext(p));n&&e.configure(n);return e.require(b,c,d)};g.config=function(b){return g(b)};g.nextTick="undefined"!==typeof setTimeout?function(b){setTimeout(b,4)}:function(b){b()};require||(require=g);g.version="2.1.15";g.jsExtRegExp=/^\/|:|\?|\.js$/;g.isBrowser=z;x=g.s={contexts:F,newContext:ga};g({});v(["toUrl","undef","defined","specified"],function(b){g[b]=function(){var c=F._;return c.require[b].apply(c,arguments)}});if(z&&(y=x.head=document.getElementsByTagName("head")[0],D=document.getElementsByTagName("base")[0]))y=x.head=D.parentNode;g.onError=ca;g.createNode=function(b){var c=b.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");c.type=b.scriptType||"text/javascript";c.charset="utf-8";c.async=!0;return c};g.load=function(b,c,d){var e=b&&b.config||{};if(z)return e=g.createNode(e,c,d),e.setAttribute("data-requirecontext",b.contextName),e.setAttribute("data-requiremodule",c),e.attachEvent&&!(e.attachEvent.toString&&0>e.attachEvent.toString().indexOf("[native code"))&&!Y?(M=!0,e.attachEvent("onreadystatechange",b.onScriptLoad)):(e.addEventListener("load",b.onScriptLoad,!1),e.addEventListener("error",b.onScriptError,!1)),e.src=d,J=e,D?y.insertBefore(e,D):y.appendChild(e),J=null,e;if(ea)try{importScripts(d),b.completeLoad(c)}catch(m){b.onError(C("importscripts","importScripts failed for "+c+" at "+d,m,[c]))}};z&&!q.skipDataMain&&T(document.getElementsByTagName("script"),function(b){y||(y=b.parentNode);if(I=b.getAttribute("data-main"))return s=I,q.baseUrl||(E=s.split("/"),s=E.pop(),O=E.length?E.join("/")+"/":"./",q.baseUrl=O),s=s.replace(Q,""),g.jsExtRegExp.test(s)&&(s=I),q.deps=q.deps?q.deps.concat(s):[s],!0});define=function(b,c,d){var e,g;"string"!==typeof b&&(d=c,c=b,b=null);H(c)||(d=c,c=null);!c&&G(d)&&(c=[],d.length&&(d.toString().replace(ka,"").replace(la,function(b,d){c.push(d)}),c=(1===d.length?["require"]:["require","exports","module"]).concat(c)));if(M){if(!(e=J))N&&"interactive"===N.readyState||T(document.getElementsByTagName("script"),function(b){if("interactive"===b.readyState)return N=b}),e=N;e&&(b||(b=e.getAttribute("data-requiremodule")),g=F[e.getAttribute("data-requirecontext")])}(g?g.defQueue:R).push([b,c,d])};define.amd={jQuery:!0};g.exec=function(b){return eval(b)};g(q)}})(this);(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){return e instanceof x?e:this instanceof x?void(this._wrapped=e):new x(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.6.0";var T=x.each=x.forEach=function(e,t,r){if(null==e)return e;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;s>i;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o=x.keys(e),i=0,s=o.length;s>i;i++)if(t.call(r,e[o[i]],o[i],e)===n)return;return e};x.map=x.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r.push(t.call(n,e,i,s))}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)}),!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}if(T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)}),!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){return t.call(n,e,i,s)?(r=e,!0):void 0}),r},x.filter=x.select=function(e,t,n){var r=[];
return null==e?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&r.push(e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){return(i=i&&t.call(r,e,s,o))?void 0:n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return null==e?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){return i||(i=t.call(r,e,s,o))?n:void 0}),!!i)};x.contains=x.include=function(e,t){return null==e?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,x.property(t))},x.where=function(e,t){return x.filter(e,x.matches(t))},x.findWhere=function(e,t){return x.find(e,x.matches(t))},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var r=-1/0,i=-1/0;return T(e,function(e,s,o){var u=t?t.call(n,e,s,o):e;u>i&&(r=e,i=u)}),r},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var r=1/0,i=1/0;return T(e,function(e,s,o){var u=t?t.call(n,e,s,o):e;i>u&&(r=e,i=u)}),r},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r},x.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=x.values(e)),e[x.random(e.length-1)]):x.shuffle(e).slice(0,Math.max(0,t))};var k=function(e){return null==e?x.identity:x.isFunction(e)?e:x.property(e)};x.sortBy=function(e,t,n){return t=k(t),x.pluck(x.map(e,function(e,r,i){return{value:e,index:r,criteria:t.call(n,e,r,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1}return e.index-t.index}),"value")};var L=function(e){return function(t,n,r){var i={};return n=k(n),T(t,function(s,o){var u=n.call(r,s,o,t);e(i,u,s)}),i}};x.groupBy=L(function(e,t,n){x.has(e,t)?e[t].push(n):e[t]=[n]}),x.indexBy=L(function(e,t,n){e[t]=n}),x.countBy=L(function(e,t){x.has(e,t)?e[t]++:e[t]=1}),x.sortedIndex=function(e,t,n,r){n=k(n);for(var i=n.call(r,t),s=0,o=e.length;o>s;){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},x.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return t&&x.every(e,x.isArray)?a.apply(n,e):(T(e,function(e){x.isArray(e)||x.isArguments(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n)};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.partition=function(e,t){var n=[],r=[];return T(e,function(e){(t(e)?n:r).push(e)}),[n,r]},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){(t?r&&o[o.length-1]===n:x.contains(o,n))||(o.push(n),s.push(e[r]))}),s},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.contains(t,e)})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=x.max(x.pluck(arguments,"length").concat(0)),t=new Array(e),n=0;e>n;n++)t[n]=x.pluck(arguments,""+n);return t},x.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;i>r;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);r>i;)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(S&&e.bind===S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){for(var n=0,r=t.slice(),i=0,s=r.length;s>i;i++)r[i]===x&&(r[i]=arguments[n++]);for(;n<arguments.length;)r.push(arguments[n++]);return e.apply(this,r)}},x.bindAll=function(e){var t=u.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:x.now(),o=null,s=e.apply(r,i),r=i=null};return function(){var f=x.now();u||n.leading!==!1||(u=f);var l=t-(f-u);return r=this,i=arguments,0>=l?(clearTimeout(o),o=null,u=f,s=e.apply(r,i),r=i=null):o||n.trailing===!1||(o=setTimeout(a,l)),s}},x.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=x.now()-o;t>f?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),s=i=null))};return function(){s=this,i=arguments,o=x.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},x.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return x.partial(t,e)},x.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},x.keys=function(e){if(!x.isObject(e))return[];if(E)return E(e);var t=[];for(var n in e)x.has(e,n)&&t.push(n);return t},x.values=function(e){for(var t=x.keys(e),n=t.length,r=new Array(n),i=0;n>i;i++)r[i]=e[t[i]];return r},x.pairs=function(e){for(var t=x.keys(e),n=t.length,r=new Array(n),i=0;n>i;i++)r[i]=[t[i],e[t[i]]];return r},x.invert=function(e){for(var t={},n=x.keys(e),r=0,i=n.length;i>r;r++)t[e[n[r]]]=n[r];return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]===void 0&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]==e)return r[s]==t;var o=e.constructor,u=t.constructor;if(o!==u&&!(x.isFunction(o)&&o instanceof o&&x.isFunction(u)&&u instanceof u)&&"constructor"in e&&"constructor"in t)return!1;n.push(e),r.push(t);var a=0,l=!0;if("[object Array]"==i){if(a=e.length,l=a==t.length)for(;a--&&(l=M(e[a],t[a],n,r)););}else{for(var c in e)if(x.has(e,c)&&(a++,!(l=x.has(t,c)&&M(e[c],t[c],n,r))))break;if(l){for(c in t)if(x.has(t,c)&&!a--)break;l=!a}}return n.pop(),r.pop(),l};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&1===e.nodeType},x.isArray=w||function(e){return"[object Array]"==f.call(e)},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),"function"!=typeof/./&&(x.isFunction=function(e){return"function"==typeof e}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==f.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.constant=function(e){return function(){return e}},x.property=function(e){return function(t){return t[e]}},x.matches=function(e){return function(t){if(t===e)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0}},x.times=function(e,t,n){for(var r=Array(Math.max(0,e)),i=0;e>i;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},x.now=Date.now||function(){return(new Date).getTime()};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(null==e)return void 0;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=++P+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(j,function(e){return"\\"+B[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}).call(this),function(e,t){if(typeof define=="function"&&define.amd)define("backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)});else if(typeof exports!="undefined"){var n=require("underscore");t(e,exports,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,r){var i=e.Backbone,s=[],o=s.push,u=s.slice,a=s.splice;t.VERSION="1.1.2",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var f=t.Events={on:function(e,t,n){if(!c(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!c(this,"once",e,[t,r])||!t)return this;var i=this,s=n.once(function(){i.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,r)},off:function(e,t,r){var i,s,o,u,a,f,l,h;if(!this._events||!c(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events=void 0,this;u=e?[e]:n.keys(this._events);for(a=0,f=u.length;a<f;a++){e=u[a];if(o=this._events[e]){this._events[e]=i=[];if(t||r)for(l=0,h=o.length;l<h;l++)s=o[l],(t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context)&&i.push(s);i.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=u.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&h(n,t),r&&h(r,arguments),this},stopListening:function(e,t,r){var i=this._listeningTo;if(!i)return this;var s=!t&&!r;!r&&typeof t=="object"&&(r=this),e&&((i={})[e._listenId]=e);for(var o in i)e=i[o],e.off(t,r,this),(s||n.isEmpty(e._events))&&delete this._listeningTo[o];return this}},l=/\s+/,c=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(l.test(n)){var s=n.split(l);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},h=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t);return}},p={listenTo:"on",listenToOnce:"once"};n.each(p,function(e,t){f[t]=function(t,r,i){var s=this._listeningTo||(this._listeningTo={}),o=t._listenId||(t._listenId=n.uniqueId("l"));return s[o]=t,!i&&typeof r=="object"&&(i=this),t[e](r,i,this),this}}),f.bind=f.on,f.unbind=f.off,n.extend(t,f);var d=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(d.prototype,f,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;typeof e=="object"?(s=e,r=t):(s={})[e]=t,r||(r={});if(!this._validate(s,r))return!1;o=r.unset,a=r.silent,u=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=n.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)t=s[i],n.isEqual(c[i],t)||u.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete c[i]:c[i]=t;if(!a){u.length&&(this._pending=r);for(var h=0,p=u.length;h<p;h++)this.trigger("change:"+u[h],this,c[u[h]],r)}if(f)return this;if(!a)while(this._pending)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,r=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;r&&r(t,n,e),t.trigger("sync",t,n,e)},I(this,e),this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u=this.attributes;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,r=n.extend({validate:!0},r);if(i&&!r.wait){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},u,i)),r.parse===void 0&&(r.parse=!0);var a=this,f=r.success;return r.success=function(e){a.attributes=u;var t=a.parse(e,r);r.wait&&(t=n.extend(i||{},t));if(n.isObject(t)&&!a.set(t,r))return!1;f&&f(a,e,r),a.trigger("sync",a,e,r)},I(this,r),s=this.isNew()?"create":r.patch?"patch":"update",s==="patch"&&(r.attrs=i),o=this.sync(s,this,r),i&&r.wait&&(this.attributes=u),o},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(n){(e.wait||t.isNew())&&i(),r&&r(t,n,e),t.isNew()||t.trigger("sync",t,n,e)};if(this.isNew())return e.success(),!1;I(this,e);var s=this.sync("delete",this,e);return e.wait||i(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||F();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t,{validationError:r})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];n.each(v,function(e){d.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var m=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,remove:!1};n.extend(m.prototype,f,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,y))},remove:function(e,t){var r=!n.isArray(e);e=r?[e]:n.clone(e),t||(t={});var i,s,o,u;for(i=0,s=e.length;i<s;i++){u=e[i]=this.get(e[i]);if(!u)continue;delete this._byId[u.id],delete this._byId[u.cid],o=this.indexOf(u),this.models.splice(o,1),this.length--,t.silent||(t.index=o,u.trigger("remove",u,this,t)),this._removeReference(u,t)}return r?e[0]:e},set:function(e,t){t=n.defaults({},t,g),t.parse&&(e=this.parse(e,t));var r=!n.isArray(e);e=r?e?[e]:[]:n.clone(e);var i,s,o,u,a,f,l,c=t.at,h=this.model,p=this.comparator&&c==null&&t.sort!==!1,v=n.isString(this.comparator)?this.comparator:null,m=[],y=[],b={},w=t.add,E=t.merge,S=t.remove,x=!p&&w&&S?[]:!1;for(i=0,s=e.length;i<s;i++){a=e[i]||{},a instanceof d?o=u=a:o=a[h.prototype.idAttribute||"id"];if(f=this.get(o))S&&(b[f.cid]=!0),E&&(a=a===u?u.attributes:a,t.parse&&(a=f.parse(a,t)),f.set(a,t),p&&!l&&f.hasChanged(v)&&(l=!0)),e[i]=f;else if(w){u=e[i]=this._prepareModel(a,t);if(!u)continue;m.push(u),this._addReference(u,t)}u=f||u,x&&(u.isNew()||!b[u.id])&&x.push(u),b[u.id]=!0}if(S){for(i=0,s=this.length;i<s;++i)b[(u=this.models[i]).cid]||y.push(u);y.length&&this.remove(y,t)}if(m.length||x&&x.length){p&&(l=!0),this.length+=m.length;if(c!=null)for(i=0,s=m.length;i<s;i++)this.models.splice(c+i,0,m[i]);else{x&&(this.models.length=0);var T=x||m;for(i=0,s=T.length;i<s;i++)this.models.push(T[i])}}l&&this.sort({silent:!0});if(!t.silent){for(i=0,s=m.length;i<s;i++)(u=m[i]).trigger("add",u,this,t);(l||x&&x.length)&&this.trigger("sort",this,t)}return r?e[0]:e},reset:function(e,t){t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return u.apply(this.models,arguments)},get:function(e){return e==null?void 0:this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t(r,n,e),r.trigger("sync",r,n,e)},I(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,i=t.success;return t.success=function(e,n){t.wait&&r.add(e,t),i&&i(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e;t=t?n.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_addReference:function(e,t){this._byId[e.cid]=e,e.id!=null&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(b,function(e){m.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var w=["groupBy","countBy","sortBy","indexBy"];n.each(w,function(e){m.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var E=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,x)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];n.extend(E.prototype,f,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)continue;var i=t.match(S),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.on(s,r):this.$el.on(s,o,r)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}else this.setElement(n.result(this,"el"),!1)}}),t.sync=function(e,r,i){var s=N[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||F()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1),o.type==="PATCH"&&T&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,a,i),a};var T=typeof window!="undefined"&&!!window.ActiveXObject&&(!window.XMLHttpRequest||!(new XMLHttpRequest).dispatchEvent),N={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,A=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(C.prototype,f,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);s.execute(i,o),s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(k,"(?:$1)?").replace(L,function(e,t){return t?e:"([^/?]+)"}).replace(A,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e,t){return t===r.length-1?e||null:e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},_=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,P=/msie [\w.]+/,H=/\/$/,B=/#.*$/;M.started=!1,n.extend(M.prototype,f,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(H,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(_,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,s=P.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(D,"/");if(s&&this._wantsHashChange){var o=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=o.hide().appendTo("body")[0].contentWindow,this.navigate(r)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var u=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&u.hash&&(this.fragment=this.getHash().replace(_,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),M.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!M.started)return!1;if(!t||t===!0)t={trigger:!!t};var n=this.root+(e=this.getFragment(e||""));e=e.replace(B,"");if(this.fragment===e)return;this.fragment=e,e===""&&n!=="/"&&(n=n.slice(0,-1));if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new M;var j=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};d.extend=m.extend=C.extend=E.extend=M.extend=j;var F=function(){throw new Error('A "url" property or function must be specified')},I=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}};return t}),!function(e,t){var n=t.prototype.trim,r=t.prototype.trimRight,i=t.prototype.trimLeft,s=function(e){return e*1||0
},o=function(e,t){if(t<1)return"";var n="";while(t>0)t&1&&(n+=e),t>>=1,e+=e;return n},u=[].slice,a=function(e){return e==null?"\\s":e.source?e.source:"["+p.escapeRegExp(e)+"]"},f={lt:"<",gt:">",quot:'"',amp:"&",apos:"'"},l={};for(var c in f)l[f[c]]=c;l["'"]="#39";var h=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}var n=o,r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};return r.format=function(r,i){var s=1,o=r.length,u="",a,f=[],l,c,p,d,v,m;for(l=0;l<o;l++){u=e(r[l]);if(u==="string")f.push(r[l]);else if(u==="array"){p=r[l];if(p[2]){a=i[s];for(c=0;c<p[2].length;c++){if(!a.hasOwnProperty(p[2][c]))throw new Error(h('[_.sprintf] property "%s" does not exist',p[2][c]));a=a[p[2][c]]}}else p[1]?a=i[p[1]]:a=i[s++];if(/[^s]/.test(p[8])&&e(a)!="number")throw new Error(h("[_.sprintf] expecting number but found %s",e(a)));switch(p[8]){case"b":a=a.toString(2);break;case"c":a=t.fromCharCode(a);break;case"d":a=parseInt(a,10);break;case"e":a=p[7]?a.toExponential(p[7]):a.toExponential();break;case"f":a=p[7]?parseFloat(a).toFixed(p[7]):parseFloat(a);break;case"o":a=a.toString(8);break;case"s":a=(a=t(a))&&p[7]?a.substring(0,p[7]):a;break;case"u":a=Math.abs(a);break;case"x":a=a.toString(16);break;case"X":a=a.toString(16).toUpperCase()}a=/[def]/.test(p[8])&&p[3]&&a>=0?"+"+a:a,v=p[4]?p[4]=="0"?"0":p[4].charAt(1):" ",m=p[6]-t(a).length,d=p[6]?n(v,m):"",f.push(p[5]?a+d:d+a)}}return f.join("")},r.cache={},r.parse=function(e){var t=e,n=[],r=[],i=0;while(t){if((n=/^[^\x25]+/.exec(t))!==null)r.push(n[0]);else if((n=/^\x25{2}/.exec(t))!==null)r.push("%");else{if((n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t))===null)throw new Error("[_.sprintf] huh?");if(n[2]){i|=1;var s=[],o=n[2],u=[];if((u=/^([a-z_][a-z_\d]*)/i.exec(o))===null)throw new Error("[_.sprintf] huh?");s.push(u[1]);while((o=o.substring(u[0].length))!=="")if((u=/^\.([a-z_][a-z_\d]*)/i.exec(o))!==null)s.push(u[1]);else{if((u=/^\[(\d+)\]/.exec(o))===null)throw new Error("[_.sprintf] huh?");s.push(u[1])}n[2]=s}else i|=2;if(i===3)throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");r.push(n)}t=t.substring(n[0].length)}return r},r}(),p={VERSION:"2.3.0",isBlank:function(e){return e==null&&(e=""),/^\s*$/.test(e)},stripTags:function(e){return e==null?"":t(e).replace(/<\/?[^>]+>/g,"")},capitalize:function(e){return e=e==null?"":t(e),e.charAt(0).toUpperCase()+e.slice(1)},chop:function(e,n){return e==null?[]:(e=t(e),n=~~n,n>0?e.match(new RegExp(".{1,"+n+"}","g")):[e])},clean:function(e){return p.strip(e).replace(/\s+/g," ")},count:function(e,n){if(e==null||n==null)return 0;e=t(e),n=t(n);var r=0,i=0,s=n.length;for(;;){i=e.indexOf(n,i);if(i===-1)break;r++,i+=s}return r},chars:function(e){return e==null?[]:t(e).split("")},swapCase:function(e){return e==null?"":t(e).replace(/\S/g,function(e){return e===e.toUpperCase()?e.toLowerCase():e.toUpperCase()})},escapeHTML:function(e){return e==null?"":t(e).replace(/[&<>"']/g,function(e){return"&"+l[e]+";"})},unescapeHTML:function(e){return e==null?"":t(e).replace(/\&([^;]+);/g,function(e,n){var r;return n in f?f[n]:(r=n.match(/^#x([\da-fA-F]+)$/))?t.fromCharCode(parseInt(r[1],16)):(r=n.match(/^#(\d+)$/))?t.fromCharCode(~~r[1]):e})},escapeRegExp:function(e){return e==null?"":t(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},splice:function(e,t,n,r){var i=p.chars(e);return i.splice(~~t,~~n,r),i.join("")},insert:function(e,t,n){return p.splice(e,t,0,n)},include:function(e,n){return n===""?!0:e==null?!1:t(e).indexOf(n)!==-1},join:function(){var e=u.call(arguments),t=e.shift();return t==null&&(t=""),e.join(t)},lines:function(e){return e==null?[]:t(e).split("\n")},reverse:function(e){return p.chars(e).reverse().join("")},startsWith:function(e,n){return n===""?!0:e==null||n==null?!1:(e=t(e),n=t(n),e.length>=n.length&&e.slice(0,n.length)===n)},endsWith:function(e,n){return n===""?!0:e==null||n==null?!1:(e=t(e),n=t(n),e.length>=n.length&&e.slice(e.length-n.length)===n)},succ:function(e){return e==null?"":(e=t(e),e.slice(0,-1)+t.fromCharCode(e.charCodeAt(e.length-1)+1))},titleize:function(e){return e==null?"":t(e).replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},camelize:function(e){return p.trim(e).replace(/[-_\s]+(.)?/g,function(e,t){return t.toUpperCase()})},underscored:function(e){return p.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(e){return p.trim(e).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},classify:function(e){return p.titleize(t(e).replace(/_/g," ")).replace(/\s/g,"")},humanize:function(e){return p.capitalize(p.underscored(e).replace(/_id$/,"").replace(/_/g," "))},trim:function(e,r){return e==null?"":!r&&n?n.call(e):(r=a(r),t(e).replace(new RegExp("^"+r+"+|"+r+"+$","g"),""))},ltrim:function(e,n){return e==null?"":!n&&i?i.call(e):(n=a(n),t(e).replace(new RegExp("^"+n+"+"),""))},rtrim:function(e,n){return e==null?"":!n&&r?r.call(e):(n=a(n),t(e).replace(new RegExp(n+"+$"),""))},truncate:function(e,n,r){return e==null?"":(e=t(e),r=r||"...",n=~~n,e.length>n?e.slice(0,n)+r:e)},prune:function(e,n,r){if(e==null)return"";e=t(e),n=~~n,r=r!=null?t(r):"...";if(e.length<=n)return e;var i=function(e){return e.toUpperCase()!==e.toLowerCase()?"A":" "},s=e.slice(0,n+1).replace(/.(?=\W*\w*$)/g,i);return s.slice(s.length-2).match(/\w\w/)?s=s.replace(/\s*\S+$/,""):s=p.rtrim(s.slice(0,s.length-1)),(s+r).length>e.length?e:e.slice(0,s.length)+r},words:function(e,t){return p.isBlank(e)?[]:p.trim(e,t).split(t||/\s+/)},pad:function(e,n,r,i){e=e==null?"":t(e),n=~~n;var s=0;r?r.length>1&&(r=r.charAt(0)):r=" ";switch(i){case"right":return s=n-e.length,e+o(r,s);case"both":return s=n-e.length,o(r,Math.ceil(s/2))+e+o(r,Math.floor(s/2));default:return s=n-e.length,o(r,s)+e}},lpad:function(e,t,n){return p.pad(e,t,n)},rpad:function(e,t,n){return p.pad(e,t,n,"right")},lrpad:function(e,t,n){return p.pad(e,t,n,"both")},sprintf:h,vsprintf:function(e,t){return t.unshift(e),h.apply(null,t)},toNumber:function(e,t){return e?(e=p.trim(e),e.match(/^-?\d+(?:\.\d+)?$/)?s(s(e).toFixed(~~t)):NaN):0},numberFormat:function(e,t,n,r){if(isNaN(e)||e==null)return"";e=e.toFixed(~~t),r=typeof r=="string"?r:",";var i=e.split("."),s=i[0],o=i[1]?(n||".")+i[1]:"";return s.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+r)+o},strRight:function(e,n){if(e==null)return"";e=t(e),n=n!=null?t(n):n;var r=n?e.indexOf(n):-1;return~r?e.slice(r+n.length,e.length):e},strRightBack:function(e,n){if(e==null)return"";e=t(e),n=n!=null?t(n):n;var r=n?e.lastIndexOf(n):-1;return~r?e.slice(r+n.length,e.length):e},strLeft:function(e,n){if(e==null)return"";e=t(e),n=n!=null?t(n):n;var r=n?e.indexOf(n):-1;return~r?e.slice(0,r):e},strLeftBack:function(e,t){if(e==null)return"";e+="",t=t!=null?""+t:t;var n=e.lastIndexOf(t);return~n?e.slice(0,n):e},toSentence:function(e,t,n,r){t=t||", ",n=n||" and ";var i=e.slice(),s=i.pop();return e.length>2&&r&&(n=p.rtrim(t)+n),i.length?i.join(t)+n+s:s},toSentenceSerial:function(){var e=u.call(arguments);return e[3]=!0,p.toSentence.apply(p,e)},slugify:function(e){if(e==null)return"";var n="ąàáäâãåæćęèéëêìíïîłńòóöôõøùúüûñçżź",r="aaaaaaaaceeeeeiiiilnoooooouuuunczz",i=new RegExp(a(n),"g");return e=t(e).toLowerCase().replace(i,function(e){var t=n.indexOf(e);return r.charAt(t)||"-"}),p.dasherize(e.replace(/[^\w\s-]/g,""))},surround:function(e,t){return[t,e,t].join("")},quote:function(e){return p.surround(e,'"')},exports:function(){var e={};for(var t in this){if(!this.hasOwnProperty(t)||t.match(/^(?:include|contains|reverse)$/))continue;e[t]=this[t]}return e},repeat:function(e,n,r){if(e==null)return"";n=~~n;if(r==null)return o(t(e),n);for(var i=[];n>0;i[--n]=e);return i.join(r)},levenshtein:function(e,n){if(e==null&&n==null)return 0;if(e==null)return t(n).length;if(n==null)return t(e).length;e=t(e),n=t(n);var r=[],i,s;for(var o=0;o<=n.length;o++)for(var u=0;u<=e.length;u++)o&&u?e.charAt(u-1)===n.charAt(o-1)?s=i:s=Math.min(r[u],r[u-1],i)+1:s=o+u,i=r[u],r[u]=s;return r.pop()}};p.strip=p.trim,p.lstrip=p.ltrim,p.rstrip=p.rtrim,p.center=p.lrpad,p.rjust=p.lpad,p.ljust=p.rpad,p.contains=p.include,p.q=p.quote,typeof exports!="undefined"&&(typeof module!="undefined"&&module.exports&&(module.exports=p),exports._s=p),typeof define=="function"&&define.amd&&define("underscore.string",[],function(){return p}),e._=e._||{},e._.string=e._.str=p}(this,String),define("ext/underscore",["underscore","underscore.string"],function(e,t){return e.mixin(t.exports()),e.mixin({assert:function(e,t){if(!e)throw t||"assertion failed"},getProperty:function(t,n){return t&&t[n]?e.isFunction(t[n])?t[n].apply(t):t[n]:null},bindToMethods:function(t){var n=e.functions(t);return e.each(n,function(n){t[n]=e.bind(t[n],t)}),t}}),e.noConflict()}),define("native",["ext/underscore","jquery","lib/json2","backbone"],function(e,t,n,r){var i=t("#clinked-portal"),s={thirdPartySignin:!0,popupPreview:!0,navigate:function(e){r.history.loadUrl(e),window.localStorage.setItem("native_location",e)},height:function(){return i.height()},resumeAt:function(e){e(window.localStorage.getItem("native_location"))},preview:function(e){t(".loader").addClass("hidden");var n=t("<iframe>").css({margin:"0 auto",display:"block",height:"600px"}).attr("src",e);t(".modal-dialog").css("width","800px"),t(".modal-title").html("Document Preview"),t(".modal-body").html(n),t(".modal").modal("show"),t(".modal-dialog").css("margin-left",function(){return(t(window).width()-t(this).width())/2})},setHeader:function(t){var n=e.pick(t,"title","nosearch");t.back&&(n.back=e.pick(t.back,"text","link")),t.action&&(n.action=e.pick(t.action,"text","link","target")),c(n)},list:!0},o=function(e,n){return t("<a>").attr("href","javascript:void(0);").html(e).data("target",n)},u=t(">.header",i).removeClass("hidden").on("click","a",function(e){e.preventDefault();var n=t(this).data("target");n?n.target?t(n.target).trigger("action"):s.navigate(n.link):(a.addClass("hidden"),f.removeClass("hidden").focus())}),a=t("span",u),f=t("input",u).keyup(function(e){e.keyCode==27?(a.removeClass("hidden"),f.addClass("hidden")):e.keyCode==13&&(iframe.postMessage({link:"#search/"+encodeURIComponent(f.val())},"*"),a.removeClass("hidden"),f.addClass("hidden").val(""))}),l="glyphicon glyphicon-search",c=function(e){var n=t(".left",u).empty();e.back&&n.append(o(e.back.text,e.back)),n.append("<strong>"+e.title+"</strong>");var r=t(".right",u).empty();e.action&&r.append(o(e.action.text,e.action)),e.nosearch||t("<a>").attr("href","javascript:void(0);").addClass(l).appendTo(r)};return i.on("click","a",function(t){this.href!="javascript:void(0)"&&!e.isBlank(this.hash)&&(t.preventDefault(),s.navigate(this.hash))}),t(">.wrapper",i).data("marginals",1).height(s.height()-44),s}),define("messages",["ext/underscore"],function(e){var t={m_last_updated:"Last updated",m_said:"said",m_comments:"Comments",m_comment:"Comment",m_new:"New",m_reply:"Reply",m_back:"Back",m_cancel:"Cancel",m_file:"File",m_page:"Page",m_discussion:"Discussion",m_event:"Event",m_task:"Task",m_edit:"Edit",m_post:"Post",m_save:"Save",m_preview:"Preview",m_download:"Download",m_search:"Search",m_on:"On",m_by:"by",m_all_day:"All day",m_to:"to",m_at:"at",m_version:"Version",m_size:"Size",m_today:"Today",m_tomorrow:"Tomorrow",m_assign:"Assign",m_mention:"Mention",m_mention_title:"Select A Person",m_make_comment:"Make A Comment",m_create_reply:"Create A Reply",m_create_discussion:"Create A Discussion",m_discussion_topic:"Enter Discussion Topic",m_discussion_first:"Enter First Comment",m_create_task:"Create A Task",m_update_task:"Update Task",m_task_title:"Enter Task Title",m_task_description:"Enter Task Description",m_task_duedate:"Select Due Date and Time, if applicable",m_task_status_NOT_STARTED:"Not Started",m_task_status_IN_PROGRESS:"In Progress",m_task_status_DEFERRED:"Deferred",m_task_status_WAITING:"Waiting",m_task_status_COMPLETED:"Complete",m_actions_filter:"Filter",m_actions_sort:"Sort",m_actions_upload:"Upload",m_btn_context:"Groups",m_btn_updates:"Activity",m_btn_files:"Files",m_btn_pages:"Pages",m_btn_discussions:"Disc..",m_btn_events:"Events",m_btn_tasks:"Tasks",m_context_select_header:"Select group or account",m_context_signout:"Sign out",m_context_dashboard:"Dashboard",m_context_personal:"Personal",m_page_loading:"Loading..",m_updates_nothing:"Nothing yet..",m_files_nothing:"No files",m_pages_nothing:"No Pages",m_discussions_nothing:"No Discussions",m_events_nothing:"No Events",m_tasks_nothing:"No Tasks",m_comments_nothing:"No Comments",m_search_nothing:"No Results",m_search_suggestions:"Did you mean",m_type_here:"Start typing here",m_file_uploader:"Uploaded by",m_file_preview_waiting:"Preview Generating ..",m_file_preview_failed:"No Preview Available",m_file_upload_header:"Upload A File",m_file_upload_failure:"Failed",m_file_upload_success:"Complete!",m_file_upload_add:"Add Files...",m_file_upload_start:"Start Upload",m_file_upload_cancel:"Cancel",m_file_upload_upload:"Upload",m_file_upload_retry:"Retry",m_file_upload_stop:"Stop",m_file_upload_remove:"Remove",m_file_native_header:"Select A File",m_file_native_failure:"There has been an error. Click to retry.",m_file_native_success:" has been uploaded",m_no_groups:"You do not have any groups",m_actions_sort_header:"Choose Sorting Option",m_actions_sort_latest:"Sort by most recent",m_actions_sort_name:"Sort by name",m_update_unknown:"Unknown Message",m_tasks_actions_header:"Choose Task Filter",m_tasks_actions_tbc:"Uncompleted",m_tasks_actions_all:"All Tasks",m_tasks_overdue:"Overdue",m_tasks_no_due_date:"No due date",m_tasks_requested_by:"Requested by",m_signin_title:"Sign in to Clinked",m_signin_domain:"Private Cloud Users Click Here",m_signin_username:"Enter username or email",m_signin_password:"Enter password",m_signin_signin:"Sign in",m_signin_linkedin:"Sign in using LinkedIn",m_signin_google:"Sign in using Google",m_signin_forgotten:"Forgotten Password?",m_signin_invalid:"Invalid username or password. Please try again.",m_signup_header:"Sign up to Clinked",m_signup_signup:"Sign up",m_reset_header:"Reset your Password",m_reset_reset:"Reset",m_input_signup:"Sign up",m_input_name:"Enter full name",m_input_error_name:"Please provide your full name",m_input_username:"Enter username",m_input_error_username:"Provide username",m_input_error_taken:"Username is taken, please choose again",m_input_password:"Enter password",m_input_error_password:"Provide password",m_input_error_minimum_6:"Minimum password length is 6 characters",m_input_confirm:"Re-enter password",m_input_error_mismatch:"Passwords do not match",m_input_error_confirm:"Confirm your password",m_input_telephone:"Enter phone number",m_input_organisation:"Enter organisation name",m_error_title:"Error",m_error_unexpected:"An unexpected error has occurred.",m_error_not_found:"The requested resource cannot be found.",m_error_dashboard:"Go To Dashboard",m_error_invite:"This invitation has not been recognised.",m_domain_title:"Change Domain",m_domain_value:"Enter new domain",m_domain_change:"Change",m_domain_reset:"Reset",m_forgotten_title:"Forgotten Password Request",m_forgotten_email:"Please enter your email address",m_forgotten_request:"Request",m_forgotten_request_sent:"Password reset instructions have been sent to your email address.",m_forgotten_request_fail:"Sorry, there is no account registered with that email address.",m_list_pull_to_refresh:"Pull and release to refresh",m_event_location:"Location",m_event_places:"Places Taken",m_event_of:"out of",m_event_DECLINE:"Not attending",m_event_MAYBE:"Maybe attending",m_event_ACCEPT:"Attending",m_task_due:"Due",m_task_no_due:"No due date",m_task_progress:"Progress",m_task_REJECT:"Reject",m_task_ACCEPT:"Accept",m_request_event_NONE:"Awaiting reply",m_request_event_DECLINE:"Not attending",m_request_event_MAYBE:"Maybe attending",m_request_event_ACCEPT:"Attending",m_request_task_NONE:"Awaiting reply",m_request_task_REJECT:"Rejected",m_request_task_ACCEPT:"Accepted",m_message_placeholder:"Enter message","update.organisation.create":"{0} created account {1}","update.organisation.disable":"{0} disabled account {1}","update.organisation.enabled":"{0} enabled account {1}","update.user.private":"{0} said","update.user.profile":"{0} said to {4}","update.organisation.private":"{0} in {1} said","update.organisation.join":"{0} joined {1}","update.space.private":"{0} in {2} said","update.following.start":"{0} started following {3} in {2}","update.following.stop":"{0} stopped following {3} in {2}","update.discussion.create":"{0} created new discussion {3} in {2}","update.discussion.update":"{0} updated discussion {3} in {2}","update.discussion.createreply":"{0} replied to discussion {3} in {2}","update.space.create":"{0} created a new group {2}","update.space.join":"{0} joined {2} group","update.trash.remove":"{0} deleted group {2}","update.trash.restore":"{0} restored group {2}","update.trash.delete":"{0} deleted group {2} from {1} trash","update.filestore.create":"{0} uploaded file {3} in {2}","update.filestore.update":"{0} updated file {3} in {2}","update.filestore.folder":"{0} created folder {3} in {2}","update.filestore.rename":'{0} renamed folder "{5}" to {3} in {2}',"update.filestore.move":'{0} moved {3} to "{5}" in {2}',"update.filestore.copy":'{0} copied {3} to "{5}" in {2}',"update.filestore.approval.accept":"{0} approved file {3} in {2}","update.filestore.approval.reject":"{0} rejected file {3} in {2} ","update.event.create":"{0} created event {3} in {2}","update.event.createandassign":"{0} created event {3} in {2}","update.event.update":"{0} updated event {3} in {2}","update.event.updateandassign":"{0} updated event {3} in {2}","update.task.create":"{0} created task {3} in {2}","update.task.createandassign":"{0} created task {3} in {2}","update.task.update":"{0} updated task {3} in {2}","update.task.updateandassign":"{0} updated task {3} in {2}","update.task.complete":"{0} completed task {3} in {2}","update.task.reopen":"{0} marked task {3} as incomplete in {2}","update.attachment.create":"{0} attached file {5} to {3} in {2}","update.attachment.update":"{0} updated attachment {5} in {3}","update.comment.create":"{0} commented on {3} in {2}","update.comment.delete":"{0} deleted comment from {3} in {2}","update.comment.reply":"{0} replied on {3} in {2}","update.page.create":"{0} created new page {3} in {2}","update.page.update":"{0} updated page {3} in {2}","update.page.restore":"{0} restored page {3} version {5} in {2}","update.page.renameandupdate":"{0} moved page {5} to {3} in {2}","update.space.trash.filerecord.create":"{0} deleted file {3} in {2}","update.space.trash.filerecord.attemptRestore":"{0} restored file {3} in {2}","update.space.trash.filerecord.delete":"{0} permanently deleted file {3} from {2} trash","update.space.trash.page.create":"{0} deleted page {3} in {2}","update.space.trash.page.attemptRestore":"{0} restored page {3} in {2}","update.space.trash.page.delete":"{0} permanently deleted page {3} from {2} trash","update.space.trash.discussion.create":"{0} deleted discussion {3} in {2}","update.space.trash.discussion.attemptRestore":"{0} restored discussion {3} in {2}","update.space.trash.discussion.delete":"{0} permanently deleted discussion {3} from {2} trash","update.space.trash.event.create":"{0} deleted event {3} in {2}","update.space.trash.event.attemptRestore":"{0} restored event {3} in {2}","update.space.trash.event.delete":"{0} permanently deleted event {3} from {2} trash","update.space.trash.task.create":"{0} deleted task {3} in {2}","update.space.trash.task.attemptRestore":"{0} restored task {3} in {2}","update.space.trash.task.delete":"{0} permanently deleted task {3} from {2} trash","update.space.rename":"{0} renamed group {5} to {2}","update.space.move":"{0} moved group {2} from {3}","update.space.remove":"{0} removed group {2}","update.space.restore":"{0} restored group {2} from trash","update.attachment.create.notify":"{0} attached the file {2} to {1} ","update.attachment.update.notify":"{0} updated the attachment {2} to {1}","update.discussion.createreply.notify":"{0} replied to discussion {1}","update.event.update.notify":"{0} edited the event {1}","update.event.updateandassign.notify":"{0} edited the event {1}","update.filestore.update.notify":"{0} edited the file {1}","update.filestore.folder.notify":"{0} created folder {1}","update.filestore.create.notify":"{0} created a new file {1}","update.page.update.notify":"{0} changed the page {1} ","update.page.renameandupdate.notify":"{0} changed the page {1}","update.space.trash.discussion.create.notify":"{0} deleted the discussion {1}","update.space.trash.event.create.notify":"{0} deleted the event {1}","update.space.trash.filerecord.create.notify":"{0} deleted the file {1}","update.space.trash.page.create.notify":"{0} deleted the page {1}","update.space.trash.task.create.notify":"{0} deleted the task {1}","update.space.trash.discussion.attemptRestore.notify":"{0} restored the discussion {1}","update.space.trash.event.attemptRestore.notify":"{0} restored the event {1}","update.space.trash.filerecord.attemptRestore.notify":"{0} restored the file {1}","update.space.trash.page.attemptRestore.notify":"{0} restored the page {1}","update.space.trash.task.attemptRestore.notify":"{0} restored the task {1}","update.task.complete.notify":"{0} completed the task {1}","update.task.reopen.notify":"{0} marked the task {1} as uncompleted ","update.task.update.notify":"{0} changed the task {1}","update.task.updateandassign.notify":"{0} changed the task {1}","update.comment.create.notify":"{0} commented on {1}","update.comment.reply.notify":"{0} commented on {1}"},n={};return n.tr={"update.user.private":"{0} söyledi","update.user.profile":"{0} {4} 'e söyledi","update.organisation.private":"{0} {1}'da söyledi","update.organisation.join":"{0} {1}'e katıldı","update.space.private":"{0} {2} grubunda söyledi","update.discussion.create":"{0} {2} grubunda {3} tartışmasını yarattı","update.discussion.update":"{0} {2} grubunda {3} tartışmasını güncelledi","update.discussion.createreply":"{0} {2} grubunda {3} tartışmasına yanıt verdi","update.space.create":"{0} {2} grubunu yarattı","update.space.join":"{0} {2} grubuna katıldı","update.trash.remove":"{0} {2} grubunu sildi","update.trash.restore":"{0} {2} grubunu geri getirdi","update.trash.delete":"{0} {2} grubunu {1} 'den sildi","update.filestore.create":"{0} {2} grubuna {3} dosyasını yükledi","update.filestore.update":"{0} {2} grubuna {3} dosyasını güncelledi","update.filestore.approval.accept":"{0} {2} grubunda {3} dosyasını onayladı","update.filestore.approval.reject":"{0} {2} grubunda {3} dosyasını reddetti ","update.event.create":"{0} {2} grubunda {3} etkinliğini yarattı","update.event.createandassign":"{0} {2} grubunda {3} etkinliğini yarattı","update.event.update":"{0} {2} grubunda {3} etkinliğini güncelledi","update.event.updateandassign":"{0} {2} grubunda {3} etkinliğini güncelledi","update.task.create":"{0} {2} grubunda {3} görevini yarattı","update.task.createandassign":"{0} {2} grubunda {3} görevini yarattı","update.task.update":"{0} {2} grubunda {3} görevini güncelledi","update.task.updateandassign":"{0} {2} grubunda {3} görevini güncelledi","update.task.complete":"{0} {2} grubunda {3} görevini tamamladı","update.task.reopen":"{0} {2} grubunda {3} görevini tamamladı","update.attachment.create":"{0} {5} dosyasını {2} grubunda {3} sayfasına ekledi ","update.attachment.update":"{0} {5} dosyasını {3}'de güncelledi","update.comment.create":"{0} {2} grubunda {3} sayfasına yorum yazdı ","update.comment.reply":"{0} {2} grubunda {3} yorumunu yanıtladı","update.page.create":"{0} {2} grubunda {3} sayfasını yarattı","update.page.update":"{0} {2} grubundaki {3} sayfasını güncelledi","update.page.restore":"{0} {2} grubundaki {3} sayfasının {5}. sürümünü geri yükledi","update.page.renameandupdate":"{0} {2} grubundaki {5} sayfasını {3} olarak değiştirdi","update.space.trash.filerecord.create":"{0} {3} dosyasını {2} grubundan sildi ","update.space.trash.filerecord.attemptRestore":"{0} {3} dosyasını {2} grubuna geri getirdi ","update.space.trash.filerecord.delete":"{0} {2} grubunda {3} dosyasını çöp kutusundan kalıcı olarak sildi","update.space.trash.page.create":"{0} {2} grubunda {3} sayfasını sildi","update.space.trash.page.attemptRestore":"{0} {2} grubunda {3} sayfasını geri getirdi ","update.space.trash.page.delete":"{0} {2} grubunda {3} sayfasını çöp kutusundan kalıcı olarak sildi","update.space.trash.discussion.create":"{0} {2} grubunda {3} tartışmasını sildi","update.space.trash.discussion.attemptRestore":"{0} {2} grubunda {3} tartışmasını geri getirdi","update.space.trash.discussion.delete":"{0} {2} grubunda {3} tartışmasını çöp kutusundan kalıcı olarak sildi","update.space.trash.event.create":"{0} {2} grubunda {3} etkinliğini sildi","update.space.trash.event.attemptRestore":"{0} {2} grubunda {3} etkinliğini geri getirdi","update.space.trash.event.delete":"{0} {2} grubunda {3} etkinliğini çöp kutusundan kalıcı olarak sildi","update.space.trash.task.create":"{0} {2} grubunda {3} görevini sildi","update.space.trash.task.attemptRestore":"{0} {2} grubunda {3} görevini geri getirdi","update.space.trash.task.delete":"{0} {2} grubunda {3} görevini çöp kutusundan kalıcı olarak sildi"},n.ru={"update.user.private":"{0}сказал","update.user.profile":"{0}сказал{4}","update.organisation.private":"{0}в{1} указанном","update.organisation.join":"{0}регистрация {1}","update.space.private":"{0}в{2} указанном","update.discussion.create":"создал новую дискуссию {3} в","update.discussion.update":"обновление обсуждения {3} в {2}","update.discussion.createreply":"{0} ответил на обсуждении {3} в {2}","update.space.create":"{0} создана новая группа {2}","update.space.join":"{0} присоединился к {2} группе","update.trash.remove":"{0} удален из группы {2}","update.trash.restore":"{0} восстановлено группы {2}","update.trash.delete":"{0} удален группы {2} из {1} корзины","update.filestore.create":"{0} загруженный файл {3} в {2}","update.filestore.update":"{0} обновленный файл {3} в {2}","update.filestore.approval.accept":"утвержденный файл {3} в {2}","update.filestore.approval.reject":"{0} отклонил файл {3} в {2} ","update.event.create":"{0} создано событие {3} в {2}","update.event.createandassign":"{0} создано событие {3} в {2}","update.event.update":"{0} обновленно событие {3} в {2}","update.event.updateandassign":"обновленно событие {3} в {2}","update.task.create":"{0} созданной задачи {3} в {2}","update.task.createandassign":"{0} созданной задачи {3} в {2}","update.task.update":"обновленно задачи {3} в {2}","update.task.updateandassign":"обновленно задачи {3} в {2}","update.task.complete":"выполненная задача {3} в {2}","update.task.reopen":"отмечены задачи {3}, как неполное в {2}","update.attachment.create":"{0} прикрепленный файл {5} до {3} в {2}","update.attachment.update":"{0} обновленно вложение {5} в {3}","update.comment.create":"{0} прокомментировал {3} в {2}","update.comment.reply":"{0} ответил на {3} в {2}","update.page.create":"{0} создана новая страница {3} в {2}","update.page.update":"{0} обновленна страница {3} в {2}","update.page.restore":"{0} восстановлена страница {3} версии {5} в {2}","update.page.renameandupdate":"{0} переехала страница {5} в {3} в {2}","update.space.trash.filerecord.create":"{0} удаленный файл {3} в {2}","update.space.trash.filerecord.attemptRestore":"{0} восстановленный файл {3} в {2}","update.space.trash.filerecord.delete":"{0} постоянно удаляется файл {3} из {2} корзины","update.space.trash.page.create":"{0} удаленная страница {3} в {2}","update.space.trash.page.attemptRestore":"{0} восстановлена страница {3} в {2}","update.space.trash.page.delete":"{0} удалена страница {3} из {2} корзины","update.space.trash.discussion.create":"{0} удалена страница {3} из {2} корзины","update.space.trash.discussion.attemptRestore":"{0} восстановлено обсуждение {3} в {2}","update.space.trash.discussion.delete":"{0} постоянно удалено обсуждение {3} из {2} корзины","update.space.trash.event.create":"{0} удалено событие {3} в {2}","update.space.trash.event.attemptRestore":"{0} восстановлено событие {3} в {2}","update.space.trash.event.delete":"{0} постоянно удалено событие {3} из {2} корзины","update.space.trash.task.create":"удалена задача {3} в {2}","update.space.trash.task.attemptRestore":"{0} восстановлена задача {3} в {2}","update.space.trash.task.delete":"{0} постоянно удалена задача {3} из {2} корзины"},n.it={"update.attachment.create":"{0} file allegati {5} di {3} in {2}","update.attachment.create.notify":"{0} ha allegato il file {2} di {1}","update.attachment.update":"{0} aggiornato file {5} di {3}","update.attachment.update.notify":"{0} aggiornato file {5} di {2}","update.comment.create":"{0} ha commentato su {3} di {2}","update.comment.create.notify":"{0} ha commentato su {1}","update.comment.delete":"{0} cancella commenti da {3} in {2}","update.comment.reply":"{0} risposte a {3} di {2}","update.comment.reply.notify":"{0} commenti su {1}","update.discussion.create":"{0} ha creato una nuova discussion {3} in {2}","update.discussion.createreply":"{0} ha risposto alla discussion {3} in {2}","update.discussion.createreply.notify":"{0} ha risposto alla discussion {1}","update.discussion.update":"{0} ha aggiornato la discussion {3} di {2}","update.event.create":"{0} ha creato l` event {3} in {2}","update.event.createandassign":"{0} {0} ha creato l` event {3} in {2}","update.event.update":"{0} event aggiornato {3} in {2}","update.event.update.notify":"{0} event modificati {1}","update.event.updateandassign":"{0} event aggiornato {3} in {2}","update.event.updateandassign.notify":"{0} event modificati {1}","update.filestore.approval.accept":"{0} file approvati {3} in {2}","update.filestore.approval.reject":"{0} file rifiutati {3} in {2}","update.filestore.copy":'{0} copiati {3} da "{5}" in {2}',"update.filestore.create":"{0} file caricati {3} in {2}","update.filestore.create.notify":"{0} nuovi file creati {3} in {2}","update.filestore.folder":"{0} cartelle create {3} in {2}","update.filestore.folder.notify":"{0} cartelle create {1}","update.filestore.move":'{0} spostato {3} da "{5}" a {2}',"update.filestore.rename":'{0} cartella rinominata "{5}" da {3} in {2}',"update.filestore.update":"{0} file caricati {3} in {2}","update.filestore.update.notify":"{0} modifca i file {1}","update.following.start":"{0} comincia a seguire {3} in {2}","update.following.stop":"{0} smette di seguire {3} in {2}","update.organisation.create":"{0} ha creato l`account {1} ","update.organisation.disable":"{0} ha disabilitato l`account {1}","update.organisation.enabled":"{0} ha abilitato l`account {1}","update.organisation.join":"{0} partecipa {1}","update.organisation.private":"{0} ha detto in {1} ","update.page.create":"{0} nuove page create {3} in {2}","update.page.renameandupdate":"{0} page spostate {5} da {3} in {2}","update.page.renameandupdate.notify":"{0} page cambiate {1}","update.page.restore":"{0} page aggiornate {3} in {2}","update.page.update":"{0} page aggiornate {3} in {2}","update.page.update.notify":"{0} page cambiate {1}","update.space.create":"{0} ha creato un nuovo gruppo {2}","update.space.join":"{0} si è unito al {2} gruppo","update.space.move":"{0} ha spostato il gruppo {2} da {3}","update.space.private":"{0} ha detto in {2}","update.space.remove":"{0} ha rimosso il gruppo {2}","update.space.rename":"{0} ha rinominato il gruppo {5} a {2}","update.space.restore":"{0} ha ripristinato il gruppo {2} dal cestino","update.space.trash.discussion.attemptRestore":"{0} ha ripristinato discussion  {3} in {2}","update.space.trash.discussion.attemptRestore.notify":"{0} ha ripristinato discussion  {1}","update.space.trash.discussion.create":"{0} ha cancellato la discussion {3} in {2}","update.space.trash.discussion.create.notify":"{0} ha cancellato la discussion {3} da {2} cestino","update.space.trash.discussion.delete":"{0} ha cancellato permanentemente la discussion {3} da {2} cestino","update.space.trash.event.attemptRestore":"{0} ha rispristinato event {3} di {2}","update.space.trash.event.attemptRestore.notify":"{0} ha ripristinato l` event {3} in {2}","update.space.trash.event.create":"{0} event ha cancellato {3} in {2}","update.space.trash.event.create.notify":"{0} ha cancellato l` event {1}","update.space.trash.event.delete":"{0} ha cancellato permanentemente event {3} da {2} cestino","update.space.trash.filerecord.attemptRestore":"{0} ha ripristinato file {3} in {2} ","update.space.trash.filerecord.attemptRestore.notify":"{0} ha ripristinato il file {1}","update.space.trash.filerecord.create":"{0} ha cancellato file {3} in {2}","update.space.trash.filerecord.create.notify":"{0} ha cancellato il file {1}","update.space.trash.filerecord.delete":"{0} ha cancellato permanentemente il/i file {3} da {2} cestino","update.space.trash.page.attemptRestore":"{0} ha ripristinato la/le page  {3} in {2}","update.space.trash.page.attemptRestore.notify":"{0} ha ripristinato la page {1}","update.space.trash.page.create":"{0} ha cancellato le page {3} in {2}","update.space.trash.page.create.notify":"{0} ha cancellato la page {1}","update.space.trash.page.delete":"{0} ha cancellato permanentemente le page {3} da {2} cestino","update.space.trash.task.attemptRestore":"{0} task ripristinato {3} in {2}","update.space.trash.task.attemptRestore.notify":"{0} ha ripristinato il compito task {1}","update.space.trash.task.create":"{0} task cancellati {3} in {2}","update.space.trash.task.create.notify":"{0} ha cancellato il compito task {1}","update.space.trash.task.delete":"{0} Cancellato permanentemente task {3} da {2}","update.task.complete":"{0} task completato {3} in {2}","update.task.complete.notify":"{0} completato il task {1}","update.task.create":"{0} task creati {3} in {2}","update.task.createandassign":"{0} task creati {3} in {2}","update.task.reopen":"{0} task segnati {3} come incompleti in {2}","update.task.reopen.notify":"{0} segnato il task come incompleto {1}","update.task.update":"{0} task aggiornati {3} in {2}","update.task.update.notify":"{0} ha cambiato il compito task {1}","update.task.updateandassign":"{0} task aggiornati {3} in {2}","update.task.updateandassign.notify":"{0} ha cambiato il compito task {1}","update.trash.delete":"{0} ha cancellato il gruppo {2} da {1} cestino","update.trash.remove":"{0} ha cancellato gruppo {2} da {1} cestino","update.trash.restore":"{0} ha cancellato gruppo {2}","update.user.private":"{0} ha detto","update.user.profile":"{0} ha detto a {4}"},{messages:t,template:function(n,r){return e.template(n,e.extend({},r,t))
},setLocale:function(r){var i=n[r];i?this.messages=e.extend(t,i):this.messages=t}}}),define("app-context",["ext/underscore","jquery","lib/json2","backbone","native","messages"],function(e,t,n,r,i,s){var o=null,u=t("#clinked-portal"),a=function(){return u.data("appurl")},f=e.extend({version:6,defaultThumb:a()+"/styles/images/default_thumbnail.png",environments:{prod:["https://api-p1.clinked.com","https://app.clinked.com","https://pubsub.clinked.com"],test:["https://test-api.clinked.com","https://test-app.clinked.com","https://test-pubsub.clinked.com"],dev:["http://localhost:18080/ROOT","http://localhost.localdomain:8080/ROOT","http://localhost:2222"],ip:["http://192.168.126.12:18080/ROOT","http://192.168.126.12:8080/ROOT","http://192.168.126.12:2222"],office4twenty:["https://api.office4twenty.com","https://app.office4twenty.com","https://pubsub.office4twenty.com"]},clientId:"clinked-mobile",pageSize:25,notificationUrls:{},getAppUrl:a,getCredentials:function(e){return o},setCredentials:function(e){o=e},removeCredentials:function(){o=null},setAccessToken:function(e){e.expires_in&&(e.expires=(new Date).getTime()+e.expires_in*1e3),window.localStorage.setItem("accessToken",n.stringify(e)),this.trigger("accessToken")},getAccessToken:function(){var e=window.localStorage.getItem("accessToken");if(e){var t=n.parse(e),r=(new Date).getTime();if(!t.expires||t.expires>r)return t}return null},removeAccessToken:function(){window.localStorage.removeItem("accessToken")},setTaskCompletedFilter:function(e){window.localStorage.setItem("taskCompletedFilter",e)},getTaskCompletedFilter:function(){return window.localStorage.getItem("taskCompletedFilter")=="true"},setFileSort:function(e){window.localStorage.setItem("fileSortField",e)},getFileSort:function(){var e=window.localStorage.getItem("fileSortField");return e?e:"lastModified"},setNoteSort:function(e){window.localStorage.setItem("noteSortField",e)},getNoteSort:function(){var e=window.localStorage.getItem("noteSortField");return e?e:"lastModified"},setPrinciple:function(e){window.localStorage.setItem("me",n.stringify(e)),l(e.locale)},getPrinciple:function(){var e=window.localStorage.getItem("me");return e?n.parse(e):null},removePrinciple:function(){window.localStorage.removeItem("me")},setDashboard:function(e){window.localStorage.setItem("dashboard",e)},getDashboard:function(){var e=window.localStorage.getItem("dashboard");return e&&e.indexOf(":@")==-1&&(e=e.replace(":",":@")),e},removeDashboard:function(){window.localStorage.removeItem("dashboard")},setEnvironment:function(e){e in this.environments&&(window.localStorage.setItem("environment",e),h())},getEnvironment:function(){var t=window.localStorage.getItem("environment");return t?t:e.keys(this.environments)[0]},resolveEndPoint:function(){return this.environments[this.getEnvironment()][0]},resolveAppEndPoint:function(){return this.environments[this.getEnvironment()][1]},resolvePubsubEndPoint:function(){return this.environments[this.getEnvironment()][2]},fullUrl:function(e){e+="?version="+this.version;var t=this.getAccessToken();return t&&(e+="&access_token="+t.access_token),this.resolveEndPoint()+e},preview:function(e,n){this.loading("show"),n?t.get(this.fullUrl(e.url()+"session"),function(e){i.preview(e,"text/html")}):i.preview(this.fullUrl(e.url()+"preview"),e.get("contentType"),e.id+"."+e.get("versions"))},loading:function(e){var n=t(".loader",u);e=="show"?n.removeClass("hidden"):e=="hide"&&n.addClass("hidden")},setHeader:function(e){e.back&&(e.back.text=s.messages[e.back.code]),e.action&&(e.action.text=s.messages[e.action.code]),i.setHeader(e)},navigate:function(e,t){window.location.hash==e?t&&r.history.loadUrl(e):i.navigate?i.navigate(e):window.location.hash=e},addNotification:function(n){this.notificationUrls[n]=!0,t(".notifications",u).removeClass("hidden").find("span").html(e.keys(this.notificationUrls).length)}},r.Events);t(".notifications",u).click(function(n){n.preventDefault();var r=e.keys(f.notificationUrls),i=r.pop();delete f.notificationUrls[i],f.navigate(i,!0);var s=t(".notifications",u);r.length==0?s.addClass("hidden"):s.find("span").html(r.length)});var l=function(e){s.setLocale(e);var n=t.timeago.regional[e];n&&(t.timeago.settings.strings=n)},c=f.getPrinciple();c&&l(c.locale);var h=function(){t.ajax({url:f.fullUrl("/config"),success:function(t){e.extend(f,t)},error:function(){f.navigate("#error",!0)}})};return h(),f}),define("api/sync",["ext/underscore","jquery","lib/json2","app-context"],function(e,t,n,r){var i=function(e){r.loading("show");var n=r.getAccessToken();n&&(e.headers={Authorization:"Bearer "+n.access_token});var i=t.ajax(e);i.request=e},s=function(e,s){var o=e.session?"session":e.password?"password":"refresh_token";t.ajax({type:"POST",url:r.resolveEndPoint()+"/oauth/token?grant_type="+o+"&client_id="+r.clientId,data:e,success:function(e,t,n){r.setAccessToken(e),i(s)},error:function(e,t,i){console.log(n.stringify(e)),console.log(n.stringify(t)),console.log(n.stringify(i)),r.removeCredentials(),r.navigate("#public/signin/m_signin_invalid",!0)}})},o=function(){var e=r.getCredentials();if(e)return e;var t=r.getAccessToken();return t&&t.refresh_token?{refresh_token:t.refresh_token}:null},u=function(e,t,n,i){r.loading("hide");if(i=="Unauthorized"){var u=o();u?s(u,t.request):r.navigate("#public/signin",!0)}else e(t,n,i),r.navigate("#error",!0)},a=function(e,t,n,i){r.loading("hide"),e(t,n,i)},f={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};return{getKey:function(){var t=e.result(this,"url").replace(/\//g,":").substr(1);return this._getKey?this._getKey(t):t},sync:function(s,o,l){var c={type:f[s],dataType:"json",cache:!1,url:r.resolveEndPoint()+e.getProperty(o,"url")+"?version="+r.version};l.success=e.wrap(l.success,a),l.error=e.wrap(l.error,u),o.params&&(c.url+="&"+t.param(o.params,!0)),o&&(s=="create"||s=="update")&&(c.contentType="application/json",c.data=n.stringify(o.toJSON())),c.type!=="GET"&&(c.processData=!1),i(e.extend(c,l))}}}),define("api/model/base",["ext/underscore","backbone","api/sync"],function(e,t,n){return t.Model.extend(n)}),define("api/model/account",["api/model/base"],function(e){return e.extend({initialize:function(){this.type="account"},url:function(){return"/accounts/@"+this.id},isUser:function(){return this.get("name").indexOf("@")==0}})}),function(e){function t(e,t,n,r){var i=n.lang();return i[e].call?i[e](n,r):i[e][t]}function n(e,t){return function(n){return u(e.call(this,n),t)}}function r(e){return function(t){var n=e.call(this,t);return n+this.lang().ordinal(n)}}function i(e,t,n){this._d=e,this._isUTC=!!t,this._a=e._a||null,this._lang=n||!1}function s(e){var t=this._data={},n=e.years||e.y||0,r=e.months||e.M||0,i=e.weeks||e.w||0,s=e.days||e.d||0,u=e.hours||e.h||0,a=e.minutes||e.m||0,f=e.seconds||e.s||0,l=e.milliseconds||e.ms||0;this._milliseconds=l+f*1e3+a*6e4+u*36e5,this._days=s+i*7,this._months=r+n*12,t.milliseconds=l%1e3,f+=o(l/1e3),t.seconds=f%60,a+=o(f/60),t.minutes=a%60,u+=o(a/60),t.hours=u%24,s+=o(u/24),s+=i*7,t.days=s%30,r+=o(s/30),t.months=r%12,n+=o(r/12),t.years=n,this._lang=!1}function o(e){return e<0?Math.ceil(e):Math.floor(e)}function u(e,t){var n=e+"";while(n.length<t)n="0"+n;return n}function a(e,t,n){var r=t._milliseconds,i=t._days,s=t._months,o;r&&e._d.setTime(+e+r*n),i&&e.date(e.date()+i*n),s&&(o=e.date(),e.date(1).month(e.month()+s*n).date(Math.min(o,e.daysInMonth())))}function f(e){return Object.prototype.toString.call(e)==="[object Array]"}function l(e,t){var n=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),i=0,s;for(s=0;s<n;s++)~~e[s]!==~~t[s]&&i++;return i+r}function c(e,t,n,r){var i,s,o=[];for(i=0;i<7;i++)o[i]=e[i]=e[i]==null?i===2?1:0:e[i];return e[7]=o[7]=t,e[8]!=null&&(o[8]=e[8]),e[3]+=n||0,e[4]+=r||0,s=new Date(0),t?(s.setUTCFullYear(e[0],e[1],e[2]),s.setUTCHours(e[3],e[4],e[5],e[6])):(s.setFullYear(e[0],e[1],e[2]),s.setHours(e[3],e[4],e[5],e[6])),s._a=o,s}function h(e,t){var n,r,i=[];!t&&D&&(t=require("./lang/"+e));for(n=0;n<P.length;n++)t[P[n]]=t[P[n]]||M.en[P[n]];for(n=0;n<12;n++)r=k([2e3,n]),i[n]=new RegExp("^"+(t.months[n]||t.months(r,""))+"|^"+(t.monthsShort[n]||t.monthsShort(r,"")).replace(".",""),"i");return t.monthsParse=t.monthsParse||i,M[e]=t,t}function p(e){var t=typeof e=="string"&&e||e&&e._lang||null;return t?M[t]||h(t):k}function d(e){return e.match(/\[.*\]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function v(e){var t=e.match(B),n,r;for(n=0,r=t.length;n<r;n++)tt[t[n]]?t[n]=tt[t[n]]:t[n]=d(t[n]);return function(i){var s="";for(n=0;n<r;n++)s+=typeof t[n].call=="function"?t[n].call(i,e):t[n];return s}}function m(e,t){function n(t){return e.lang().longDateFormat[t]||t}var r=5;while(r--&&j.test(t))t=t.replace(j,n);return Y[t]||(Y[t]=v(t)),Y[t](e)}function g(e){switch(e){case"DDDD":return R;case"YYYY":return U;case"S":case"SS":case"SSS":case"DDD":return q;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return z;case"Z":case"ZZ":return W;case"T":return X;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return I;default:return new RegExp(e.replace("\\",""))}}function y(e,t,n,r){var i,s;switch(e){case"M":case"MM":n[1]=t==null?0:~~t-1;break;case"MMM":case"MMMM":for(i=0;i<12;i++)if(p().monthsParse[i].test(t)){n[1]=i,s=!0;break}s||(n[8]=!1);break;case"D":case"DD":case"DDD":case"DDDD":t!=null&&(n[2]=~~t);break;case"YY":n[0]=~~t+(~~t>70?1900:2e3);break;case"YYYY":n[0]=~~Math.abs(t);break;case"a":case"A":r.isPm=(t+"").toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":n[3]=~~t;break;case"m":case"mm":n[4]=~~t;break;case"s":case"ss":n[5]=~~t;break;case"S":case"SS":case"SSS":n[6]=~~(("0."+t)*1e3);break;case"Z":case"ZZ":r.isUTC=!0,i=(t+"").match(K),i&&i[1]&&(r.tzh=~~i[1]),i&&i[2]&&(r.tzm=~~i[2]),i&&i[0]==="+"&&(r.tzh=-r.tzh,r.tzm=-r.tzm)}t==null&&(n[8]=!1)}function b(e,t){var n=[0,0,1,0,0,0,0],r={tzh:0,tzm:0},i=t.match(B),s,o;for(s=0;s<i.length;s++)o=(g(i[s]).exec(e)||[])[0],o&&(e=e.slice(e.indexOf(o)+o.length)),tt[i[s]]&&y(i[s],o,n,r);return r.isPm&&n[3]<12&&(n[3]+=12),r.isPm===!1&&n[3]===12&&(n[3]=0),c(n,r.isUTC,r.tzh,r.tzm)}function w(e,t){var n,r=e.match(F)||[],s,o=99,u,a,f;for(u=0;u<t.length;u++)a=b(e,t[u]),s=m(new i(a),t[u]).match(F)||[],f=l(r,s),f<o&&(o=f,n=a);return n}function E(e){var t="YYYY-MM-DDT",n;if(V.exec(e)){for(n=0;n<4;n++)if(J[n][1].exec(e)){t+=J[n][0];break}return W.exec(e)?b(e,t+" Z"):b(e,t)}return new Date(e)}function S(e,t,n,r,i){var s=i.relativeTime[e];return typeof s=="function"?s(t||1,!!n,e,r):s.replace(/%d/i,t||1)}function x(e,t,n){var r=A(Math.abs(e)/1e3),i=A(r/60),s=A(i/60),o=A(s/24),u=A(o/365),a=r<45&&["s",r]||i===1&&["m"]||i<45&&["mm",i]||s===1&&["h"]||s<22&&["hh",s]||o===1&&["d"]||o<=25&&["dd",o]||o<=45&&["M"]||o<345&&["MM",A(o/30)]||u===1&&["y"]||["yy",u];return a[2]=t,a[3]=e>0,a[4]=n,S.apply({},a)}function T(e,t){k.fn[e]=function(e){var n=this._isUTC?"UTC":"";return e!=null?(this._d["set"+n+t](e),this):this._d["get"+n+t]()}}function N(e){k.duration.fn[e]=function(){return this._data[e]}}function C(e,t){k.duration.fn["as"+e]=function(){return+this/t}}var k,L="1.7.2",A=Math.round,O,M={},_="en",D=typeof module!="undefined"&&module.exports,P="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),H=/^\/?Date\((\-?\d+)/i,B=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|.)/g,j=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?)/g,F=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,I=/\d\d?/,q=/\d{1,3}/,R=/\d{3}/,U=/\d{1,4}/,z=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,W=/Z|[\+\-]\d\d:?\d\d/i,X=/T/i,V=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,$="YYYY-MM-DDTHH:mm:ssZ",J=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],K=/([\+\-]|\d\d)/gi,Q="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),G={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},Y={},Z="DDD w M D d".split(" "),et="M D H h m s w".split(" "),tt={M:function(){return this.month()+1},MMM:function(e){return t("monthsShort",this.month(),this,e)},MMMM:function(e){return t("months",this.month(),this,e)},D:function(){return this.date()},DDD:function(){var e=new Date(this.year(),this.month(),this.date()),t=new Date(this.year(),0,1);return~~((e-t)/864e5+1.5)},d:function(){return this.day()},dd:function(e){return t("weekdaysMin",this.day(),this,e)},ddd:function(e){return t("weekdaysShort",this.day(),this,e)},dddd:function(e){return t("weekdays",this.day(),this,e)},w:function(){var e=new Date(this.year(),this.month(),this.date()-this.day()+5),t=new Date(e.getFullYear(),0,4);return~~((e-t)/864e5/7+1.5)},YY:function(){return u(this.year()%100,2)},YYYY:function(){return u(this.year(),4)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return u(~~(this.milliseconds()/10),2)},SSS:function(){return u(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+u(~~(e/60),2)+":"+u(~~e%60,2)},ZZ:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+u(~~(10*e/6),4)}};while(Z.length)O=Z.pop(),tt[O+"o"]=r(tt[O]);while(et.length)O=et.pop(),tt[O+O]=n(tt[O],2);tt.DDDD=n(tt.DDD,3),k=function(t,n){if(t===null||t==="")return null;var r,s;return k.isMoment(t)?new i(new Date(+t._d),t._isUTC,t._lang):(n?f(n)?r=w(t,n):r=b(t,n):(s=H.exec(t),r=t===e?new Date:s?new Date(+s[1]):t instanceof Date?t:f(t)?c(t):typeof t=="string"?E(t):new Date(t)),new i(r))},k.utc=function(e,t){return f(e)?new i(c(e,!0),!0):(typeof e=="string"&&!W.exec(e)&&(e+=" +0000",t&&(t+=" Z")),k(e,t).utc())},k.unix=function(e){return k(e*1e3)},k.duration=function(e,t){var n=k.isDuration(e),r=typeof e=="number",i=n?e._data:r?{}:e,o;return r&&(t?i[t]=e:i.milliseconds=e),o=new s(i),n&&(o._lang=e._lang),o},k.humanizeDuration=function(e,t,n){return k.duration(e,t===!0?null:t).humanize(t===!0?!0:n)},k.version=L,k.defaultFormat=$,k.lang=function(e,t){var n;if(!e)return _;(t||!M[e])&&h(e,t);if(M[e]){for(n=0;n<P.length;n++)k[P[n]]=M[e][P[n]];k.monthsParse=M[e].monthsParse,_=e}},k.langData=p,k.isMoment=function(e){return e instanceof i},k.isDuration=function(e){return e instanceof s},k.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(e){var t=e%10;return~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th"}}),k.fn=i.prototype={clone:function(){return k(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this._d.toString()},toDate:function(){return this._d},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds(),!!this._isUTC]},isValid:function(){return this._a?this._a[8]!=null?!!this._a[8]:!l(this._a,(this._a[7]?k.utc(this._a):k(this._a)).toArray()):!isNaN(this._d.getTime())},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(e){return m(this,e?e:k.defaultFormat)},add:function(e,t){var n=t?k.duration(+t,e):k.duration(e);return a(this,n,1),this},subtract:function(e,t){var n=t?k.duration(+t,e):k.duration(e);return a(this,n,-1),this},diff:function(e,t,n){var r=this._isUTC?k(e).utc():k(e).local(),i=(this.zone()-r.zone())*6e4,s=this._d-r._d-i,o=this.year()-r.year(),u=this.month()-r.month(),a=this.date()-r.date(),f;return t==="months"?f=o*12+u+a/30:t==="years"?f=o+(u+a/30)/12:f=t==="seconds"?s/1e3:t==="minutes"?s/6e4:t==="hours"?s/36e5:t==="days"?s/864e5:t==="weeks"?s/6048e5:s,n?f:A(f)},from:function(e,t){return k.duration(this.diff(e)).lang(this._lang).humanize(!t)},fromNow:function(e){return this.from(k(),e)},calendar:function(){var e=this.diff(k().sod(),"days",!0),t=this.lang().calendar,n=t.sameElse,r=e<-6?n:e<-1?t.lastWeek:e<0?t.lastDay:e<1?t.sameDay:e<2?t.nextDay:e<7?t.nextWeek:n;return this.format(typeof r=="function"?r.apply(this):r)},isLeapYear:function(){var e=this.year();return e%4===0&&e%100!==0||e%400===0},isDST:function(){return this.zone()<k([this.year()]).zone()||this.zone()<k([this.year(),5]).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return e==null?t:this.add({d:e-t})},startOf:function(e){switch(e.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(e){return this.startOf(e).add(e.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return k.utc([this.year(),this.month()+1,0]).date()},lang:function(t){return t===e?p(this):(this._lang=t,this)}};for(O=0;O<Q.length;O++)T(Q[O].toLowerCase(),Q[O]);T("year","FullYear"),k.duration.fn=s.prototype={weeks:function(){return o(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(e){var t=+this,n=this.lang().relativeTime,r=x(t,!e,this.lang()),i=t<=0?n.past:n.future;return e&&(typeof i=="function"?r=i(r):r=i.replace(/%s/i,r)),r},lang:k.fn.lang};for(O in G)G.hasOwnProperty(O)&&(C(O,G[O]),N(O.toLowerCase()));C("Weeks",6048e5),D&&(module.exports=k),typeof ender=="undefined"&&(this.moment=k),typeof define=="function"&&define.amd&&define("moment",[],function(){return k})}.call(this),define("ext/moment",["moment"],function(e){return e.fn.isToday=function(){var e=new Date;e.setHours(0,0,0,0);var t=new Date(this._d.getTime());return t.setHours(0,0,0,0),e.getTime()==t.getTime()},e.fn.isTomorrow=function(){var e=new Date;e.setHours(0,0,0,0);var t=new Date(this._d.getTime());return t.setHours(0,0,0,0),e.getTime()+864e5==t.getTime()},e.fn.isThisWeek=function(){return e().format("ww")==this.format("ww")},e.fn.isThisYear=function(){return e().format("YYYY")==this.format("YYYY")},e}),define("router/base",["ext/underscore","backbone","ext/moment"],function(e,t,n){return t.Router.extend({initialize:function(){e.bindToMethods(this)}})}),define("api/cache",["ext/underscore"],function(e){return{defaultExpireIn:10,cache:{},putModel:function(e,t){e._expiry=this.calcExpiry(t),this.cache[e.getKey()]=e},calcExpiry:function(e){return e||(e=this.defaultExpireIn),(new Date).getTime()+e*6e4},get:function(e){var t=this.cache[e];return t&&t._expiry>(new Date).getTime()?t:null},getFrom:function(e){var t=this.get(e.getKey());return t?t:e},clear:function(t){t?e.each(e.keys(this.cache),function(e){e.indexOf(t)==0&&delete this.cache[e]},this):this.cache={}}}}),define("api/collection/base",["backbone","api/sync"],function(e,t){return e.Collection.extend(t)}),define("api/model/user",["api/model/base"],function(e){return e.extend({})}),define("api/collection/users",["api/collection/base","api/model/user"],function(e,t){return e.extend({model:t,url:"/users",initialize:function(e,t){this.context=t.context,this.params={},this.params[this.context.type+"Id"]=this.context.id,this.params.allowSelf=t.allowSelf},_getKey:function(e){return e+":"+this.context.getKey()}})}),define("api/collection/accounts",["api/collection/base","api/model/account"],function(e,t){return e.extend({model:t,url:"/accounts"})}),define("api/model/group",["api/model/base"],function(e){return e.extend({initialize:function(){this.type="group"},url:function(){var e=this.id?"@"+this.id:this.get("name");return"/groups/"+e}})}),define("api/collection/groups",["api/collection/base","api/model/group"],function(e,t){return e.extend({model:t,url:"/groups"})}),define("api/collection/search",["ext/underscore","api/collection/base"],function(e,t){return t.extend({url:"/search",initialize:function(e,t){t&&(this.params=t.params)},parse:function(t){if(t instanceof Array){var n=[];return e.each(t,function(e){n.push({suggestion:e})}),this.suggestions=!0,n}return this.more=t.nextPage,t.page}})}),define("api/model/principle",["api/model/user"],function(e){return e.extend({url:"/me"})}),define("api/service/general",["ext/underscore","jquery","app-context","api/cache","api/collection/users","api/collection/accounts","api/collection/groups","api/collection/search","api/model/principle","api/model/account","api/model/group"],function(e,t,n,r,i,s,o,u,a,f,l){var c=function(e){e._expiry||r.putModel(e)},h=function(e,t,n){var r=new f;t.unshift(r);var i={};c(t),t.each(function(e){c(e),i[e.getKey()]=e,e.groups=[]},this),c(n),n.each(function(e){c(e);var t=new f(e.get("account"));t=i[t.getKey()],t||(t=r),t.groups.push(e)},this),e(t)},p=function(e,t,r){var i=new u([],{params:{currentPage:t,pageSize:n.pageSize,query:e}});i.once("sync",r),i.fetch()};return{getUsers:function(e,t,n){var s=r.getFrom(new i([],{context:e,allowSelf:n}));if(s._expiry){t(s);return}s.once("sync",function(){r.putModel(s),t(s)}),s.fetch()},fetchPrinciple:function(e){var t=new a;t.once("change",function(){e(t)}),t.fetch()},getSearchResults:function(e,t){p(e,1,t)},getNextSearchResults:function(e,t){p(e.params.query,e.params.currentPage+1,function(n){e.add(n.models),e.params.currentPage=n.params.currentPage,e.more=n.more,t(n)})},getAccountsWithGroups:function(t){var n=r.getFrom(new s),i=r.getFrom(new o),u=e.bind(e.after(2,h),this,t,n,i);n._expiry?u():(n.once("sync",u),n.fetch()),i._expiry?u():(i.once("sync",u),i.fetch())},getContext:function(e,t){var n=e.split(":@"),r=parseInt(n[1]);n[0]=="groups"?this.getGroup(r,t):this.getAccount(r,t)},getAccount:function(e,t){var n=r.getFrom(new f({id:e}));n._expiry?t(n):(n.once("change",function(){r.putModel(n),t(n)}),n.fetch())},getGroup:function(e,t){var n=r.getFrom(new l({id:e}));n._expiry&&n.get("components")?t(n):(n.once("change",function(){r.putModel(n),t(n)}),n.fetch())},getEmailFromInviteKey:function(e,r){t.ajax({url:n.resolveAppEndPoint()+"/signup/invited",data:{inviteKey:e},success:function(e){e.form?r(e.form.user.email):r()},error:function(){r()},dataType:"json"})},isUsernameTaken:function(e,r){t.get(n.resolveAppEndPoint()+"/signup/taken",{username:e},function(e){r(e.status)},"json")},createUser:function(e,r){n.loading("show"),t.ajax({type:"POST",url:n.resolveAppEndPoint()+"/signup/invited",data:e,success:function(){n.loading("hide"),r(!0)},error:function(){n.loading("hide"),r(!1)},dataType:"json"})},requestPasswordReset:function(e,r){n.loading("show"),t.ajax({type:"POST",url:n.resolveAppEndPoint()+"/password/forgotten",data:{email:e},success:function(e){n.loading("hide"),r(e._viewName=="organisation/password_forgotten_success")},error:function(){n.loading("hide"),r(!1)},dataType:"json"})},resetPassword:function(e,r,i,s){n.loading("show"),t.ajax({type:"POST",url:n.resolveAppEndPoint()+"/password/reset/"+e+"/"+r,data:i,success:function(e){n.loading("hide"),s(!0)},error:function(){n.loading("hide"),s(!1)},dataType:"json"})},deleteModel:function(e,t){e.destroy({wait:!0}),e.once("destroy",t)}}}),define("api/model/request",["api/model/base"],function(e){return e.extend({url:function(){var e="";return this.id&&(e="/"+this.id),this.collection?this.collection.url()+e:"/requests"+e}})}),define("view/base",["ext/underscore","jquery","backbone","app-context","messages"],function(e,t,n,r,i){var s=function(e){return i.messages[e]};return n.View.extend({initialize:function(t){e.bindToMethods(this),this.options=t},template:function(e,t){},template:function(n,s){if(s){var o=e.extend({messages:i.messages,$:t,appurl:r.getAppUrl()},s,i.messages);return e.template(n,o)}return e.template(n,i.messages)},message:s},{message:s})}),define("lib/pull",["ext/underscore","jquery"],function(e,t){var n=50,r,i,s,o,u,a=!1,f=!1;return{clear:function(e){s&&(t(">.refresh",s).addClass("hidden"),s.off("touchstart touchmove touchend"))},init:function(e){i=e.success?e.success:function(){},r=e.top?e.top:0,s=e.$wrapper?e.$wrapper:t();var l=t(">.refresh",s).css("line-height",n+"px").removeClass("hidden");e.text&&l.html(e.text);var c=t(">.view",s);c.css({position:"absolute",top:r+"px",width:"100%"}),s.on("touchstart",function(e){o=window.pageYOffset,u=e.originalEvent.touches[0].screenY}),s.on("touchend",function(e){if(f||a)c.css("top",r+"px"),f&&(i(),f=!1),a=!1}),s.on("touchmove",function(e){var t=o+(u-e.originalEvent.targetTouches[0].screenY);t<0&&(a=!0,e.preventDefault(),c.css("top",r-t+"px")),t<-n?f=!0:f=!1})}}}),define("view/page",["ext/underscore","jquery","view/base","lib/pull","native","app-context","api/service/general"],function(e,t,n,r,i,s,o){var u={};return n.extend({title:"Clinked",initialize:function(n){e.bindToMethods(this),this.options=n,this.$root=t("#clinked-portal"),this.$wrapper=t(">.wrapper",this.$root)},render:function(){r.clear();var e=(new Date).getTime();u[e]=this,this.$view=t("<div>").addClass("view").attr("id",e).append(this.el);var n=t(".view",this.$root),i=n.attr("id");i&&(u[i].remove(),u[i]=null),n.replaceWith(this.$view);if(this.navbar){this.$navigation=t("<div>").addClass("navigation");var o=this;this.navbar(function(e){o.$navigation.html(e.render().el),o.addFooter(o.$navigation)})}return this.branded?this.$view.addClass("branded"):this.$view.removeClass("branded"),this.action&&!this.action.link&&(this.action.target="#"+this.$view.attr("id"),this.$view.on("action",this.action.view.doAction)),s.setHeader(this),this},remove:function(){n.prototype.remove.apply(this,arguments),this.$navigation&&this.removeMarginal(this.$navigation)},scroll:function(e){this.$view.animate({scrollTop:e},"fast")},addHeader:function(e){t(">.header",this.$root).after(e.addClass("marginal")),this.updateMarginalCount(1)},addFooter:function(e){this.$wrapper.after(e.addClass("marginal")),this.updateMarginalCount(1)},removeMarginal:function(e){e.remove(),this.updateMarginalCount(-1)},updateMarginalCount:function(e){var t=this.$wrapper.data("marginals")+e,n=i.height()-t*44;this.$wrapper.data("marginals",t).height(n)}})}),define("view/extending-list",["ext/underscore","jquery","view/page"],function(e,t,n){return n.extend({tagName:"ul",className:"list-unstyled",initialize:function(r){n.prototype.initialize.apply(this,arguments),e(this.emptyMsgCode,"empty list message code required").assert(),e(this.itemViewClass,"list item view class required").assert(),e(this.handleEndOfList,"end of list handler required").assert(),this.$loading=t("<li>").addClass("thin").html(this.message("m_page_loading"))},render:function(){return n.prototype.render.apply(this,arguments),this.collection.length==0?t("<li>").addClass("thin").html(this.message(this.emptyMsgCode)).appendTo(this.$el):this._renderPage(this.collection),this},refresh:function(){this.$el.empty(),this.collection.length==0?t("<li>").addClass("thin").html(this.message(this.emptyMsgCode)).appendTo(this.$el):this._renderPage(this.collection)},renderPage:function(e){this.$loading.remove(),this._renderPage(e)},_renderPage:function(e){e.each(function(e){var t=new this.itemViewClass({model:e});this.$el.append(t.render().el)},this),e.more&&this.$loading.one("inview",this.handleEndOfList).appendTo(this.$el)},extractDateLabel:function(e){e=moment(e);var t;if(e.isToday())t=this.message("m_today");else if(e.isTomorrow())t=this.message("m_tomorrow");else{var n;e.isThisWeek(e)?n="dddd":e.isThisYear(e)?n="DD MMMM":n="DD MMMM YYYY",t=e.format(n)}return t}})}),define("api/model/content",["api/model/base","api/model/group"],function(e,t){return e.extend({url:function(){var e="";if(this.id)e="@"+this.id+"/";else{var t=this.get("name");t&&(e=t+"/")}return"/groups/@"+this.get("group").id+"/"+this.type+"s/"+e},getGroup:function(){return new t(this.get("group"))}})}),define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.3",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),n!==-1&&(t=i.substring(n+1,i.length),t=t==="strip",i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+"."+s.ext,h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.moduleName+"."+o.ext,a=r.toUrl(o.moduleName+"."+o.ext)+".js";t.load(u,r,function(n){var r=function(e){return i(a,e)};r.asModule=function(e,t){return i.asModule(e,a,t)},t.write(e,u,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r){var i=t.createXhr();i.open("GET",e,!0),c.onXhr&&c.onXhr(i,e),i.onreadystatechange=function(t){var s,o;i.readyState===4&&(s=i.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=i,r(o)):n(i.responseText))},i.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("text!text/search/item.html",[],function(){return"<a href=\"<%= link %>\">\n	<img src=\"<%= appurl %>/svg/<%= extension %>.svg\" onerror='this.onerror = null; this.src=\"<%= appurl %>/svg/file.svg\"'>\n	<p><b><%= get('name') %></b></p>\n	<abbr><%= m_last_updated %>: <%= $.timeago(new Date(get('timestamp'))) %></abbr>\n</a>\n"
}),define("view/search/item",["ext/underscore","view/base","api/model/content","text!text/search/item.html"],function(e,t,n,r){return t.extend({tagName:"li",className:"fat",render:function(){var t=this.model.get("name"),i=this.model.type;if(i=="file"){var s=t.split(".");i=s[s.length-1]}var o=new n({id:this.model.id,type:this.model.type,group:{id:this.model.get("space")}}),u=e.extend({link:"#"+this.model.type+"/"+o.getKey(),extension:i},this.model);return this.$el.html(this.template(r,u)),this}})}),define("view/search/list",["api/service/general","view/extending-list","view/search/item"],function(e,t,n){var r=t.extend({back:{code:"m_context_dashboard",link:"#updates/dashboard"},title:t.message("m_search"),emptyMsgCode:"m_search_nothing",itemViewClass:n,handleEndOfList:function(){e.getNextSearchResults(this.collection,this.renderPage)}});return r}),define("text!text/search/suggestions.html",[],function(){return'&nbsp;&nbsp;<%= m_search_suggestions %>\n<% _.each(suggestions, function(suggestion, index) { %><!--\n \n --><% if (index != 0) { %>,<% } %>\n	<a href="#search/<%= suggestion.suggestion %>"><%= suggestion.suggestion %></a><!-- \n	\n --><% }); %>?\n'}),define("view/search/suggestions",["ext/underscore","view/page","text!text/search/suggestions.html"],function(e,t,n){return t.extend({tagName:"h4",back:{code:"m_context_dashboard",link:"#updates/dashboard"},title:t.message("m_search_nothing"),render:function(){t.prototype.render.apply(this,arguments);if(this.collection.length>0){var e={suggestions:this.collection.toJSON()};this.$el.html(this.template(n,e))}return this}})}),define("view/dialog",["ext/underscore","jquery","view/base"],function(e,t,n){return n.extend({initialize:function(t){e.assert(t.callback,"callback required"),e.assert(this.title,"title required"),e.bindToMethods(this),this.options=t},render:function(){t(".modal-title").html(this.title),t(".modal-body").html(this.el);var e=t(".modal-dialog").css({width:this.options.width?this.options.width:"400px"});return t(".modal").modal("show"),e.css("margin-left",function(){return(t(window).width()-t(this).width())/2}),this},callback:function(){t(".modal").modal("hide"),this.remove(),this.options.callback.apply(this,arguments)}})}),define("text!text/public/forgotten.html",[],function(){return'<input class="form-control" type="text" name="email" placeholder="<%= m_forgotten_email %>" autocorrect="off" autocapitalize="off">\n<a href="javascript:void(0)" class="btn btn-primary">\n	<%= m_forgotten_request %>\n</a>\n'}),define("view/public/forgotten",["jquery","view/dialog","text!text/public/forgotten.html"],function(e,t,n){return t.extend({tagName:"fieldset",title:t.message("m_forgotten_title"),events:{"click a":"request"},render:function(){return t.prototype.render.apply(this,arguments),this.$el.html(this.template(n)),this},request:function(){var t=e("input[name=email]",this.$el);this.callback(t.val())}})}),define("text!text/public/signin.html",[],function(){return'<% if (error) { %>\n	<div class="alert alert-danger"><%= error %></div>\n<% } %>\n<input class="form-control" name="username" placeholder="<%= m_signin_username %>" type="text" autocorrect="off" autocapitalize="off">\n<input class="form-control" name="password" placeholder="<%= m_signin_password %>" type="password">\n<a href="javascript:void(0)" id="signin" class="btn btn-primary">\n	<%= m_signin_signin %>\n</a>\n<a href="javascript:void(0)" id="forgotten-link">\n	<%= m_signin_forgotten %>\n</a>\n<% if (!thirdPartySignin) { %>\n	<a data-external class="btn btn-default linkedin" href="<%= appRoot %>/linkedin?referrer=mobile" >\n		<i class="fa fa-linkedin"></i>\n		<%= m_signin_linkedin %>\n	</a>\n	<a data-external class="btn btn-default google" href="<%= appRoot %>/google/oauth2?referrer=mobile" >\n		<i class="fa fa-google-plus"></i>\n		<%= m_signin_google %>\n	</a>\n<% } %>\n<% if (env != \'prod\') { %>\n	<div class="alert alert-success"><%= env %></div>\n<% } %>\n'}),define("view/public/signin",["ext/underscore","view/page","native","app-context","api/service/general","view/public/forgotten","text!text/public/signin.html"],function(e,t,n,r,i,s,o){return t.extend({tagName:"fieldset",events:{"click #signin":"signin","click #forgotten-link":"openForgotten"},branded:!0,title:t.message("m_signin_title"),nosearch:!0,render:function(){t.prototype.render.apply(this,arguments);var e={error:this.message(this.options.error),appRoot:r.resolveAppEndPoint(),env:r.getEnvironment(),thirdPartySignin:n.thirdPartySignin};return this.$el.html(this.template(o,e)),this},openForgotten:function(){var e=new s({callback:this.handleForgotten});e.render()},handleForgotten:function(e){i.requestPasswordReset(e,function(e){e=e?"sent":"fail",r.navigate("#public/signin/m_forgotten_request_"+e,!0)})},signin:function(){var e=this.$el.find("input[name=username]"),t=this.$el.find("input[name=password]"),n={username:e.val(),password:t.val()};n.username.indexOf("@")==0?(r.removeDashboard(),r.setEnvironment(n.username.substr(1)),r.navigate("#public/signin",!0)):this.options.authenticate(n)}})}),define("text!text/public/validated_input.html",[],function(){return'<input class="form-control" type="<%= type %>" name="<%= name %>" value="<%= value %>"   \n	<% if (maxlength) { print(\'maxlength=\' + maxlength) } %>\n	placeholder="<%= label ? messages[label] : \'\' %>"\n    autocorrect="<%= autocomplete ? \'on\' : \'off\' %>"\n    autocapitalize="<%= autocomplete ? \'on\' : \'off\' %>" >\n<p class="hidden invalid"></p>\n'}),define("view/public/validated-input",["ext/underscore","jquery","view/base","text!text/public/validated_input.html"],function(e,t,n,r){return n.extend({events:{"keyup input":"keyup","blur input":"blur"},initialize:function(t){e.assert(t.name,"name required"),e.bindToMethods(this),this.options=e.extend({validate:function(e,t){t()}},t)},render:function(){var t={type:"text",value:"",maxlength:null,autocomplete:!0};return this.$el.html(this.template(r,e.extend(t,this.options))),this},keyup:function(){this.options.keyup&&this.options.keyup.call(this,t("input",this.$el).val())},blur:function(){this.options.validate.call(this,t("input",this.$el).val(),this.displayValidation)},val:function(){return t("input",this.$el).val()},displayValidation:function(e){var n=t("p",this.$el).html(this.message(e));e?n.removeClass("hidden"):n.addClass("hidden")}})}),define("text!text/public/signup.html",[],function(){return'<p><b>Your Email: <%= email %></b></p>\n<a href="javascript:void(0)" id="signup" class="btn btn-primary">\n	<%= m_signup_signup %>\n</a>\n'}),define("view/public/signup",["ext/underscore","jquery","view/page","app-context","api/service/general","view/public/validated-input","text!text/public/signup.html"],function(e,t,n,r,i,s,o){var u=function(e){e=e.toLowerCase();var t=[];for(var n=0;n<e.length;n++)t.push(e.charAt(n).match(/[a-z0-9_]/)?e.charAt(n):".");return t.join("")};return n.extend({tagName:"fieldset",events:{"click #signup":"validate"},title:n.message("m_signup_header"),branded:!0,nosearch:!0,initialize:function(r){n.prototype.initialize.apply(this,arguments);var o=new s({autocomplete:!1,name:"user.username",label:"m_input_username",maxlength:32,validate:function(e,t){e?e.length>2?i.isUsernameTaken(e,function(e){t(e?"m_input_error_taken":null)}):t():t("m_input_error_username")},keyup:function(e){var n=t("input",a.$el).val();this.manual=u(n)!=e}}),a=new s({name:"user.name",label:"m_input_name",maxlength:32,validate:function(t,n){e.defer(o.blur),n(t?null:"m_input_error_name")},keyup:function(e){if(!o.manual){var n=u(e);t("input",o.$el).val(n)}}}),f=new s({type:"password",name:"user.password",label:"m_input_password",validate:function(e,t){e?e.length<6?t("m_input_error_minimum_6"):t():t("m_input_error_password")}});this.inputs=[a,o,f,new s({type:"password",name:"passwordConfirm",label:"m_input_confirm",validate:function(e,n){if(!e)n("m_input_error_confirm");else{var r=t("input",f.$el).val();n(e==r?null:"m_input_error_mismatch")}}}),new s({name:"user.telephone",label:"m_input_telephone",maxlength:20}),new s({name:"user.organisation",label:"m_input_organisation",maxlength:100})]},render:function(){n.prototype.render.apply(this,arguments),this.$el.html(this.template(o,this.options));var r=t("#signup",this.$el);return e.each(this.inputs,function(e){r.before(e.render().el)}),this},validate:function(){var t=!0,n=this.inputs.length,r=this;e.each(this.inputs,function(e){e.options.validate(e.val(),function(i){n--,e.displayValidation(i),!i||(t=!1),n==0&&t&&r.signup()})})},signup:function(){var e=t("input",this.$el).serializeArray();e.push({name:"inviteKey",value:this.options.inviteKey}),e.push({name:"user.email",value:this.options.email});var n=(new Date).getFullYear(),r=Date.UTC(n,0,1)-new Date(n,0,1).getTime();e.push({name:"rawOffset",value:r}),e.push({name:"dstSavings",value:Date.UTC(n,6,1)-new Date(n,6,1).getTime()-r}),i.createUser(e,this.signupComplete)},signupComplete:function(e){if(e){var n={username:t("[name='user.username']",this.$el).val(),password:t("[name='user.password']",this.$el).val()};this.options.authenticate(n)}else r.navigate("#public/signin/m_error_unexpected",!0)}})}),define("text!text/public/reset.html",[],function(){return'<a href="javascript:void(0)" id="reset" class="btn btn-primary">\n	<%= m_reset_reset %>\n</a>\n'}),define("view/public/reset",["ext/underscore","jquery","view/page","app-context","api/service/general","view/public/validated-input","text!text/public/reset.html"],function(e,t,n,r,i,s,o){return n.extend({tagName:"fieldset",events:{"click #reset":"validate"},title:n.message("m_reset_header"),branded:!0,nosearch:!0,initialize:function(e){n.prototype.initialize.apply(this,arguments);var r=this.passwordView=new s({type:"password",name:"password",label:"m_input_password",validate:function(e,t){e?e.length<6?t("m_input_error_minimum_6"):t():t("m_input_error_password")}});this.confirmView=new s({type:"password",name:"confirmedPassword",label:"m_input_confirm",validate:function(e,n){if(!e)n("m_input_error_confirm");else{var i=t("input",r.$el).val();n(e==i?null:"m_input_error_mismatch")}}})},render:function(){n.prototype.render.apply(this,arguments),this.$el.html(this.template(o,this.options));var e=t("#reset",this.$el);return e.before(this.passwordView.render().el),e.before(this.confirmView.render().el),this},validate:function(){var e=this,t=0,n=0,r=function(r){n++,r||t++,n==2&&t==2&&e.reset()};this.passwordView.options.validate(this.passwordView.val(),function(t){e.passwordView.displayValidation(t),r(t)}),this.confirmView.options.validate(this.confirmView.val(),function(t){e.confirmView.displayValidation(t),r(t)})},reset:function(){i.resetPassword(this.options.username,this.options.tokenKey,t("input",this.$el).serializeArray(),this.resetComplete)},resetComplete:function(e){if(e){var n={username:this.options.username,password:t("[name=password]",this.$el).val()};this.options.authenticate(n)}else r.navigate("#public/signin/m_error_unexpected",!0)}})}),define("text!text/context_item.html",[],function(){return"<a href=\"#updates/<%= model.getKey() %>\">\n	<% if (model.type == 'group') { %>\n		<img src=\"<%= cdn %>/customise/<%= model.get('hash') %>/@logo?_=<%= model.get('lastModified') %>\">\n	<% } %>\n	<%= _.escape(model.get('friendlyName')) %>\n</a>\n"}),define("view/context/item",["ext/underscore","backbone","app-context","text!text/context_item.html"],function(e,t,n,r){return t.View.extend({tagName:"li",className:"context-item",render:function(){this.model.id?this.model.type=="account"&&this.$el.addClass("list-header"):this.$el.addClass("hidden");var t={cdn:n.cdn,model:this.model};return this.$el.html(e.template(r,t)),this}})}),define("view/context/select",["ext/underscore","view/page","view/context/item"],function(e,t,n){return t.extend({title:t.message("m_context_select_header"),action:{code:"m_context_signout",link:"#signout"},tagName:"ul",className:"list-unstyled",append:function(e){var t=new n({model:e});this.$el.append(t.render().el)},render:function(){return t.prototype.render.apply(this,arguments),this.collection.each(function(t){this.append(t),e.each(t.groups,function(e){this.append(e)},this)},this),this}})}),define("text!text/error.html",[],function(){return'<div class="alert alert-danger">\n	<%= code %>\n</div>\n<a href="#updates/dashboard" class="btn btn-primary">\n	<%= m_error_dashboard %>\n</a>\n'}),define("view/error",["ext/underscore","view/page","text!text/error.html"],function(e,t,n){return t.extend({tagName:"fieldset",title:t.message("m_error_title"),nosearch:!0,render:function(){t.prototype.render.apply(this,arguments);var e={code:this.options.code?this.message(this.options.code):this.message("m_error_unexpected")};return this.$el.html(this.template(n,e)),this}})}),define("router/default",["router/base","app-context","api/cache","api/service/general","api/model/group","api/model/request","view/search/list","view/search/suggestions","view/public/signin","view/public/signup","view/public/reset","view/context/select","view/error"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){return e.extend({routes:{"search/:query":"getSearch","defer/:organisation/requests/:id/:answer":"handleDeferredRequest","defer/:organisation/:group":"handleDeferredContent","defer/:organisation/:group/:type/:id":"handleDeferredContent","public/signup/:inviteKey":"showSignup","public/signin":"showSignin","public/signin/:error":"showSignin","public/reset/:username%2F:tokenKey":"showReset","public/auth/:session":"authenticateWithSession",signout:"actionSignout",context:"getAccounts",error:"showError","error/:code":"showError","*splat":"splat"},getSearch:function(e){r.getSearchResults(decodeURIComponent(e),this.showSearch)},showSearch:function(e){e.suggestions?new u({collection:e}).render():new o({collection:e}).render()},handleDeferredRequest:function(e,t,n){var r=new s({id:t});r.answer=n,r.once("sync",this.answerRequest),r.fetch()},answerRequest:function(e){e.set("status",e.answer.toUpperCase()),e.once("sync",function(){var n=e.get("contextKey");type=n.objectType.split(".")[4].toLowerCase(),type=="space"?e.answer=="accept"?t.navigate("#updates/groups:@"+n.objectId,!0):t.navigate("#updates/dashboard",!0):t.navigate("#"+type+"/"+type+":"+n.parent.objectId+":@"+n.objectId,!0)}),e.save()},handleDeferredContent:function(e,t,n,r){t=new i({name:e+":"+t}),n&&(t.entity={type:n,id:r}),t.once("sync",this.redirectToGroupContent),t.fetch()},redirectToGroupContent:function(e){if(e.entity){var n=e.entity.type.substr(0,e.entity.type.length-1);t.navigate("#"+n+"/"+n+":"+e.id+":"+e.entity.id,!0)}else t.navigate("#updates/groups:@"+e.id,!0)},showSignin:function(e){var n=this;t.getCredentials()?t.navigate("#updates/dashboard",!0):new a({authenticate:n.authenticate,error:e}).render()},actionSignout:function(){t.removeAccessToken(),t.removePrinciple(),n.clear(),t.removeCredentials(),t.navigate("#public/signin",!0)},getAccounts:function(){r.getAccountsWithGroups(this.showContextSelect)},showContextSelect:function(e){new c({collection:e}).render()},showError:function(e){new h({code:e}).render()},splat:function(){new h({code:"m_error_not_found"}).render()},showSignup:function(e){var i=this;r.getEmailFromInviteKey(e,function(r){r?(t.removeAccessToken(),t.removePrinciple(),n.clear(),new f({authenticate:i.authenticate,email:r,inviteKey:e}).render()):t.navigate("#error/m_error_invite",!0)})},showReset:function(e,r){t.removeAccessToken(),t.removePrinciple(),n.clear(),new l({authenticate:this.authenticate,username:e,tokenKey:r}).render()},authenticateWithSession:function(e){this.authenticate({session:e})},authenticate:function(e){t.setCredentials(e),r.fetchPrinciple(function(e){t.setPrinciple(e.toJSON()),t.navigate("#updates/dashboard",!0)})}})}),define("api/model/file",["api/model/content"],function(e){return e.extend({initialize:function(){this.type="file"},isFolder:function(){return this.get("contentType")=="@folder"},getExtension:function(){if(this.isFolder())return"folder";var e=this.get("friendlyName"),t=e.lastIndexOf(".");return e.lastIndexOf("/")>t?"":e.substring(t+1).toLowerCase()}},{type:"file"})}),define("api/model/note",["api/model/content"],function(e){return e.extend({initialize:function(){this.type="page"}},{type:"page"})}),define("api/model/discussion",["ext/underscore","api/model/content"],function(e,t){return t.extend({initialize:function(){this.type="discussion"}},{type:"discussion"})}),define("api/model/event",["api/model/content"],function(e){return e.extend({initialize:function(){this.type="event"},isSameDay:function(){var e=new Date(this.get("startDate"));e.setHours(0,0,0,0);var t=new Date(this.get("endDate"));return t.setHours(0,0,0,0),e.getTime()==t.getTime()}},{type:"event"})}),define("api/model/task",["api/model/content"],function(e){return e.extend({initialize:function(){this.type="task"},isOverdue:function(){return this.get("overdue")&&!this.get("completed")}},{type:"task"})}),define("api/factory",["api/model/file","api/model/note","api/model/discussion","api/model/event","api/model/task"],function(e,t,n,r,i){return{createEntity:function(s){return s.type=="page"?new t(s):s.type=="file"?new e(s):s.type=="discussion"?new n(s):s.type=="event"?new r(s):s.type=="task"?new i(s):null}}}),define("api/model/update",["ext/underscore","api/model/base","api/model/account","api/model/group","api/factory","messages"],function(e,t,n,r,i,s){return t.extend({initialize:function(e){e.component&&(this.component=i.createEntity(e.component))},urlRoot:"/updates",isMicroblog:function(){return this.get("messageCode").search(/\.private$/)!=-1},getComponent:function(){return this.component},getAccount:function(){return this.account||(this.account=this.get("account"),this.account&&(this.account=new n(this.account))),this.account},getGroup:function(){return this.group||(this.group=this.get("group"),this.group&&(this.group=new r(this.group))),this.group},getContext:function(){if(this.getGroup())return this.getGroup();if(this.getAccount())return this.getAccount()},getDescription:function(){var t=this.get("user"),n=this.get("account"),r=this.get("group"),i=[t?t.name:this.get("userName"),n?n.friendlyName:this.get("accountName"),r?r.friendlyName:this.get("groupName"),e.escape(this.get("componentName")),null,this.get("reservedName")],o=s.messages[this.get("messageCode")];if(!o)return s.messages.m_update_unknown;var u=o.split(/[\{\}]+/);for(var a=1;a<u.length;a+=2)u[a]=i[parseInt(u[a])];var f={max:80},l="";for(var a=0;a<u.length&&!f.truncate;a++){var c=this.truncate(f,u[a]);l+=a%2?c.bold():c}return l},truncate:function(e,t){return t||(t=""),e.current||(e.current=0),e.current+=t.length,e.current>e.max?(e.truncate=!0,t.substr(0,e.current-e.max)+".."):t}})}),define("api/collection/updates",["api/collection/base","api/model/update"],function(e,t){return e.extend({model:t,url:"/updates",initialize:function(e,t){this.context=t.context,this.params={currentPage:1,pageSize:25},t.current&&(t.current.offset?this.params.offset=t.current.offset:this.params.currentPage+=t.current.params.currentPage),this.params[this.context.type+"Id"]=this.context.id},parse:function(e){return e.page?(this.more=e.nextPage,e.page):(this.offset=e.offset,this.more=e.more,e.items)},addPage:function(e){this.add(e.models),e.offset?this.offset=e.offset:this.params.currentPage=e.params.currentPage,this.more=e.more},_getKey:function(e){return e+":"+this.context.getKey()}})}),define("api/model/microblog-reply",["api/model/base"],function(e){return e.extend({initialize:function(){this.reply=!0},getComment:function(){return this.get("comment")},getCommenter:function(){return this.get("commenter")},getDateCreated:function(){return new Date(this.get("dateCreated"))}})}),define("api/collection/microblog-replies",["api/collection/base","api/model/microblog-reply"],function(e,t){return e.extend({model:t,initialize:function(e,t){this.parent=t.parent},url:function(){return this.parent.url()+"/comments"}})}),define("api/model/microblog",["ext/underscore","api/collection/microblog-replies","api/model/update"],function(e,t,n){return n.extend({getComment:function(){return this.get("message")},getCommenter:function(){return this.get("user")},getDateCreated:function(){return new Date(this.get("lastModified"))},getReplies:function(){return this.replies||(this.replies=new t(this.get("replies"),{parent:this})),this.replies},_getKey:function(e){return e+":microblog"}})}),define("api/model/base-comment",["api/model/base"],function(e){return e.extend({url:function(){var e=this.id?"/@"+this.id:"";return this.collection.url()+e},getComment:function(){return this.get("comment")},getCommenter:function(){var e=this.get("commenter");return e?e:{name:this.get("commenterName")}},getDateCreated:function(){return new Date(this.get("dateCreated"))}})}),define("api/model/reply",["api/model/base-comment"],function(e){return e.extend({initialize:function(){this.reply=!0}})}),define("api/service/update",["ext/underscore","api/cache","api/service/general","api/collection/updates","api/model/microblog","api/model/reply"],function(e,t,n,r,i,s){var o=function(e,n){e.once("sync",function(){e.each(function(e){var n=e.getComponent();n&&t.putModel(n)}),n(e)}),e.fetch()};return{getUpdates:function(e,i,s){n.getContext(e,function(e){var n=new r([],{context:e});if(!s){n=t.getFrom(n);if(n._expiry){i(n);return}}o(n,function(e){t.putModel(e),i(e)})})},getCachedUpdates:function(e,i){n.getContext(e,function(e){var n=new r([],{context:e});i(t.getFrom(n))})},getNextUpdates:function(e,t){o(new r([],{context:e.context,current:e}),function(n){e.addPage(n),t(n)})},getMicroblog:function(e,n,r){var s=new i({id:e});if(!r){s=t.getFrom(s);if(s._expiry){n(s);return}}s.once("change",function(){n(s)}),s.fetch()},createMicroblog:function(t,n,r){var s={message:n};s[t.type]={id:t.id};var o=new i(s);o.save(),o.once("change",e.bind(r,this,o))},createMicroblogReply:function(t,n,r){var i=t.getReplies(),o=new s({comment:n});i.once("change",e.bind(r,this,o)),i.add(o),o.save()}}}),define("text!text/navbar.html",[],function(){return"<% _.each(btns, function(btn, i) { %>\n	<div class=\"btn-group\">\n		<a href=\"<%= btn.link %>\" class=\"btn btn-default <%= btn.name == focus ? 'selected' : '' %>\">\n			<img src=\"<%= appurl %>/svg/components/<%= btn.name %><%= btn.name == focus ? '-white' : '' %>.svg\" />\n		</a>\n	</div>\n<% }); %>\n"}),define("view/navbar",["ext/underscore","view/base","text!text/navbar.html"],function(e,t,n){return t.extend({className:"btn-group btn-group-justified",initialize:function(t){e.assert(t.btns,"btns required"),e.assert(t.focus,"focus required"),this.options=t},render:function(){return this.$el.html(this.template(n,this.options)),this}})}),define("view/navbar-factory",["ext/underscore","api/service/general","view/navbar"],function(e,t,n){return{navbarCreate:function(r,i,s){t.getGroup(i,function(t){var i={pages:{name:"pages",link:"#pages/"+t.getKey()},files:{name:"files",link:"#files/"+t.getKey()},discussions:{name:"discussions",link:"#discussions/"+t.getKey()},events:{name:"events",link:"#events/"+t.getKey()},tasks:{name:"tasks",link:"#tasks/"+t.getKey()}},o=[{name:"overview",link:"#updates/"+t.getKey()}];e.each(t.get("components"),function(e){i[e]&&o.push(i[e])}),o.push({name:"messages",link:"#messages/"+t.getKey()}),s(new n({focus:r,btns:o}))})}}}),define("text!text/update_item.html",[],function(){return'<img class="svg-1default <%= sprite %>" src="<%= image %>" \n	onerror=\'this.onerror = null; this.src="<%= appurl %>/styles/images/default_thumbnail.png"\'>\n<p><%= model.getDescription() %></p>\n<abbr><%= $.timeago(new Date(model.get(\'lastModified\'))) %></abbr>\n'}),define("view/update/item",["ext/underscore","jquery","view/base","app-context","api/cache","text!text/update_item.html"],function(e,t,n,r,i,s){return n.extend({tagName:"li",className:"fat update-item",render:function(){var e=this.addImageArgs({model:this.model}),n=null,r=this.createLink();return r?n=t("<a>").attr("href",r).appendTo(this.el):n=this.$el,n.addClass("list-parent").append(this.template(s,e)),this},createLink:function(){if(this.model.isMicroblog())return i.putModel(this.model),"#microblog/"+this.model.getKey();if(this.model.get("component")){var e=this.model.getComponent();if(e){if(this.model.get("message")){var t="#comments/";return this.model.get("messageCode")=="update.discussion.createreply"&&(t="#discussion/"),t+e.getKey()+"/"+this.model.get("lastModified")}return"#"+e.type+"/"+e.getKey()}}else if(this.model.getContext()){var n=this.model.getContext().getKey();if(n!=this.model.collection.context.getKey())return"#updates/"+n}return null},addImageArgs:function(e){if(this.model.isMicroblog()){e.sprite="";var t=this.model.get("user");t.logo?e.image=r.cdn+"/users/"+t.id+"/thumbnail":e.image=r.defaultThumb}else{e.sprite="svg-"+this.model.get("messageCode").replace(/\./g,"");var n=this.model.getComponent();n&&n.isFolder&&n.isFolder()&&(e.sprite+=" folder"),e.image=r.getAppUrl()+"/styles/images/transparent.gif"}return e}})}),define("view/update/list",["ext/underscore","api/service/update","view/navbar-factory","view/extending-list","view/update/item"],function(e,t,n,r,i){return r.extend({back:{code:"m_btn_context",link:"#context"},initialize:function(){r.prototype.initialize.apply(this,arguments),this.title=e.escape(this.options.context.get("friendlyName")),this.action={code:"m_comment",link:"#updates/"+this.options.context.getKey()+"/create"},this.options.context.type=="group"&&(this.navbar=this._navbar)},emptyMsgCode:"m_updates_nothing",itemViewClass:i,handleEndOfList:function(){t.getNextUpdates(this.collection,this.renderPage)},handleRefresh:function(){var e=this;t.getUpdates(this.collection.context.getKey(),function(t){e.collection=t,e.refresh()},!0)},_navbar:function(e){this.navbarCreate("overview",this.options.context.id,e)}}).extend(n)}),define("text!text/people_item.html",[],function(){return'<a class="item-with-icon" href="javascript:void(0)">\n	<img src="<%= thumb %>">\n	<h4><%= name %></h4>\n</a>\n'}),define("view/people/item",["ext/underscore","backbone","app-context","text!text/people_item.html"],function(e,t,n,r){return t.View.extend({tagName:"li",className:"fat",events:{"click a":"select"},initialize:function(t){e.assert(t.callback,"callback required"),this.options=t},render:function(){var t=n.getAppUrl()+"/styles/images/default_thumbnail.png";this.model.get("logo")&&(t=n.cdn+"/users/"+this.model.id+"/thumbnail");var i={name:this.model.get("name"),thumb:t};return this.$el.html(e.template(r,i)),this},select:function(){this.options.callback(this.model)}})}),define("view/people/list",["ext/underscore","view/dialog","view/people/item"],function(e,t,n){return t.extend({tagName:"ul",className:"list-unstyled",title:t.message("m_mention_title"),render:function(){t.prototype.render.apply(this,arguments);var r={};return this.options.filter&&e.each(this.options.filter,function(e){r[e]=!0}),this.collection.each(function(e){if(!r[e.id]){var t=new n({model:e,callback:this.callback});this.$el.append(t.render().el)}},this),this}})}),define("view/editor",["ext/underscore","jquery","native","api/service/general","view/people/list"],function(e,t,n,r,i){return Backbone.View.extend({tagName:"iframe",attributes:{scrolling:"no",frameBorder:"0"},initialize:function(t){e.bindToMethods(this),this.context=t.context,this.$page=t.$page,this.content=t.content},render:function(){var n=t("textarea.editor",this.$page);this.placeholder='<span style="color:gray;">'+n.attr("placeholder")+"</span>",n.replaceWith(this.el),this.frameWin=this.el.contentWindow,this.frameDoc=this.frameWin.document,this.frameDoc.designMode="on",this.$frameBody=t(this.frameDoc.body),this.$frameBody.css("font-family","Helvetica,Arial,sans-serif"),e.isBlank(this.content)?this.$frameBody.html(this.placeholder):this.$frameBody.html(this.content),t(this.frameDoc).keydown(this.onKeydown);var r=this;t(this.frameDoc).keyup(function(e){r.$el.trigger("_change")}),t(this.frameWin).focus(this.onFocus).blur(this.onBlur)},render_delayed:function(t){e.delay(function(e){e.render(),t&&e.frameWin.focus()},100,this)},onFocus:function(){this.getText()==""&&this.$frameBody.html("")},onBlur:function(){e.isBlank(e.stripTags(this.getText()))&&this.$frameBody.html(this.placeholder)},onKeydown:function(e){if(e.keyCode==13){e.preventDefault();var n=t("<br>").addClass("new-line").appendTo(this.frameDoc.body),r=t(document.createTextNode(String.fromCharCode(160))).insertAfter(n),i=this.frameWin.getSelection(),s=this.frameDoc.createRange();s.selectNode(i.anchorNode),s.setStartBefore(r[0]),s.collapse(!0),i.removeAllRanges(),i.addRange(s)}},doAction:function(){var e=this;r.getUsers(this.context,function(t){e.users=t;var n=new i({collection:t,callback:function(t){e.insertMention(t)}});n.render()})},insertMention:function(e){this.frameDoc.body.focus();var r=t("<a/>").css({"background-color":"grey"}).text("@"+e.get("username"));r.appendTo(this.frameDoc.body);var i=t(document.createTextNode(String.fromCharCode(160))).insertAfter(r),s=this.frameWin.getSelection(),o=this.frameDoc.createRange();o.selectNode(s.anchorNode),o.setStartAfter(i[0]),o.collapse(!0),s.removeAllRanges(),s.addRange(o),n.ios&&this.frameDoc.body.blur()},getText:function(){var e=this.$frameBody.html();return e==this.placeholder?"":e}})}),define("text!text/editor.html",[],function(){return'<textarea class="editor hidden" placeholder="<%= m_type_here %>"></textarea>\n<fieldset>\n	<a href="javascript:void(0)" id="post" class="btn btn-primary" disabled="disabled">\n		<%= m_post %>\n	</a>\n</fieldset>\n'}),define("view/editor-page",["ext/underscore","jquery","view/page","view/editor","text!text/editor.html"],function(e,t,n,r,i){return n.extend({events:{"_change iframe":"onChange","click #post":"post"},initialize:function(t){n.prototype.initialize.apply(this,arguments),e.assert(this.post,"title post"),this.editor=new r({context:this.options.context,$page:this.$el}),this.action={code:"m_mention",view:this.editor}},render:function(){return n.prototype.render.apply(this,arguments),this.$el.html(this.template(i)),this.editor.render_delayed(!0),this},onChange:function(){t("#post",this.$el).attr("disabled",e.isBlank(this.editor.getText()))}})}),define("view/update/create",["app-context","view/editor-page","api/service/update"],function(e,t,n){return t.extend({title:t.message("m_make_comment"),nosearch:!0,initialize:function(){t.prototype.initialize.apply(this,arguments),this.back={code:"m_btn_updates",link:"#updates/"+this.options.context.getKey()}},post:function(){n.createMicroblog(this.options.context,this.editor.getText(),this.microblogCreated)},microblogCreated:function(t){e.navigate("#microblog/"+t.getKey()),n.getUpdates(this.options.context.getKey(),function(e){e.unshift(t)})}})}),define("view/update/reply",["app-context","view/editor-page","api/service/update"],function(e,t,n){return t.extend({title:t.message("m_reply"),nosearch:!0,initialize:function(){t.prototype.initialize.apply(this,arguments),this.back={code:"m_comment",link:"#microblog/"+this.options.update.getKey()}},post:function(){var t=this.options.update;n.createMicroblogReply(t,this.editor.getText(),function(n){e.navigate("#microblog/"+t.getKey())})}})}),define("api/collection/replies",["api/collection/base","api/model/reply"],function(e,t){return e.extend({model:t,initialize:function(e,t){this.parent=t.parent},url:function(){return this.parent.url()}})}),define("api/model/comment",["api/model/base-comment","api/collection/replies"],function(e,t){return e.extend({initialize:function(e){this.replies=new t(e.replies,{parent:this})},getReplies:function(){return this.replies}})}),define("text!text/comment/item.html",[],function(){return'<div>\n	<img src="<%= cdn %>/users/<%= commenter.id %>/thumbnail" \n		onerror=\'this.onerror = null; this.src="<%= appurl %>/styles/images/default_thumbnail.png"\'>\n	<p><%= model.getComment() %></p>\n	<p class="who-when"><%= commenter.name %> (<%= $.timeago(model.getDateCreated()) %>)</p>\n	\n	<% if (!model.reply) { %>\n		<a href="javascript:void(0)" class="comment-reply">\n			<span class="glyphicon glyphicon-repeat"></span>\n		</a>\n	<% } %>\n	<% if (me.id == commenter.id) { %>\n		<a href="javascript:void(0)" class="comment-delete">\n			<span class="glyphicon glyphicon-trash"></span>\n		</a>\n	<% } %>\n</div>\n'
}),define("view/comment/item",["ext/underscore","view/base","app-context","text!text/comment/item.html"],function(e,t,n,r){return t.extend({attributes:{"class":"comment"},events:{"click .comment-delete":"onDelete","click .comment-reply":"onReply"},initialize:function(t){e.bindToMethods(this),this.replyViews=[],this.options=t},render:function(){var e={model:this.model,commenter:this.model.getCommenter(),selected:this.options.selected,cdn:n.cdn,me:n.getPrinciple()};return this.$el.html(this.template(r,e)),this.options.selected&&this.$el.addClass("selected"),this.model.reply&&this.$el.addClass("reply"),this},onReply:function(){this.options.onReply(this.model)},onDelete:function(){this.options.onDelete(this.model,this.onDeleted)},onDeleted:function(){this.$el.remove(),e.each(this.replyViews,function(e){e.$el.remove()})}})}),define("view/comment/list",["ext/underscore","jquery","view/page","api/model/comment","view/comment/item"],function(e,t,n,r,i){return n.extend({className:"comments",initialize:function(e){n.prototype.initialize.apply(this,arguments),this.collection.on("remove",this.onRemove),this.back=this.options.back,this.title=this.options.title,this.action=this.options.action},render:function(){n.prototype.render.apply(this,arguments);var e=this.getSelectedComment();return this.collection.each(function(t){var n=this.createAndRender(t,e==t.id);t.getReplies().each(function(t){var r=this.createAndRender(t,e==t.id);n.replyViews.push(r)},this)},this),this.onRemove(),this},createAndRender:function(e,t){var n=new i({model:e,selected:t,onDelete:this.options.onDelete,onReply:this.options.onReply});return this.$el.append(n.render().el),t&&this.scroll(n.$el.offset().top-52),n},getSelectedComment:function(){if(!this.options.dateOfSelection)return-1;var t=[];this.collection.each(function(e){t.push(e),e.getReplies().each(function(e){t.push(e)})}),t=e.sortBy(t,function(e){return-e.get("dateCreated")});var n=e.find(t,function(e){return e.get("dateCreated")<=this.options.dateOfSelection},this);return n?n.id:-1},remove:function(){return this.collection.off("remove",this.onRemove),this.$el.remove(),this},onRemove:function(){this.collection.length==0&&t("<div>").addClass("no-comments ui-body-d ui-corner-all").html(this.message("m_comments_nothing")).appendTo(this.el)}})}),define("router/update",["backbone","app-context","router/base","api/service/general","api/service/update","view/update/list","view/update/create","view/update/reply","view/comment/list"],function(e,t,n,r,i,s,o,u,a){return n.extend({routes:{"updates/:contextKey/create":"createMicroblog","updates/dashboard":"getDashboardUpdates","updates/:contextKey":"getUpdates","microblog/:microblogKey/create":"createMicroblogReply","microblog/:microblogKey":"getMicroblog"},getDashboardUpdates:function(){var e=t.getDashboard();e?this.getUpdates(e):t.navigate("#context",!0)},getUpdates:function(e){t.setDashboard(e),i.getCachedUpdates(e,this.showUpdates)},showUpdates:function(e){var t=new s({context:e.context,collection:e});t.render(),t.handleRefresh()},createMicroblog:function(e){r.getContext(e,this.showCreateMicroblog)},showCreateMicroblog:function(e){new o({context:e}).render()},getMicroblog:function(e){var t=e.split(":");i.getMicroblog(t[1],this.showMicroblog,!0)},showMicroblog:function(n){var s=new a({back:{code:"m_btn_updates",link:"#updates/"+n.getContext().getKey()},title:n.getDescription(),collection:new e.Collection([n]),onDelete:function(e,t){r.deleteModel(e,t),e.reply||i.getUpdates(e.getContext().getKey(),function(t){t.remove(e,{silent:!0})})},onReply:function(e){t.navigate("#microblog/"+e.getKey()+"/create")}});s.render()},createMicroblogReply:function(e){var t=e.split(":");i.getMicroblog(t[1],this.showCreateMicroblogReply)},showCreateMicroblogReply:function(e){new u({context:e.getContext(),update:e}).render()}})}),define("api/model/permission",["api/model/base"],function(e){return e.extend({initialize:function(e,t){this.context=t.context},url:function(){return this.context.url()+"/permission"},canEdit:function(){return(18&this.get("mask"))>0},canCreate:function(){return(20&this.get("mask"))>0}})}),define("api/service/base",["ext/underscore","api/model/permission"],function(e,t){return{getCollection:function(e,t){e.once("sync",function(){t(e)}),e.fetch()},getPermission:function(e,n){if(e.permission)n(e);else{var r=new t({},{context:e});r.once("sync",function(){e.permission=r,n(e)}),r.fetch()}}}}),define("api/collection/more",["ext/underscore","api/collection/base"],function(e,t){return t.extend({initialize:function(e,t){t&&(this.params=t.params),this.params=this.params||{}},parse:function(e){return this.more=e.nextPage,e.page}})}),define("api/collection/files",["api/collection/more","api/model/file"],function(e,t){return e.extend({model:t,initialize:function(t,n){e.prototype.initialize.apply(this,arguments),n&&(this.context=n.context)},url:function(){var e="/groups/@"+this.getGroup().id+"/files";if(this.context.type=="group")return e;var t=this.context.id?"@"+this.context.id:this.context.get("name");return e+"/"+t},_getKey:function(e){return e+":"+this.params.orderBy},parse:function(e){return this.context.type=="file"&&(e=e.children),this.more=e.nextPage,e.page},getGroup:function(){return this.context.type=="group"?this.context:this.context.get("group")}})}),define("api/service/file",["ext/underscore","app-context","api/cache","api/service/base","api/service/general","api/collection/files","api/model/file"],function(e,t,n,r,i,s,o){return e.extend({getFiles:function(e,t,r){var i=this;this.getContextWithPermission(e,function(e){var o=new s([],{context:e,params:i.createFileParams(1)});if(!r){o=n.getFrom(o);if(o){t(o);return}}i.getCollection(o,function(e){n.putModel(e),e.each(function(e){n.putModel(e)}),t(e)})})},getCachedFiles:function(e,t){var r=this;this.getContextWithPermission(e,function(e){var i=new s([],{context:e,params:r.createFileParams(1)});t(n.getFrom(i))})},getContextWithPermission:function(e,t){var n=this;this.getContext(e,function(e){n.getPermission(e,t)})},getContext:function(e,t){var n=e.split(":");n.length==2?i.getGroup(parseInt(n[1].substr(1)),t):this.getFile({id:n[1].substr(1)},n[3],t)},getNextFiles:function(e,t){var n=new s([],{context:e.context,params:this.createFileParams(e.params.currentPage+1)});this.getCollection(n,function(n){e.add(n.models),e.params.currentPage=n.params.currentPage,e.more=n.more,t(n)})},getFile:function(e,t,r){var i=new o({name:t});t.charAt(0)=="@"&&(i=new o({id:parseInt(t.slice(1))})),i.set("group",e),i.params=this.createFileParams(1),i=n.getFrom(i);if(i._expiry){r(i);return}var s=this;i.once("change",function(){n.putModel(i),i.isFolder()?s.getPermission(i,r):r(i)}),i.fetch()},createFileParams:function(e){var n=t.getFileSort();return{currentPage:e,pageSize:t.pageSize,orderBy:n,ascending:n=="name"}}},r)}),define("text!text/file/item.html",[],function(){return"<a href=\"#file/<%= getKey() %>\">\n	<img src=\"<%= appurl %>/svg/<%= getExtension() %>.svg\" onerror='this.onerror = null; this.src=\"<%= appurl %>/svg/file.svg\"'>\n	<p><b><%= get('friendlyName') %></b></p>\n	<abbr><%= m_last_updated %>: <%= $.timeago(new Date(get('lastModified'))) %></abbr>\n</a>\n"}),define("view/file/item",["view/base","text!text/file/item.html"],function(e,t){return e.extend({tagName:"li",className:"fat",render:function(){return this.$el.html(this.template(t,this.model)),this}})}),define("view/file/list",["ext/underscore","api/service/file","view/navbar-factory","view/extending-list","view/file/item"],function(e,t,n,r,i){return r.extend({initialize:function(){r.prototype.initialize.apply(this,arguments),this.title=e.escape(this.collection.context.get("friendlyName")),this.back=this.options.back,this.action=this.options.action},emptyMsgCode:"m_files_nothing",itemViewClass:i,handleEndOfList:function(){t.getNextFiles(this.collection,this.renderPage)},handleRefresh:function(){var e=this;t.getFiles(this.collection.context.getKey(),function(t){e.collection=t,e.refresh()},!0)},navbar:function(e){this.navbarCreate("files",this.collection.getGroup().id,e)}}).extend(n)}),define("text!text/sort_action.html",[],function(){return'<div>\n	<input type="radio" name="sort_by" id="lastModified" value="lastModified" \n		<% if (sort == \'lastModified\') { print(\'checked\') } %> >\n	<label for="lastModified"><%= m_actions_sort_latest %></label>\n</div>\n<div>\n	<input type="radio" name="sort_by" id="name" value="name" \n		<% if (sort == \'name\') { print(\'checked\') } %> >\n	<label for="name"><%= m_actions_sort_name %></label>\n</div>\n'}),define("view/sort_action",["view/dialog","text!text/sort_action.html"],function(e,t){return e.extend({className:"choice-list",title:e.message("m_actions_sort_header"),events:{"change input[type=radio]":"select"},render:function(){return e.prototype.render.apply(this,arguments),this.$el.html(this.template(t,this.options)),this},doAction:function(){this.render()},select:function(e){this.callback(this.options.context,e.target.value)}})}),define("text!text/file/upload.html",[],function(){return'<ul>\n	<li>\n		<span class="btn btn-success add" id="complex-flash-wrapper">\n			<%= m_file_upload_add %>\n		</span>\n		<input type="file" name="file" multiple />\n	</li>\n	<li><a href="javascript:void(0)" class="btn btn-primary upload-all"><%= m_file_upload_start %></a></li>\n	<li><a href="javascript:void(0)" class="btn btn-default cancel-all"><%= m_file_upload_cancel %></a></li>\n</ul>\n<table class="table">\n	<tbody>\n		<tr class="template">\n			<td class="name">&nbsp;</td>\n			<td class="size">&nbsp;</td>\n			<td class="progress-container">\n				<div class="progress progress-striped">\n					<div class="progress-bar">&nbsp;</div>\n				</div>\n			</td>\n			<td class="buttons">\n				<a href="javascript:void(0)" class="btn btn-xs btn-primary submit"><%= m_file_upload_upload %></a>\n				<a href="javascript:void(0)" class="btn btn-xs btn-primary retry"><%= m_file_upload_retry %></a>\n				<a href="javascript:void(0)" class="btn btn-xs btn-danger cancel"><%= m_file_upload_stop %></a>\n				<a href="javascript:void(0)" class="btn btn-xs btn-default remove"><%= m_file_upload_remove %></a>\n			</td>\n		</tr>\n	</tbody>\n</table>\n'}),define("view/file/upload",["jquery","view/dialog","app-context","text!text/file/upload.html"],function(e,t,n,r){return t.extend({tagName:"form",className:"upload-container",title:t.message("m_file_upload_header"),events:{"click a.cancel-all":"cancel"},initialize:function(e){t.prototype.initialize.apply(this,arguments),this.options.width="600px"},doAction:function(){e(".modal").on("hidden.bs.modal",this.close);var t=this.getEndpoint();this.options.context.type=="file"&&(t+="/"+this.options.context.id),e.get(n.fullUrl(t+"/index"),this.retrievePath)},retrievePath:function(t){this.index=JSON.parse(e.base64.atob(t));if(this.options.context.type=="file")if(this.index.fileSystem.length==0){var r=this.options.context.url()+"path";e.get(n.fullUrl(r),this.setPath)}else{var i=this.index.fileSystem[0];this.setPath(i.substring(1,i.lastIndexOf("/")))}else this.render()},setPath:function(e){this.path=e,this.render()},render:function(){t.prototype.render.apply(this,arguments),this.$el.html(this.template(r));var e=n.resolveEndPoint()+this.getEndpoint(),i="";this.path&&(i="&path="+encodeURIComponent(this.path));var s=n.getAccessToken().access_token;return this.$el.fileupload({beforeFinalSend:this.beforeFinalSend,chunkEndpoint:e+"/upload/data?access_token="+s,finalEndpoint:e+"/upload/complete?success=True&access_token="+s+"&forwardContext="+encodeURIComponent(e)+i,layout:"Complex",ajaxLoader:n.getAppUrl()+"/styles/images/ajax-loader.gif",defaultContentType:"application/json; charset=UTF-8",fileComplete:this.message("m_file_upload_success"),filefinish:this.filefinish}),this},beforeFinalSend:function(e,t){e.setRequestHeader("X-File-Id",t.file.fuid),e.setRequestHeader("X-File-Name",t.file.name),e.setRequestHeader("X-File-Size",t.file.size),e.setRequestHeader("X-File-Type",t.file.type);var n={sharing:"MEMBERS",memberPermission:8},r=this.index.metadata["/"+(this.path?this.path+"/":"")+t.file.name];r&&(n.id=r.ID),t.data=JSON.stringify(n)},filefinish:function(t,n,r){if(r){var i=e("tr#file_"+t.fuid+" .progress-bar",this.$el);i.text(this.message("m_file_upload_failure"))}},getEndpoint:function(){var e=this.options.context,t=e.toJSON();e.type=="file"&&(t=e.get("group"));var n=t.contextKey.parent.objectId;return"/v2/accounts/"+n+"/groups/"+t.id+"/files"},cancel:function(){e(".modal").modal("hide")},close:function(){e(".modal").off("hidden.bs.modal",this.close),this.options.callback(this.options.context)}})}),define("text!text/file/native-item.html",[],function(){return"<a class='item' href=\"javascript:void(0)\">\n	<img src=\"<%= appurl %>/svg/<%= extension %>.svg\" onerror='this.onerror = null; this.src=\"<%= appurl %>/svg/file.svg\"'>\n	<%= _.escape(file.name) %>\n</a>\n<div class='item progress hidden'>\n	<div class='progress-bar progress-bar-striped progress-bar-info'></div>\n</div>\n<div class='item failure hidden'>\n	<div class='progress-bar progress-bar-striped progress-bar-danger'>\n		<span><%= m_file_native_failure %></span>\n	</div>\n</div>\n<div class='item success hidden'>\n	<div class='progress-bar progress-bar-striped progress-bar-success'>\n		<span><b><%= _.escape(file.name) %></b><%= m_file_native_success %></span>\n	</div>\n</div>\n"}),define("view/file/native-item",["ext/underscore","lib/json2","view/base","native","app-context","api/service/file","text!text/file/native-item.html"],function(e,t,n,r,i,s,o){return n.extend({tagName:"li",className:"native-item",events:{"click .failure, a":"select","click .success":"dismiss"},initialize:function(t){e.bindToMethods(this),this.options=t},render:function(){var t=e.extend({extension:this.getExtension(this.options.file)},this.options);return this.$el.html(this.template(o,t)),this},getExtension:function(e){if(e.folder)return"folder";var t=e.name.lastIndexOf(".");return e.name.lastIndexOf("/")>t?"":e.name.substring(t+1).toLowerCase()},dismiss:function(){$(".item",this.$el).addClass("hidden"),$("a",this.$el).removeClass("hidden")},select:function(){if(this.options.list.uploading)return;if(this.options.file.folder){var e=(this.options.path?this.options.path+"/":"")+this.options.file.name,t="#native/"+this.options.context.getKey()+"/"+encodeURIComponent(e);i.navigate(t,!0)}else{var n=this;this.retrievePath(function(e){n.retrieveFileId(e,function(t){n.upload(e,t)})}),$(".item",this.$el).addClass("hidden"),$(".progress",this.$el).removeClass("hidden")}},retrievePath:function(e){this.options.context.type=="file"?$.get(i.fullUrl(this.options.context.url()+"path"),e):e(null)},retrieveFileId:function(e,n){var r=this.getEndpoint();this.options.context.type=="file"&&(r+="/"+this.options.context.id);var s=this;$.get(i.fullUrl(r+"/index"),function(r){r=t.parse($.base64.atob(r));var i=r.metadata["/"+(e?e+"/":"")+s.options.file.name],o=null;i&&(o=i.ID),n(o)})},upload:function(e,t){var n=(this.options.path?this.options.path+"/":"")+this.options.file.name;this.options.list.uploading=!0;var s=i.getAccessToken().access_token,o=i.resolveEndPoint()+this.getEndpoint();r.upload(n,o,s,e,t,this.progress)},getEndpoint:function(){var e=this.options.context,t=e.toJSON();e.type=="file"&&(t=e.get("group"));var n=t.contextKey.parent.objectId;return"/v2/accounts/"+n+"/groups/"+t.id+"/files"},progress:function(e){e==-1?(this.finish(),$(".failure",this.$el).removeClass("hidden")):e==100?(this.finish(),$(".success",this.$el).removeClass("hidden")):$(".progress-bar-info",this.$el).css("width",e+"%").html("<span>"+e+"%</span>")},finish:function(){this.options.list.uploading=!1,$(".item",this.$el).addClass("hidden"),$(".progress-bar-info",this.$el).css("width",0).html("")}})}),define("view/file/native-list",["ext/underscore","view/page","view/file/native-item"],function(e,t,n){return t.extend({tagName:"ul",className:"list-unstyled",title:t.message("m_file_native_header"),nosearch:!0,initialize:function(e){t.prototype.initialize.apply(this,arguments),this.action={code:"m_cancel",link:"#files/"+this.options.context.getKey()};if(this.options.path){this.title=this.options.path;var n="",r=this.options.path.lastIndexOf("/");r!=-1&&(n=this.options.path.substr(0,r),n="/"+encodeURIComponent(n),this.title=this.options.path.substr(r+1)),this.back={code:"m_back",link:"#native/"+this.options.context.getKey()+n}}},render:function(){return t.prototype.render.apply(this,arguments),e.each(this.options.files,function(e){var t=new n({list:this,context:this.options.context,path:this.options.path,file:e});this.$el.append(t.render().el)},this),this}})}),define("text!text/file/view.html",[],function(){return"<% if (type == 'image') { %>\n	<img class=\"sized\" src=\"<%= preview %>\">\n<% } %>\n<div class=\"entity-info\" >\n	<p><%= m_file_uploader %>: <%= model.get('uploaded').name %></p>\n	<p>\n		<img src=\"<%= cdn %>/users/<%= model.get('uploaded').id %>/thumbnail\" \n			onerror='this.onerror = null; this.src=\"<%= appurl %>/styles/images/default_thumbnail.png\"'>\n	</p>\n	<p><%= m_on %>: <%= moment(model.get('lastModified')).format('ddd, DD MMM YYYY, HH:mm') %></p>\n	<p><%= m_version %>: <%= model.get('versions') %></p>\n	<p><%= m_size %>: <%= size %></p>\n	<p>\n		<img src=\"<%= appurl %>/svg/<%= model.getExtension() %>.svg\" \n			onerror='this.onerror = null; this.src=\"<%= appurl %>/svg/file.svg\"'>\n	</p>\n	<% if (type != 'document' && type != 'image') { %>\n		<p><%= m_file_preview_failed %></p>\n	<% } %>\n</div>\n<% if (download) { %>\n	<a href=\"<%= download %>\" class=\"btn btn-primary download\">\n		<%= m_download %>\n	</a>\n<% } %>\n<% if (type == 'document') { %>\n	<a href=\"javascript:void(0)\" class=\"btn btn-primary preview\">\n		<%= m_preview %>\n	</a>\n<% } %>\n"}),define("view/file/view",["ext/underscore","native","view/page","moment","app-context","view/navbar-factory","text!text/file/view.html"],function(e,t,n,r,i,s,o){return n.extend({KB:1024,MB:1048576,GB:1073741824,tagName:"fieldset",events:{"click a.preview":"preview"},initialize:function(e){n.prototype.initialize.apply(this,arguments),this.back=this.options.back,this.title=this.model.get("friendlyName"),this.action={code:"m_comments",link:"#comments/"+this.model.getKey()}},render:function(){n.prototype.render.apply(this,arguments);var e={type:this.options.type,model:this.model,size:this.formatSize(),cdn:i.cdn,download:t.list&&!t.upload?i.fullUrl(this.model.url()+"download"):null,preview:i.fullUrl(this.model.url()+"preview")};return this.$el.html(this.template(o,e)),this},formatSize:function(){var e=this.model.get("size"),t="bytes",n=1;return e>this.GB?(t="GB",n=this.GB):e>this.MB?(t="MB",n=this.MB):e>this.KB&&(t="KB",n=this.KB),Math.round(e*10/n)/10+" "+t},navbar:function(e){this.navbarCreate("files",this.model.getGroup().id,e)},preview:function(){i.preview(this.model,this.options.type=="document")}}).extend(s)}),define("router/file",["ext/underscore","app-context","api/cache","native","router/base","api/service/file","api/collection/files","view/file/list","view/sort_action","view/file/upload","view/file/native-list","view/file/view"],function(e,t,n,r,i,s,o,u,a,f,l,c){return i.extend({routes:{"files/:contextKey":"getFiles","file/:fileKey":"getFile","native/:contextKey/:path":"getNative","native/:contextKey":"getNative"},getFiles:function(e){s.getCachedFiles(e,this.showFiles)},showFiles:function(e){var t=this.createFileListView(e.context,e);t.render(),t.handleRefresh()},getFile:function(e){var t=e.split(":"),n={id:parseInt(t[1].substr(1))};s.getFile(n,t[3],this.handleFile)},handleFile:function(e){if(e.isFolder()){var t=e.get("children");if(t){var r=new o(t.page,{context:e,params:s.createFileParams(1)});r.more=t.nextPage,n.putModel(r),r.each(function(e){n.putModel(e)});var i=this.createFileListView(e,r);i.render()}else this.getFiles(e.getKey())}else this.showFile(e)},showFile:function(n){var i=this.getFileType(n),s=new c({back:this.createFileBack(n),model:n,type:i});i=="unknown"||i=="image"||r.popupPreview?s.render():(t.setHeader(s),e.defer(function(){t.preview(n,i=="document")}))},getFileType:function(n){var i=n.get("contentType");return e.startsWith(i,"image/")?"image":e.startsWith(i,"video/")?"video":e.startsWith(i,"audio/")&&r.audioPreview?"video":e.find(t.mimetypes,function(e){return this==e},i)?"document":"unknown"},createFileListView:function(e,n){var i=e.permission.canCreate();if(r.upload&&i)var s={code:"m_actions_upload",link:"#native/"+e.getKey()};else if(r.list&&i)var s={code:"m_actions_upload",view:new f({context:e,callback:this.refresh})};else var s={code:"m_actions_sort",view:new a({context:e,sort:t.getFileSort(),callback:this.sortFiles})};return new u({back:this.createFileBack(e),action:s,collection:n})},sortFiles:function(e,n){t.setFileSort(n),this.refresh(e)},refresh:function(e){t.navigate("#files/"+e.getKey(),!0)},createFileBack:function(e){if(e.type=="group")return{code:"m_btn_context",link:"#context"};var t=e.get("parent");return t.type=="group"?{code:"m_btn_files",link:"#files/groups:@"+t.id}:{code:"m_back",link:"#file/groups:@"+e.get("group").id+":files:@"+t.id}},getNative:function(e,t){s.getContext(e,function(e){r.list(t,function(n){var r=new l({context:e,path:t,files:n});r.render()})})}})}),define("router/group",["router/base","api/cache","api/model/group","api/model/permission"],function(e,t,n,r){return e.extend({execute:function(e,r){var i=this.getGroupId(r);i?(r.unshift(t.getFrom(new n({id:i}))),this.retrieveGroupWithPermission(e,r)):e.apply(this,r)},getGroupId:function(e){if(e.length>0){var t=e[0].split(":");if(t.length==2&&t[0]=="groups")return t[1].substr(1)}return null},retrieveGroupWithPermission:function(e,t){var n=t[0];this.retrieveGroup(n,function(){if(n.permission)e.apply(self,t);else{var i=new r({},{context:n});i.once("sync",function(){n.permission=i,e.apply(self,t)}),i.fetch()}})},retrieveGroup:function(e,n){e.get("components")?n():(e.once("change",function(){t.putModel(e),n()}),e.fetch())}})}),define("api/collection/content",["api/collection/more","api/model/file"],function(e,t){return e.extend({initialize:function(t,n){e.prototype.initialize.apply(this,arguments),n&&(this.group=n.group)},url:function(){return"/groups/@"+this.group.id+"/"+this.model.type+"s"}})}),define("api/collection/notes",["api/collection/content","api/model/note"],function(e,t){return e.extend({model:t,_getKey:function(e){return e+":"+this.params.orderBy}})}),define("api/service/note",["ext/underscore","app-context","api/cache","api/service/base","api/collection/notes","api/model/note"],function(e,t,n,r,i,s){return e.extend({getPages:function(e,t){var r=this.createPages(e,1);n.putModel(r),this.getCollection(r,t)},getNextPages:function(e,t){var n=this.createPages(e.group,e.params.currentPage+1);this.getCollection(n,function(n){e.add(n.models),e.params.currentPage=n.params.currentPage,e.more=n.more,t(n)})},getPage:function(e,t,r){var i=new s({name:t});t.charAt(0)=="@"&&(i=new s({id:parseInt(t.slice(1))})),i.set("group",e),i=n.getFrom(i);if(i._expiry&&i.get("content")){r(i);return}n.putModel(i),i.once("change",r),i.fetch()},createPages:function(e,n){var r=t.getNoteSort();return new i([],{group:e,params:{type:"page",currentPage:n,pageSize:t.pageSize,orderBy:r,ascending:r=="name"}})}},r)}),define("text!text/note_item.html",[],function(){return"<a class=\"no-icon\" href=\"#page/<%= getKey() %>\">\n	<p><b><%= _.escape(get('friendlyName')) %></b></p>\n	<abbr><%= m_last_updated %>: <%= $.timeago(new Date(get('lastModified'))) %></abbr>\n</a>\n"}),define("view/note/item",["view/base","text!text/note_item.html"],function(e,t){return e.extend({tagName:"li",className:"fat",render:function(){return this.$el.html(this.template(t,this.model)),this}})}),define("view/note/list",["ext/underscore","app-context","view/navbar-factory","view/extending-list","view/sort_action","view/note/item","api/service/note"],function(e,t,n,r,i,s,o){return r.extend({back:{code:"m_btn_context",link:"#context"},initialize:function(){r.prototype.initialize.apply(this,arguments),this.title=e.escape(this.collection.group.get("friendlyName")),this.action={code:"m_actions_sort",view:new i({context:this.collection.group,sort:t.getNoteSort(),callback:this.sortNotes})}},sortNotes:function(e,n){t.setNoteSort(n),t.navigate("#pages/"+e.getKey(),!0)},emptyMsgCode:"m_pages_nothing",itemViewClass:s,handleEndOfList:function(){o.getNextPages(this.collection,this.renderPage)},handleRefresh:function(){var e=this;o.getPages(this.collection.group,function(t){e.collection=t,e.refresh()})},navbar:function(e){this.navbarCreate("pages",this.collection.group.id,e)}}).extend(n)}),function(e,t){function O(e){return i===""?e:(e=e.charAt(0).toUpperCase()+e.substr(1),i+e)}var n=Math,r=t.createElement("div").style,i=function(){var e="t,webkitT,MozT,msT,OT".split(","),t,n=0,i=e.length;for(;n<i;n++){t=e[n]+"ransform";if(t in r)return e[n].substr(0,e[n].length-1)}return!1}(),s=i?"-"+i.toLowerCase()+"-":"",o=O("transform"),u=O("transitionProperty"),a=O("transitionDuration"),f=O("transformOrigin"),l=O("transitionTimingFunction"),c=O("transitionDelay"),h=/android/gi.test(navigator.appVersion),p=/iphone|ipad/gi.test(navigator.appVersion),d=/hp-tablet/gi.test(navigator.appVersion),v=O("perspective")in r,m="ontouchstart"in e&&!d,g=i!==!1,y=O("transition")in r,b="onorientationchange"in e?"orientationchange":"resize",w=m?"touchstart":"mousedown",E=m?"touchmove":"mousemove",S=m?"touchend":"mouseup",x=m?"touchcancel":"mouseup",T=i=="Moz"?"DOMMouseScroll":"mousewheel",N=function(){if(i===!1)return!1;var e={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"};return e[i]}(),C=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){return setTimeout(e,1)}}(),k=function(){return e.cancelRequestAnimationFrame||e.webkitCancelAnimationFrame||e.webkitCancelRequestAnimationFrame||e.mozCancelRequestAnimationFrame||e.oCancelRequestAnimationFrame||e.msCancelRequestAnimationFrame||clearTimeout}(),L=v?" translateZ(0)":"",A=function(n,r){var i=this,c;i.wrapper=typeof n=="object"?n:t.getElementById(n),i.wrapper.style.overflow="hidden",i.scroller=i.wrapper.children[0],i.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:h,hideScrollbar:p,fadeScrollbar:p&&v,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(e){e.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(c in r)i.options[c]=r[c];i.x=i.options.x,i.y=i.options.y,i.options.useTransform=g&&i.options.useTransform,i.options.hScrollbar=i.options.hScroll&&i.options.hScrollbar,i.options.vScrollbar=i.options.vScroll&&i.options.vScrollbar,i.options.zoom=i.options.useTransform&&i.options.zoom,i.options.useTransition=y&&i.options.useTransition,i.options.zoom&&h&&(L=""),i.scroller.style[u]=i.options.useTransform?s+"transform":"top left",i.scroller.style[a]="0",i.scroller.style[f]="0 0",i.options.useTransition&&(i.scroller.style[l]="cubic-bezier(0.33,0.66,0.66,1)"),i.options.useTransform?i.scroller.style[o]="translate("+i.x+"px,"+i.y+"px)"+L:i.scroller.style.cssText+=";position:absolute;top:"+i.y+"px;left:"+i.x+"px",i.options.useTransition&&(i.options.fixedScrollbar=!0),i.refresh(),i._bind(b,e),i._bind(w),m||i.options.wheelAction!="none"&&i._bind(T),i.options.checkDOMChanges&&(i.checkDOMTime=setInterval(function(){i._checkDOMChanges()},500))};A.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(e){var t=this;switch(e.type){case w:if(!m&&e.button!==0)return;t._start(e);break;case E:t._move(e);break;case S:case x:t._end(e);break;case b:t._resize();break;case T:t._wheel(e);break;case N:t._transitionEnd(e)}},_checkDOMChanges:function(){if(this.moved||this.zoomed||this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)return;this.refresh()},_scrollbar:function(e){var r=this,i;if(!r[e+"Scrollbar"]){r[e+"ScrollbarWrapper"]&&(g&&(r[e+"ScrollbarIndicator"].style[o]=""),r[e+"ScrollbarWrapper"].parentNode.removeChild(r[e+"ScrollbarWrapper"]),r[e+"ScrollbarWrapper"]=null,r[e+"ScrollbarIndicator"]=null);return}r[e+"ScrollbarWrapper"]||(i=t.createElement("div"),r.options.scrollbarClass?i.className=r.options.scrollbarClass+e.toUpperCase():i.style.cssText="position:absolute;z-index:100;"+(e=="h"?"height:7px;bottom:1px;left:2px;right:"+(r.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(r.hScrollbar?"7":"2")+"px;top:2px;right:1px"),i.style.cssText+=";pointer-events:none;"+s+"transition-property:opacity;"+s+"transition-duration:"+(r.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(r.options.hideScrollbar?"0":"1"),r.wrapper.appendChild(i),r[e+"ScrollbarWrapper"]=i,i=t.createElement("div"),r.options.scrollbarClass||(i.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+s+"background-clip:padding-box;"+s+"box-sizing:border-box;"+(e=="h"?"height:100%":"width:100%")+";"+s+"border-radius:3px;border-radius:3px"),i.style.cssText+=";pointer-events:none;"+s+"transition-property:"+s+"transform;"+s+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+s+"transition-duration:0;"+s+"transform: translate(0,0)"+L,r.options.useTransition&&(i.style.cssText+=";"+s+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),r[e+"ScrollbarWrapper"].appendChild(i),r[e+"ScrollbarIndicator"]=i),e=="h"?(r.hScrollbarSize=r.hScrollbarWrapper.clientWidth,r.hScrollbarIndicatorSize=n.max(n.round(r.hScrollbarSize*r.hScrollbarSize/r.scrollerW),8),r.hScrollbarIndicator.style.width=r.hScrollbarIndicatorSize+"px",r.hScrollbarMaxScroll=r.hScrollbarSize-r.hScrollbarIndicatorSize,r.hScrollbarProp=r.hScrollbarMaxScroll/r.maxScrollX):(r.vScrollbarSize=r.vScrollbarWrapper.clientHeight,r.vScrollbarIndicatorSize=n.max(n.round(r.vScrollbarSize*r.vScrollbarSize/r.scrollerH),8),r.vScrollbarIndicator.style.height=r.vScrollbarIndicatorSize+"px",r.vScrollbarMaxScroll=r.vScrollbarSize-r.vScrollbarIndicatorSize,r.vScrollbarProp=r.vScrollbarMaxScroll/r.maxScrollY),r._scrollbarPos(e,!0)},_resize:function(){var e=this;setTimeout(function(){e.refresh()},h?200:0)},_pos:function(e,t){if(this.zoomed)return;e=this.hScroll?e:0,t=this.vScroll?t:0,this.options.useTransform?this.scroller.style[o]="translate("+e+"px,"+t+"px) scale("+this.scale+")"+L:(e=n.round(e),t=n.round(t),this.scroller.style.left=e+"px",this.scroller.style.top=t+"px"),this.x=e,this.y=t,this._scrollbarPos("h"),this._scrollbarPos("v")},_scrollbarPos:function(e,t){var r=this,i=e=="h"?r.x:r.y,s;if(!r[e+"Scrollbar"])return;i=r[e+"ScrollbarProp"]*i,i<0?(r.options.fixedScrollbar||(s=r[e+"ScrollbarIndicatorSize"]+n.round(i*3),s<8&&(s=8),r[e+"ScrollbarIndicator"].style[e=="h"?"width":"height"]=s+"px"),i=0):i>r[e+"ScrollbarMaxScroll"]&&(r.options.fixedScrollbar?i=r[e+"ScrollbarMaxScroll"]:(s=r[e+"ScrollbarIndicatorSize"]-n.round((i-r[e+"ScrollbarMaxScroll"])*3),s<8&&(s=8),r[e+"ScrollbarIndicator"].style[e=="h"?"width":"height"]=s+"px",i=r[e+"ScrollbarMaxScroll"]+(r[e+"ScrollbarIndicatorSize"]-s))),r[e+"ScrollbarWrapper"].style[c]="0",r[e+"ScrollbarWrapper"].style.opacity=t&&r.options.hideScrollbar?"0":"1",r[e+"ScrollbarIndicator"].style[o]="translate("+(e=="h"?i+"px,0)":"0,"+i+"px)")+L},_start:function(t){var r=this,i=m?t.touches[0]:t,s,u,a,f,l;if(!r.enabled)return;r.options.onBeforeScrollStart&&r.options.onBeforeScrollStart.call(r,t),(r.options.useTransition||r.options.zoom)&&r._transitionTime(0),r.moved=!1,r.animating=!1,r.zoomed=!1,r.distX=0,r.distY=0,r.absDistX=0,r.absDistY=0,r.dirX=0,r.dirY=0,r.options.zoom&&m&&t.touches.length>1&&(f=n.abs(t.touches[0].pageX-t.touches[1].pageX),l=n.abs(t.touches[0].pageY-t.touches[1].pageY),r.touchesDistStart=n.sqrt(f*f+l*l),r.originX=n.abs(t.touches[0].pageX+t.touches[1].pageX-r.wrapperOffsetLeft*2)/2-r.x,r.originY=n.abs(t.touches[0].pageY+t.touches[1].pageY-r.wrapperOffsetTop*2)/2-r.y,r.options.onZoomStart&&r.options.onZoomStart.call(r,t));
if(r.options.momentum){r.options.useTransform?(s=getComputedStyle(r.scroller,null)[o].replace(/[^0-9\-.,]/g,"").split(","),u=+s[4],a=+s[5]):(u=+getComputedStyle(r.scroller,null).left.replace(/[^0-9-]/g,""),a=+getComputedStyle(r.scroller,null).top.replace(/[^0-9-]/g,""));if(u!=r.x||a!=r.y)r.options.useTransition?r._unbind(N):k(r.aniTime),r.steps=[],r._pos(u,a),r.options.onScrollEnd&&r.options.onScrollEnd.call(r)}r.absStartX=r.x,r.absStartY=r.y,r.startX=r.x,r.startY=r.y,r.pointX=i.pageX,r.pointY=i.pageY,r.startTime=t.timeStamp||Date.now(),r.options.onScrollStart&&r.options.onScrollStart.call(r,t),r._bind(E,e),r._bind(S,e),r._bind(x,e)},_move:function(e){var t=this,r=m?e.touches[0]:e,i=r.pageX-t.pointX,s=r.pageY-t.pointY,u=t.x+i,a=t.y+s,f,l,c,h=e.timeStamp||Date.now();t.options.onBeforeScrollMove&&t.options.onBeforeScrollMove.call(t,e);if(t.options.zoom&&m&&e.touches.length>1){f=n.abs(e.touches[0].pageX-e.touches[1].pageX),l=n.abs(e.touches[0].pageY-e.touches[1].pageY),t.touchesDist=n.sqrt(f*f+l*l),t.zoomed=!0,c=1/t.touchesDistStart*t.touchesDist*this.scale,c<t.options.zoomMin?c=.5*t.options.zoomMin*Math.pow(2,c/t.options.zoomMin):c>t.options.zoomMax&&(c=2*t.options.zoomMax*Math.pow(.5,t.options.zoomMax/c)),t.lastScale=c/this.scale,u=this.originX-this.originX*t.lastScale+this.x,a=this.originY-this.originY*t.lastScale+this.y,this.scroller.style[o]="translate("+u+"px,"+a+"px) scale("+c+")"+L,t.options.onZoom&&t.options.onZoom.call(t,e);return}t.pointX=r.pageX,t.pointY=r.pageY;if(u>0||u<t.maxScrollX)u=t.options.bounce?t.x+i/2:u>=0||t.maxScrollX>=0?0:t.maxScrollX;if(a>t.minScrollY||a<t.maxScrollY)a=t.options.bounce?t.y+s/2:a>=t.minScrollY||t.maxScrollY>=0?t.minScrollY:t.maxScrollY;t.distX+=i,t.distY+=s,t.absDistX=n.abs(t.distX),t.absDistY=n.abs(t.distY);if(t.absDistX<6&&t.absDistY<6)return;t.options.lockDirection&&(t.absDistX>t.absDistY+5?(a=t.y,s=0):t.absDistY>t.absDistX+5&&(u=t.x,i=0)),t.moved=!0,t._pos(u,a),t.dirX=i>0?-1:i<0?1:0,t.dirY=s>0?-1:s<0?1:0,h-t.startTime>300&&(t.startTime=h,t.startX=t.x,t.startY=t.y),t.options.onScrollMove&&t.options.onScrollMove.call(t,e)},_end:function(r){if(m&&r.touches.length!==0)return;var i=this,s=m?r.changedTouches[0]:r,u,f,l={dist:0,time:0},c={dist:0,time:0},h=(r.timeStamp||Date.now())-i.startTime,p=i.x,d=i.y,v,g,y,b,w;i._unbind(E,e),i._unbind(S,e),i._unbind(x,e),i.options.onBeforeScrollEnd&&i.options.onBeforeScrollEnd.call(i,r);if(i.zoomed){w=i.scale*i.lastScale,w=Math.max(i.options.zoomMin,w),w=Math.min(i.options.zoomMax,w),i.lastScale=w/i.scale,i.scale=w,i.x=i.originX-i.originX*i.lastScale+i.x,i.y=i.originY-i.originY*i.lastScale+i.y,i.scroller.style[a]="200ms",i.scroller.style[o]="translate("+i.x+"px,"+i.y+"px) scale("+i.scale+")"+L,i.zoomed=!1,i.refresh(),i.options.onZoomEnd&&i.options.onZoomEnd.call(i,r);return}if(!i.moved){m&&(i.doubleTapTimer&&i.options.zoom?(clearTimeout(i.doubleTapTimer),i.doubleTapTimer=null,i.options.onZoomStart&&i.options.onZoomStart.call(i,r),i.zoom(i.pointX,i.pointY,i.scale==1?i.options.doubleTapZoom:1),i.options.onZoomEnd&&setTimeout(function(){i.options.onZoomEnd.call(i,r)},200)):this.options.handleClick&&(i.doubleTapTimer=setTimeout(function(){i.doubleTapTimer=null,u=s.target;while(u.nodeType!=1)u=u.parentNode;u.tagName!="SELECT"&&u.tagName!="INPUT"&&u.tagName!="TEXTAREA"&&(f=t.createEvent("MouseEvents"),f.initMouseEvent("click",!0,!0,r.view,1,s.screenX,s.screenY,s.clientX,s.clientY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,0,null),f._fake=!0,u.dispatchEvent(f))},i.options.zoom?250:0))),i._resetPos(400),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r);return}if(h<300&&i.options.momentum){l=p?i._momentum(p-i.startX,h,-i.x,i.scrollerW-i.wrapperW+i.x,i.options.bounce?i.wrapperW:0):l,c=d?i._momentum(d-i.startY,h,-i.y,i.maxScrollY<0?i.scrollerH-i.wrapperH+i.y-i.minScrollY:0,i.options.bounce?i.wrapperH:0):c,p=i.x+l.dist,d=i.y+c.dist;if(i.x>0&&p>0||i.x<i.maxScrollX&&p<i.maxScrollX)l={dist:0,time:0};if(i.y>i.minScrollY&&d>i.minScrollY||i.y<i.maxScrollY&&d<i.maxScrollY)c={dist:0,time:0}}if(l.dist||c.dist){y=n.max(n.max(l.time,c.time),10),i.options.snap&&(v=p-i.absStartX,g=d-i.absStartY,n.abs(v)<i.options.snapThreshold&&n.abs(g)<i.options.snapThreshold?i.scrollTo(i.absStartX,i.absStartY,200):(b=i._snap(p,d),p=b.x,d=b.y,y=n.max(b.time,y))),i.scrollTo(n.round(p),n.round(d),y),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r);return}if(i.options.snap){v=p-i.absStartX,g=d-i.absStartY,n.abs(v)<i.options.snapThreshold&&n.abs(g)<i.options.snapThreshold?i.scrollTo(i.absStartX,i.absStartY,200):(b=i._snap(i.x,i.y),(b.x!=i.x||b.y!=i.y)&&i.scrollTo(b.x,b.y,b.time)),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r);return}i._resetPos(200),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r)},_resetPos:function(e){var t=this,n=t.x>=0?0:t.x<t.maxScrollX?t.maxScrollX:t.x,r=t.y>=t.minScrollY||t.maxScrollY>0?t.minScrollY:t.y<t.maxScrollY?t.maxScrollY:t.y;if(n==t.x&&r==t.y){t.moved&&(t.moved=!1,t.options.onScrollEnd&&t.options.onScrollEnd.call(t)),t.hScrollbar&&t.options.hideScrollbar&&(i=="webkit"&&(t.hScrollbarWrapper.style[c]="300ms"),t.hScrollbarWrapper.style.opacity="0"),t.vScrollbar&&t.options.hideScrollbar&&(i=="webkit"&&(t.vScrollbarWrapper.style[c]="300ms"),t.vScrollbarWrapper.style.opacity="0");return}t.scrollTo(n,r,e||0)},_wheel:function(e){var t=this,n,r,i,s,o;if("wheelDeltaX"in e)n=e.wheelDeltaX/12,r=e.wheelDeltaY/12;else if("wheelDelta"in e)n=r=e.wheelDelta/12;else{if(!("detail"in e))return;n=r=-e.detail*3}if(t.options.wheelAction=="zoom"){o=t.scale*Math.pow(2,1/3*(r?r/Math.abs(r):0)),o<t.options.zoomMin&&(o=t.options.zoomMin),o>t.options.zoomMax&&(o=t.options.zoomMax),o!=t.scale&&(!t.wheelZoomCount&&t.options.onZoomStart&&t.options.onZoomStart.call(t,e),t.wheelZoomCount++,t.zoom(e.pageX,e.pageY,o,400),setTimeout(function(){t.wheelZoomCount--,!t.wheelZoomCount&&t.options.onZoomEnd&&t.options.onZoomEnd.call(t,e)},400));return}i=t.x+n,s=t.y+r,i>0?i=0:i<t.maxScrollX&&(i=t.maxScrollX),s>t.minScrollY?s=t.minScrollY:s<t.maxScrollY&&(s=t.maxScrollY),t.maxScrollY<0&&t.scrollTo(i,s,0)},_transitionEnd:function(e){var t=this;if(e.target!=t.scroller)return;t._unbind(N),t._startAni()},_startAni:function(){var e=this,t=e.x,r=e.y,i=Date.now(),s,o,u;if(e.animating)return;if(!e.steps.length){e._resetPos(400);return}s=e.steps.shift(),s.x==t&&s.y==r&&(s.time=0),e.animating=!0,e.moved=!0;if(e.options.useTransition){e._transitionTime(s.time),e._pos(s.x,s.y),e.animating=!1,s.time?e._bind(N):e._resetPos(0);return}u=function(){var a=Date.now(),f,l;if(a>=i+s.time){e._pos(s.x,s.y),e.animating=!1,e.options.onAnimationEnd&&e.options.onAnimationEnd.call(e),e._startAni();return}a=(a-i)/s.time-1,o=n.sqrt(1-a*a),f=(s.x-t)*o+t,l=(s.y-r)*o+r,e._pos(f,l),e.animating&&(e.aniTime=C(u))},u()},_transitionTime:function(e){e+="ms",this.scroller.style[a]=e,this.hScrollbar&&(this.hScrollbarIndicator.style[a]=e),this.vScrollbar&&(this.vScrollbarIndicator.style[a]=e)},_momentum:function(e,t,r,i,s){var o=6e-4,u=n.abs(e)/t,a=u*u/(2*o),f=0,l=0;return e>0&&a>r?(l=s/(6/(a/u*o)),r+=l,u=u*r/a,a=r):e<0&&a>i&&(l=s/(6/(a/u*o)),i+=l,u=u*i/a,a=i),a*=e<0?-1:1,f=u/o,{dist:a,time:n.round(f)}},_offset:function(e){var t=-e.offsetLeft,n=-e.offsetTop;while(e=e.offsetParent)t-=e.offsetLeft,n-=e.offsetTop;return e!=this.wrapper&&(t*=this.scale,n*=this.scale),{left:t,top:n}},_snap:function(e,t){var r=this,i,s,o,u,a,f;o=r.pagesX.length-1;for(i=0,s=r.pagesX.length;i<s;i++)if(e>=r.pagesX[i]){o=i;break}o==r.currPageX&&o>0&&r.dirX<0&&o--,e=r.pagesX[o],a=n.abs(e-r.pagesX[r.currPageX]),a=a?n.abs(r.x-e)/a*500:0,r.currPageX=o,o=r.pagesY.length-1;for(i=0;i<o;i++)if(t>=r.pagesY[i]){o=i;break}return o==r.currPageY&&o>0&&r.dirY<0&&o--,t=r.pagesY[o],f=n.abs(t-r.pagesY[r.currPageY]),f=f?n.abs(r.y-t)/f*500:0,r.currPageY=o,u=n.round(n.max(a,f))||200,{x:e,y:t,time:u}},_bind:function(e,t,n){(t||this.scroller).addEventListener(e,this,!!n)},_unbind:function(e,t,n){(t||this.scroller).removeEventListener(e,this,!!n)},destroy:function(){var t=this;t.scroller.style[o]="",t.hScrollbar=!1,t.vScrollbar=!1,t._scrollbar("h"),t._scrollbar("v"),t._unbind(b,e),t._unbind(w),t._unbind(E,e),t._unbind(S,e),t._unbind(x,e),t.options.hasTouch||t._unbind(T),t.options.useTransition&&t._unbind(N),t.options.checkDOMChanges&&clearInterval(t.checkDOMTime),t.options.onDestroy&&t.options.onDestroy.call(t)},refresh:function(){var e=this,t,r,i,s,o=0,u=0;e.scale<e.options.zoomMin&&(e.scale=e.options.zoomMin),e.wrapperW=e.wrapper.clientWidth||1,e.wrapperH=e.wrapper.clientHeight||1,e.minScrollY=-e.options.topOffset||0,e.scrollerW=n.round(e.scroller.offsetWidth*e.scale),e.scrollerH=n.round((e.scroller.offsetHeight+e.minScrollY)*e.scale),e.maxScrollX=e.wrapperW-e.scrollerW,e.maxScrollY=e.wrapperH-e.scrollerH+e.minScrollY,e.dirX=0,e.dirY=0,e.options.onRefresh&&e.options.onRefresh.call(e),e.hScroll=e.options.hScroll&&e.maxScrollX<0,e.vScroll=e.options.vScroll&&(!e.options.bounceLock&&!e.hScroll||e.scrollerH>e.wrapperH),e.hScrollbar=e.hScroll&&e.options.hScrollbar,e.vScrollbar=e.vScroll&&e.options.vScrollbar&&e.scrollerH>e.wrapperH,t=e._offset(e.wrapper),e.wrapperOffsetLeft=-t.left,e.wrapperOffsetTop=-t.top;if(typeof e.options.snap=="string"){e.pagesX=[],e.pagesY=[],s=e.scroller.querySelectorAll(e.options.snap);for(r=0,i=s.length;r<i;r++)o=e._offset(s[r]),o.left+=e.wrapperOffsetLeft,o.top+=e.wrapperOffsetTop,e.pagesX[r]=o.left<e.maxScrollX?e.maxScrollX:o.left*e.scale,e.pagesY[r]=o.top<e.maxScrollY?e.maxScrollY:o.top*e.scale}else if(e.options.snap){e.pagesX=[];while(o>=e.maxScrollX)e.pagesX[u]=o,o-=e.wrapperW,u++;e.maxScrollX%e.wrapperW&&(e.pagesX[e.pagesX.length]=e.maxScrollX-e.pagesX[e.pagesX.length-1]+e.pagesX[e.pagesX.length-1]),o=0,u=0,e.pagesY=[];while(o>=e.maxScrollY)e.pagesY[u]=o,o-=e.wrapperH,u++;e.maxScrollY%e.wrapperH&&(e.pagesY[e.pagesY.length]=e.maxScrollY-e.pagesY[e.pagesY.length-1]+e.pagesY[e.pagesY.length-1])}e._scrollbar("h"),e._scrollbar("v"),e.zoomed||(e.scroller.style[a]="0",e._resetPos(400))},scrollTo:function(e,t,n,r){var i=this,s=e,o,u;i.stop(),s.length||(s=[{x:e,y:t,time:n,relative:r}]);for(o=0,u=s.length;o<u;o++)s[o].relative&&(s[o].x=i.x-s[o].x,s[o].y=i.y-s[o].y),i.steps.push({x:s[o].x,y:s[o].y,time:s[o].time||0});i._startAni()},scrollToElement:function(e,t){var r=this,i;e=e.nodeType?e:r.scroller.querySelector(e);if(!e)return;i=r._offset(e),i.left+=r.wrapperOffsetLeft,i.top+=r.wrapperOffsetTop,i.left=i.left>0?0:i.left<r.maxScrollX?r.maxScrollX:i.left,i.top=i.top>r.minScrollY?r.minScrollY:i.top<r.maxScrollY?r.maxScrollY:i.top,t=t===undefined?n.max(n.abs(i.left)*2,n.abs(i.top)*2):t,r.scrollTo(i.left,i.top,t)},scrollToPage:function(e,t,n){var r=this,i,s;n=n===undefined?400:n,r.options.onScrollStart&&r.options.onScrollStart.call(r),r.options.snap?(e=e=="next"?r.currPageX+1:e=="prev"?r.currPageX-1:e,t=t=="next"?r.currPageY+1:t=="prev"?r.currPageY-1:t,e=e<0?0:e>r.pagesX.length-1?r.pagesX.length-1:e,t=t<0?0:t>r.pagesY.length-1?r.pagesY.length-1:t,r.currPageX=e,r.currPageY=t,i=r.pagesX[e],s=r.pagesY[t]):(i=-r.wrapperW*e,s=-r.wrapperH*t,i<r.maxScrollX&&(i=r.maxScrollX),s<r.maxScrollY&&(s=r.maxScrollY)),r.scrollTo(i,s,n)},disable:function(){this.stop(),this._resetPos(0),this.enabled=!1,this._unbind(E,e),this._unbind(S,e),this._unbind(x,e)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(N):k(this.aniTime),this.steps=[],this.moved=!1,this.animating=!1},zoom:function(e,t,n,r){var i=this,s=n/i.scale;if(!i.options.useTransform)return;i.zoomed=!0,r=r===undefined?200:r,e=e-i.wrapperOffsetLeft-i.x,t=t-i.wrapperOffsetTop-i.y,i.x=e-e*s+i.x,i.y=t-t*s+i.y,i.scale=n,i.refresh(),i.x=i.x>0?0:i.x<i.maxScrollX?i.maxScrollX:i.x,i.y=i.y>i.minScrollY?i.minScrollY:i.y<i.maxScrollY?i.maxScrollY:i.y,i.scroller.style[a]=r+"ms",i.scroller.style[o]="translate("+i.x+"px,"+i.y+"px) scale("+n+")"+L,i.zoomed=!1},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}},r=null,typeof exports!="undefined"?exports.iScroll=A:e.iScroll=A}(window,document),define("lib/iscroll",function(e){return function(){var t,n;return t||e.iScroll}}(this)),define("api/model/attachment",["api/model/base"],function(e){return e.extend({url:function(){var e=this.get("parent"),t=this.id?"@"+this.id:this.get("name");return"/groups/@"+e.group.id+"/"+e.type+"s/@"+e.id+"/attachments/"+t+"/"}})}),define("view/note/view",["ext/underscore","jquery","view/page","app-context","lib/iscroll","api/factory","api/model/attachment","view/navbar-factory"],function(e,t,n,r,i,s,o,u){return n.extend({attributes:{id:"scroll-wrapper"},initialize:function(t){n.prototype.initialize.apply(this,arguments),this.group=this.model.getGroup(),this.back={code:"m_btn_pages",link:"#pages/"+this.group.getKey()},this.title=e.escape(this.model.get("friendlyName")),this.action={code:"m_comments",link:"#comments/"+this.model.getKey()},this.handlers={attachment:this.handleImage,attachment_document:this.handleDocument,video:this.handleVideo,attachment_video:this.handleVideo,link:this.handleLinks}},handleImage:function(e,t){e.src=r.fullUrl("/groups/@"+this.model.getGroup().id+"/pages/"+this.model.get("name")+"/attachments/"+t[0]+"/preview")},handleDocument:function(n,r){var i=t("<a>").attr("href","javascript:void(0)").html(r[0]).click(e.bind(this.showAttachment,this,r[0]));t(n).replaceWith(i)},showAttachment:function(e){var t=new o({name:e,parent:this.model.toJSON()});t.on("change",function(){r.preview(this)}),t.fetch()},handleVideo:function(e){e.src=r.getAppUrl()+"/styles/images/video_preview.png"},handleLinks:function(e,n){if(n[0]=="url"){t(e).attr("data-external",!0);return}var r=s.createEntity({type:n[0],group:this.model.getGroup().toJSON(),name:n[1]});r?e.href="#"+n[0]+"/"+r.getKey():t(e).removeAttr("href")},render:function(){n.prototype.render.apply(this,arguments),t("<div>").addClass("html-content").html(this.model.get("content")).appendTo(this.$el),e.each(this.$el.find("[media_link]"),function(n){var r=t(n).attr("media_link").split(":"),i=this.handlers[r[0]];i&&i.apply(this,[n,e.rest(r)])},this);var r=30,s=this.$root.width()/(this.$el.find("div.html-content").width()+r),o=new i(this.el,{zoom:!0,zoomMin:s});return o.zoom(0,0,s,0),o.refresh(),this},navbar:function(e){this.navbarCreate("pages",this.group.id,e)}}).extend(u)}),define("router/note",["router/group","api/cache","api/service/note","view/note/list","view/note/view"],function(e,t,n,r,i){return e.extend({routes:{"pages/:groupKey":"showPages","page/:pageKey":"getPage"},showPages:function(e){var i=t.getFrom(n.createPages(e,1)),s=new r({collection:i});s.render(),s.handleRefresh()},getPage:function(e){var t=e.split(":"),r={id:parseInt(t[1].substr(1))};n.getPage(r,t[3],this.showPage)},showPage:function(e){new i({model:e}).render()}})}),define("api/collection/discussions",["api/collection/content","api/model/discussion"],function(e,t){return e.extend({model:t})}),define("api/model/discussion-reply",["api/model/base"],function(e){return e.extend({url:function(){var e=this.id?"/@"+this.id:"";return this.collection.url()+e}})}),define("api/collection/discussion-replies",["api/collection/base","api/model/discussion-reply"],function(e,t){return e.extend({model:t,initialize:function(e,t){this.discussion=t.discussion},url:function(){return this.discussion.url()+"/replies"}})}),define("api/service/discussion",["ext/underscore","app-context","api/cache","api/service/base","api/collection/discussions","api/collection/discussion-replies","api/model/discussion-reply","api/model/discussion"],function(e,t,n,r,i,s,o,u){return e.extend({getDiscussions:function(e,t){var r=this.createDiscussions(e,1);n.putModel(r),this.getCollection(r,t)},getNextDiscussions:function(e,t){var n=this.createDiscussions(group,e.params.currentPage+1);this.getCollection(n,function(n){e.add(n.models),e.params.currentPage=n.params.currentPage,e.more=n.more,t(n)})},getDiscussion:function(t,r,i){var s=new u({name:r});r.charAt(0)=="@"&&(s=new u({id:parseInt(r.slice(1))})),s.set("group",t),s=n.getFrom(s);if(s._expiry){s.replies?i(s):this._getReplies(s,i);return}n.putModel(s);var o=e.after(2,i);s.once("change",o),s.fetch(),this._getReplies(s,o)},_getReplies:function(e,t){e.replies=new s([],{discussion:e}),e.replies.once("sync",function(){t(e)}),e.replies.fetch()},createDiscussion:function(t,n,r){n.group={id:t.group.id};var i=new u(n);t.add(i),i.save(),i.once("change",e.bind(r,this,i))},createReply:function(t,n,r){var i=new o({reply:n});t.add(i),i.save(),i.once("change",e.bind(r,this,i))},createDiscussions:function(e,n){return new i([],{group:e,params:{currentPage:n,pageSize:t.pageSize}})}},r)}),define("text!text/discussion/item.html",[],function(){return"<a class=\"no-icon\" href=\"#discussion/<%= getKey() %>\">\n	<p><b><%= _.escape(get('friendlyName')) %></b></p>\n	<abbr><%= m_last_updated %>: <%= $.timeago(new Date(get('lastModified'))) %></abbr>\n	<span class=\"badge\"><%= get('replies') %></span>\n</a>\n"}),define("view/discussion/item",["view/base","text!text/discussion/item.html"],function(e,t){return e.extend({tagName:"li",className:"fat",render:function(){return this.$el.html(this.template(t,this.model)),this}})}),define("view/discussion/list",["ext/underscore","view/navbar-factory","view/extending-list","view/discussion/item","api/service/discussion"],function(e,t,n,r,i){return n.extend({back:{code:"m_btn_context",link:"#context"},initialize:function(){n.prototype.initialize.apply(this,arguments);var t=this.collection.group;this.title=e.escape(t.get("friendlyName")),t.permission.canCreate()&&(this.action={code:"m_new",link:"#discussions/"+t.getKey()+"/create"})},emptyMsgCode:"m_discussions_nothing",itemViewClass:r,handleEndOfList:function(){i.getNextDiscussions(this.collection,this.renderPage)},handleRefresh:function(){var e=this;i.getDiscussions(this.collection.group,function(t){e.collection=t,e.refresh()})},navbar:function(e){this.navbarCreate("discussions",this.collection.group.id,e)}}).extend(t)}),define("text!text/discussion/create.html",[],function(){return'<input class="form-control" name="topic" placeholder="<%= m_discussion_topic %>" type="text" maxlength="128">\n<textarea class="editor hidden" placeholder="<%= m_discussion_first %>"></textarea>\n<a href="javascript:void(0)" id="post" class="btn btn-primary" disabled="disabled">\n	<%= m_post %>\n</a>\n'}),define("view/discussion/create",["ext/underscore","jquery","app-context","view/page","view/editor","api/service/discussion","text!text/discussion/create.html"],function(e,t,n,r,i,s,o){return r.extend({tagName:"fieldset",events:{"keyup [name=topic]":"onKeyup","click #post":"post"},title:r.message("m_create_discussion"),nosearch:!0,initialize:function(e){r.prototype.initialize.apply(this,arguments),this.editor=new i({context:this.options.discussions.group,$page:this.$el}),this.action={code:"m_mention",view:this.editor},this.back={code:"m_btn_discussions",link:"#discussions/"+this.options.discussions.group.getKey()}},render:function(){return r.prototype.render.apply(this,arguments),this.$el.html(this.template(o)),this.editor.render_delayed(),this},onKeyup:function(){t("#post",this.$el).attr("disabled",e.isBlank(t("[name=topic]",this.el).val()))},post:function(){s.createDiscussion(this.options.discussions,{friendlyName:t("[name=topic]",this.el).val(),description:this.editor.getText()},function(e){n.navigate("#discussion/"+e.getKey())})}})}),define("text!text/discussion/reply.html",[],function(){return"<div>\n	<img src=\"<%= cdn %>/users/<%= model.get('author').id %>/thumbnail\"\n		onerror='this.onerror = null; this.src=\"<%= appurl %>/styles/images/default_thumbnail.png\"'>\n	<p><%= _.isBlank(model.get('reply')) ? '&nbsp;' : model.get('reply') %></p>\n	<p class=\"who-when\"><%= model.get('author').name %> (<%= $.timeago(new Date(model.get('dateCreated'))) %>)</p>\n	<% if ((me.id == model.get('author').id) && !readonly) { %>\n		<a href=\"javascript:void(0)\" class=\"comment-delete\">\n			<span class=\"glyphicon glyphicon-trash\"></span>\n		</a>\n	<% } %>\n</div>\n"}),define("view/discussion/reply",["ext/underscore","view/base","app-context","api/service/general","text!text/discussion/reply.html"],function(e,t,n,r,i){return t.extend({attributes:{"class":"comment"},events:{"click .comment-delete":"onDelete"},initialize:function(t){e.bindToMethods(this),this.replyViews=[],this.options=t},render:function(){var e={readonly:this.options.readonly,model:this.model,cdn:n.cdn,me:n.getPrinciple()};return this.$el.html(this.template(i,e)),this},onDelete:function(){r.deleteModel(this.model,this.onDeleted)},onDeleted:function(){this.$el.remove()}})}),define("view/discussion/view",["ext/underscore","jquery","view/page","api/model/discussion-reply","view/navbar-factory","view/discussion/reply"],function(e,t,n,r,i,s){return n.extend({className:"comments",initialize:function(t){n.prototype.initialize.apply(this,arguments),this.group=this.model.getGroup(),this.back={code:"m_btn_discussions",link:"#discussions/"+this.group.getKey()},this.title=e.escape(this.model.get("friendlyName")),this.action={code:"m_reply",link:"#discussion/"+this.model.getKey()+"/create"}},render:function(){n.prototype.render.apply(this,arguments);var e=new s({model:new r({author:this.model.get("author"),reply:this.model.get("description"),dateCreated:this.model.get("dateCreated")}),readonly:!0});this.$el.append(e.render().el);var t=this.getSelectedReply();return this.model.replies.each(function(e){var n=new s({model:e}),r=n.render().$el;this.$el.append(r),t==e.id&&(r.addClass("selected"),this.scroll(r.offset().top-52))},this),this},getSelectedReply:function(){var t=e.sortBy(this.model.replies.toJSON(),function(e){return-e.dateCreated}),n=e.find(t,function(e){return e.dateCreated<=this.options.dateOfSelection},this);return n?n.id:-1},navbar:function(e){this.navbarCreate("discussions",this.group.id,e)}}).extend(i)}),define("view/discussion/create-reply",["app-context","view/editor-page","api/service/discussion"],function(e,t,n){return t.extend({title:t.message("m_create_reply"),nosearch:!0,initialize:function(){t.prototype.initialize.apply(this,arguments),this.back={code:"m_discussion",link:"#discussion/"+this.options.replies.discussion.getKey()}},post:function(){var t=this.back.link;n.createReply(this.options.replies,this.editor.getText(),function(n){e.navigate(t+"/"+n.get("dateCreated"))})}})}),define("router/discussion",["router/group","api/cache","api/service/discussion","view/discussion/list","view/discussion/create","view/discussion/view","view/discussion/create-reply"],function(e,t,n,r,i,s,o){return e.extend({routes:{"discussions/:groupKey/create":"createDiscussion","discussions/:groupKey":"showDiscussions","discussion/:discussionKey/create":"createReply","discussion/:discussionKey/:dateOfSelection":"getDiscussion","discussion/:discussionKey":"getDiscussion"},showDiscussions:function(e){var i=t.getFrom(n.createDiscussions(e,1)),s=new r({collection:i});s.render(),s.handleRefresh()},createDiscussion:function(e){var r=t.getFrom(n.createDiscussions(e,1));new i({discussions:r}).render()},getDiscussion:function(e,t){var r=e.split(":"),i={id:parseInt(r[1].substr(1))};n.getDiscussion(i,r[3],function(e){var n={model:e};t&&(n.dateOfSelection=parseInt(t)),new s(n).render()})},createReply:function(e){var t=this,r=e.split(":"),i={id:parseInt(r[1].substr(1))};n.getDiscussion(i,r[3],function(e){t.showReplyCreate(e.replies)})},showReplyCreate:function(e){new o({context:e.discussion.getGroup(),replies:e}).render()}})}),define("api/collection/events",["api/collection/content","api/model/event"],function(e,t){return e.extend({model:t})}),define("api/collection/requests",["api/collection/base","api/model/request"],function(e,t){return e.extend({model:t,initialize:function(e,t){t&&t.context&&(this.context=t.context)},url:function(){return this.context.url()+"/requests"}})}),define("api/service/event",["ext/underscore","app-context","api/cache","api/service/base","api/collection/events","api/collection/requests","api/model/event"],function(e,t,n,r,i,s,o){return e.extend({getEvents:function(e,t){var r=this.createEvents(e,1);n.putModel(r),this.getCollection(r,t)},getNextEvents:function(e,t){var n=this.createEvents(e.group,e.params.currentPage+1);this.getCollection(n,function(n){e.add(n.models),e.params.currentPage=n.params.currentPage,e.more=n.more,t(n)})},getEvent:function(t,r,i){var s=new o({name:r});r.charAt(0)=="@"&&(s=new o({id:parseInt(r.slice(1))})),s.set("group",t),s=n.getFrom(s);if(s._expiry){s.requests?i(s):this._getRequests(s,i);return}n.putModel(s);var u=e.after(2,i);s.once("change",u),s.fetch(),this._getRequests(s,u)},_getRequests:function(e,t){e.requests=new s([],{context:e}),e.requests.once("sync",function(){t(e)}),e.requests.fetch()},createEvents:function(e,n){return new i([],{group:e,params:{currentPage:n,pageSize:t.pageSize}})}},r)}),define("text!text/event/item.html",[],function(){return"<a class=\"no-icon\" href=\"#event/<%= getKey() %>\">\n	<p><b><%= _.escape(get('friendlyName')) %></b></p>\n	<abbr><%= when %>, <%= m_by %> <%= get('author').name %></abbr>\n	<span class=\"badge\"><%= get('attendees') %></span>\n</a>\n"}),define("view/event/item",["ext/underscore","view/base","text!text/event/item.html"],function(e,t,n){return t.extend({tagName:"li",render:function(){var t=this.model.get("dateLabel");if(t)this.$el.addClass("list-divider").html(t);else{this.$el.addClass("fat");var r=e.extend({when:this.getTime()},this.model);this.$el.html(this.template(n,r))}return this},getTime:function(){if(this.model.get("allDay")){if(this.model.isSameDay())return this.message("m_all_day");var e=moment(this.model.get("endDate"));return this.message("m_all_day")+" "+this.message("m_to")+e.format(" DD/MM/YY")}var t=moment(this.model.get("startDate")).format("HH:mm "),e=moment(this.model.get("endDate"));return this.model.isSameDay()?t+this.message("m_to")+e.format(" HH:mm"):t+this.message("m_to")+e.format(" DD/MM/YY, HH:mm")}})}),define("view/event/list",["ext/underscore","api/service/event","api/collection/events","api/model/event","view/navbar-factory","view/extending-list","view/event/item"],function(e,t,n,r,i,s,o){return s.extend({back:{code:"m_btn_context",link:"#context"},initialize:function(){s.prototype.initialize.apply(this,arguments),this.title=e.escape(this.collection.group.get("friendlyName")),this.groupEvents()},groupEvents:function(){var t=e.groupBy(this.collection.models,function(e){return this.extractDateLabel(e.get("startDate"))},this);this.collection=new n([],{group:this.collection.group}),e.each(e.keys(t),function(e){this.collection.add(new r({dateLabel:e})),this.collection.add(t[e])},this)},emptyMsgCode:"m_events_nothing",itemViewClass:o,handleEndOfList:function(){t.getNextEvents(this.collection,this.renderPage)},handleRefresh:function(){var e=this;t.getEvents(this.collection.group,function(t){e.collection=t,e.groupEvents(),e.refresh()})},navbar:function(e){this.navbarCreate("events",this.collection.group.id,e)}}).extend(i)}),define("text!text/request/item.html",[],function(){return'<% if (request.get(\'target\').logo) { %>\n	<img src="<%= appContext.cdn %>/users/<%= request.get(\'target\').id %>/thumbnail">\n<% } else { %>\n	<img src="<%= appContext.defaultThumb %>">\n<% } %>\n<span><%= request.get(\'target\').name %></span>\n<% if (deletable) { %>\n	<a href="javascript:void(0)" class="comment-delete">\n		<span class="glyphicon glyphicon-trash"></span>\n	</a>\n<% } %>\n'}),define("view/request/item",["ext/underscore","backbone","app-context","text!text/request/item.html"],function(e,t,n,r){return t.View.extend({tagName:"li",events:{"click .comment-delete":"onDelete"},initialize:function(e){this.options=e},render:function(){var t=e.extend({appContext:n,deletable:!1},this.options);return this.$el.html(e.template(r,t)),this},onDelete:function(){this.options.collection.remove(this.options.request)}})}),define("text!text/request/group.html",[],function(){return"<h5 class=\"request-<%= status %>\">\n	<%= messages['m_request_' + type + '_' + status] %>\n</h5>\n<ul class=\"list-unstyled\"></ul>\n"}),define("view/request/group",["ext/underscore","jquery","view/base","view/request/item","text!text/request/group.html"],function(e,t,n,r,i){return n.extend({initialize:function(e){this.options=e},render:function(){this.$el.html(this.template(i,this.options));var n=t("ul",this.$el);return e.each(this.options.requestGroup,function(t){var i=e.extend({request:t},this.options),s=new r(i);n.append(s.render().el)},this),this}})}),define("view/request/list",["ext/underscore","backbone","view/request/group"],function(e,t,n){return t.View.extend({className:"requests",initialize:function(e){this.options=e},render:function(){var t=e.groupBy(this.collection.models,function(e){return e.get("status")});return this.$el.empty(),e.each(["ACCEPT","REJECT","DECLINE","MAYBE","NONE"],function(r){if(!t[r])return;var i=e.extend({status:r,requestGroup:t[r]},this.options),s=new n(i);this.$el.append(s.render().el)},this),this}})}),define("text!text/event/view.html",[],function(){return"<div class=\"entity-info\" >\n	<%= get('description') %>\n	<% if (get('location')) { %>\n		<p>\n			<%= m_event_location %>: <%= _.escape(get('location')) %>\n		</p>\n	<% } %>\n	<%= when %>\n	<% if (get('attendeeLimit')) { %>\n		<p>\n			<%= m_event_places %>: <%= get('attendees') %> <%= m_event_of %> <%= get('attendeeLimit') %>\n		</p>\n	<% } %>\n</div>\n<% if (answer) { %>\n	<a href='javascript:void(0)' class='btn btn-success'>\n		<%= m_event_ACCEPT %>\n	</a>\n	<a href='javascript:void(0)' class='btn btn-danger'>\n		<%= m_event_DECLINE %>\n	</a>\n	<a href='javascript:void(0)' class='btn btn-warning'>\n		<%= m_event_MAYBE %>\n	</a>\n<% } %>\n"}),define("view/event/view",["ext/underscore","view/page","app-context","moment","view/navbar-factory","view/request/list","text!text/event/view.html"],function(e,t,n,r,i,s,o){var u="dddd, DD MMMM YYYY",a="HH:mm",f=u+", "+a;return t.extend({tagName:"fieldset",events:{"click a.btn-success":function(){this.update("ACCEPT")},"click a.btn-danger":function(){this.update("DECLINE")},"click a.btn-warning":function(){this.update("MAYBE")}},initialize:function(n){t.prototype.initialize.apply(this,arguments),this.group=this.model.getGroup(),this.back={code:"m_btn_events",link:"#events/"+this.group.getKey()},this.title=e.escape(this.model.get("friendlyName")),this.action={code:"m_comments",link:"#comments-"+this.model.getKey()}},update:function(e){this.answer.set("status",e),this.answer.once("sync",this.success),this.answer.save()},success:function(){n.navigate("#event/"+this.model.getKey(),!0)},render:function(){t.prototype.render.apply(this,arguments),this.answer=this.model.requests.find(function(e){return e.get("target").id==n.getPrinciple().id&&e.get("status")=="NONE"});var r=e.extend({answer:this.answer,when:this.getTime()},this.model);this.$el.html(this.template(o,r));var i=new s({collection:this.model.requests,type:"event"});return i.render().$el.appendTo(this.$el),this},getTime:function(){var e=r(this.model.get("startDate"));if(this.model.get("allDay")){if(this.model.isSameDay())return this.p(e.format(u));var t=r(this.model.get("endDate"));return this.p(e.format(u))+this.p(this.message("m_to"))+this.p(t.format(u))}var t=r(this.model.get("endDate"));return this.model.isSameDay()?this.p(e.format(u))+this.p(e.format(a)+" "+this.message("m_to")+" "+t.format(a)):this.p(e.format(f))+this.p(this.message("m_to"))+this.p(t.format(f))},p:function(e){return"<p>"+e+"</p>"},navbar:function(e){this.navbarCreate("events",this.group.id,e)}}).extend(i)}),define("router/event",["ext/underscore","router/group","api/cache","api/service/event","view/event/list","view/event/view"],function(e,t,n,r,i,s){return t.extend({routes:{"events/:groupKey":"showEvents","event/:eventKey":"getEvent"},showEvents:function(e){var t=n.getFrom(r.createEvents(e,1)),s=new i({collection:t});s.render(),s.handleRefresh()},getEvent:function(e){var t=e.split(":"),n={id:parseInt(t[1].substr(1))};r.getEvent(n,t[3],this.showEvent)},showEvent:function(e){new s({model:e}).render()}})}),define("api/collection/tasks",["api/collection/content","api/model/task"],function(e,t){return e.extend({model:t,_getKey:function(e){return e+":"+this.params.completed
}})}),define("api/service/task",["ext/underscore","app-context","api/cache","api/service/base","api/collection/tasks","api/collection/requests","api/model/task"],function(e,t,n,r,i,s,o){return e.extend({getTasks:function(e,t){var r=this.createTasks(e,1);n.putModel(r),this.getCollection(r,t)},getNextTasks:function(e,t){var n=this.createTasks(e.group,e.params.currentPage+1);this.getCollection(n,function(n){e.add(n.models),e.params.currentPage=n.params.currentPage,e.more=n.more,t(n)})},getTask:function(e,t,n){var r=this;this.getTaskOnly(e,t,function(e){r.getPermission(e,n)})},getTaskOnly:function(t,r,i){var s=new o({name:r});r.charAt(0)=="@"&&(s=new o({id:parseInt(r.slice(1))})),s.set("group",t),s=n.getFrom(s);if(s._expiry){s.requests?i(s):this._getRequests(s,i);return}n.putModel(s);var u=e.after(2,i);s.once("change",u),s.fetch(),this._getRequests(s,u)},_getRequests:function(e,t){e.requests=new s([],{context:e}),e.requests.once("sync",function(){t(e)}),e.requests.fetch()},saveTask:function(t,n,r,i){var s;t.type?(s=t,s.set(n)):(n.group=t.group,s=new o(n),t.add(s));var u=this;s.once("sync",function(){u.saveRequests(s,r,e.bind(i,u,s))}),s.save()},saveRequests:function(n,r,i){r.context=n;var s={};r.each(function(e){s[e.get("target").id]=e}),n.requests&&n.requests.each(function(e){s[e.get("target").id]?delete s[e.get("target").id]:e.destroy()});var o=e.values(s);if(o.length==0)i();else{var u=e.after(o.length,i),a=t.getPrinciple();e.each(o,function(e){n.requests&&n.requests.add(e),e.set("source",{id:a.id}),e.once("sync",u),e.save()})}},createTasks:function(e,n){return new i([],{group:e,params:{currentPage:n,pageSize:t.pageSize,completed:!1}})}},r)}),define("text!text/task/item.html",[],function(){return"<div class=\"task-status <%= model.isOverdue() ? 'OVERDUE' : model.get('status') %>\">\n	<span><%= messages['m_task_status_' + model.get('status')] %></span>\n</div>\n<a href=\"#task/<%= getKey() %>\" class=\"task-item\">\n	<p><b><%= _.escape(get('friendlyName')) %></b></p>\n	<abbr>\n		<%= m_tasks_requested_by %>\n		<%= get('author').name %><%= when %>\n	</abbr>\n</a>\n"}),define("view/task/item",["ext/underscore","view/base","text!text/task/item.html"],function(e,t,n){return t.extend({tagName:"li",render:function(){var t=this.model.get("dateLabel");if(t)this.$el.addClass("list-divider").html(t);else{this.$el.addClass("fat");var r=e.extend({model:this.model,when:this.getTime()},this.model);this.$el.html(this.template(n,r))}return this},getTime:function(){var e=this.model.get("dueDate");if(!e)return"";var e=moment(e),t=e.format(", DD/MM/YY");return this.model.get("timeSet")&&(t+=" "+this.message("m_at")+" "+e.format("HH:mm")),t}})}),define("view/task/list",["ext/underscore","api/service/task","api/collection/tasks","api/model/task","view/navbar-factory","view/extending-list","view/task/item"],function(e,t,n,r,i,s,o){return s.extend({back:{code:"m_btn_context",link:"#context"},initialize:function(){s.prototype.initialize.apply(this,arguments);var t=this.collection.group;this.title=e.escape(t.get("friendlyName")),t.permission.canCreate()&&(this.action={code:"m_new",link:"#tasks/"+t.getKey()+"/create"}),this.groupTasks()},groupTasks:function(){var t=e.groupBy(this.collection.models,this.extractDueDateLabel);this.collection=new n([],{group:this.collection.group}),e.each(e.keys(t),function(e){this.collection.add(new r({dateLabel:e})),this.collection.add(t[e])},this)},extractDueDateLabel:function(e){if(e.isOverdue())return this.message("m_tasks_overdue");var t=e.get("dueDate");return t?this.extractDateLabel(t):this.message("m_tasks_no_due_date")},emptyMsgCode:"m_tasks_nothing",itemViewClass:o,handleEndOfList:function(){t.getNextTasks(this.collection,this.renderPage)},handleRefresh:function(){var e=this;t.getTasks(this.collection.group,function(t){e.collection=t,e.groupTasks(),e.refresh()})},navbar:function(e){this.navbarCreate("tasks",this.collection.group.id,e)}}).extend(i)}),define("text!text/task/save.html",[],function(){return'<input class="form-control" name="friendlyName" placeholder="<%= m_task_title %>" \n	type="text" maxlength="108" value="<%= task ? task.get(\'friendlyName\') : \'\' %>">\n<textarea class="editor hidden" placeholder="<%= m_task_description %>"></textarea>\n<select name="status" class="form-control">\n	<% var status = task ? task.get(\'status\') : "NOT_STARTED"; %>\n	<% for (i = 0; i < statuses.length; i++) { %>\n		<option value="<%= statuses[i] %>" <%= statuses[i] == status ? \'selected="selected"\' : \'\' %> >\n			<%= messages[\'m_task_status_\' + statuses[i]] %>\n		</option>\n	<% } %>\n</select>\n<div class="date-and-time">\n	<input name="dueDate" class="form-control" placeholder="<%= m_task_duedate %>" type="text" \n		value="<%= (task && task.get(\'dueDate\')) ? moment(task.get(\'dueDate\')).format(\'DD MMM, YYYY\') : \'\' %>">\n	<% if (task && task.get(\'dueDate\')) {var dueTime = moment(task.get(\'dueDate\')).format(\'HH:mm\');} %>\n	<select name="dueTime" class="form-control" <%= dueTime ? \'\' : \'disabled="disabled"\' %>>\n		<option></option>\n		<% for (i = 0; i < times.length; i++) { %>\n			<option value="<%= times[i] %>" <%= times[i] == dueTime ? \'selected="selected"\' : \'\' %>>\n				<%= times[i] %>\n			</option>\n		<% } %>\n	</select>\n</div>\n<div id="requests"></div>\n<a href="javascript:void(0)" id="save" class="btn btn-primary" <%= task ? \'\' : \'disabled="disabled"\' %>>\n	<%= m_save %>\n</a>\n'}),!function(e){"function"==typeof define&&define.amd?define("picker",["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):this.Picker=e(jQuery)}(function(e){function t(s,o,a,p){function v(){return t._.node("div",t._.node("div",t._.node("div",t._.node("div",M.component.nodes(N.open),L.box),L.wrap),L.frame),L.holder,'tabindex="-1"')}function m(){A.data(o,M).addClass(L.input).val(A.data("value")?M.get("select",C.format):s.value),C.editable||A.on("focus."+N.id+" click."+N.id,function(e){e.preventDefault(),M.open()}).on("keydown."+N.id,x),i(s,{haspopup:!0,expanded:!1,readonly:!1,owns:s.id+"_root"})}function g(){i(M.$root[0],"hidden",!0)}function y(){M.$holder.on({keydown:x,"focus.toOpen":S,blur:function(){A.removeClass(L.target)},focusin:function(e){M.$root.removeClass(L.focused),e.stopPropagation()},"mousedown click":function(t){var n=t.target;n!=M.$holder[0]&&(t.stopPropagation(),"mousedown"!=t.type||e(n).is("input, select, textarea, button, option")||(t.preventDefault(),M.$holder[0].focus()))}}).on("click","[data-pick], [data-nav], [data-clear], [data-close]",function(){var t=e(this),n=t.data(),r=t.hasClass(L.navDisabled)||t.hasClass(L.disabled),i=u();i=i&&(i.type||i.href),(r||i&&!e.contains(M.$root[0],i))&&M.$holder[0].focus(),!r&&n.nav?M.set("highlight",M.component.item.highlight,{nav:n.nav}):!r&&"pick"in n?(M.set("select",n.pick),C.closeOnSelect&&M.close(!0)):n.clear?(M.clear(),C.closeOnClear&&M.close(!0)):n.close&&M.close(!0)})}function w(){var t;C.hiddenName===!0?(t=s.name,s.name=""):(t=["string"==typeof C.hiddenPrefix?C.hiddenPrefix:"","string"==typeof C.hiddenSuffix?C.hiddenSuffix:"_submit"],t=t[0]+s.name+t[1]),M._hidden=e('<input type=hidden name="'+t+'"'+(A.data("value")||s.value?' value="'+M.get("select",C.formatSubmit)+'"':"")+">")[0],A.on("change."+N.id,function(){M._hidden.value=s.value?M.get("select",C.formatSubmit):""})}function E(){T&&c?M.$holder.find("."+L.frame).one("transitionend",function(){M.$holder[0].focus()}):M.$holder[0].focus()}function S(e){e.stopPropagation(),A.addClass(L.target),M.$root.addClass(L.focused),M.open()}function x(e){var t=e.keyCode,n=/^(8|46)$/.test(t);return 27==t?(M.close(!0),!1):void((32==t||n||!N.open&&M.component.key[t])&&(e.preventDefault(),e.stopPropagation(),n?M.clear().close():M.open()))}if(!s)return t;var T=!1,N={id:s.id||"P"+Math.abs(~~(Math.random()*new Date))},C=a?e.extend(!0,{},a.defaults,p):p||{},L=e.extend({},t.klasses(),C.klass),A=e(s),O=function(){return this.start()},M=O.prototype={constructor:O,$node:A,start:function(){return N&&N.start?M:(N.methods={},N.start=!0,N.open=!1,N.type=s.type,s.autofocus=s==u(),s.readOnly=!C.editable,s.id=s.id||N.id,"text"!=s.type&&(s.type="text"),M.component=new a(M,C),M.$root=e('<div class="'+L.picker+'" id="'+s.id+'_root" />'),g(),M.$holder=e(v()).appendTo(M.$root),y(),C.formatSubmit&&w(),m(),C.containerHidden?e(C.containerHidden).append(M._hidden):A.after(M._hidden),C.container?e(C.container).append(M.$root):A.after(M.$root),M.on({start:M.component.onStart,render:M.component.onRender,stop:M.component.onStop,open:M.component.onOpen,close:M.component.onClose,set:M.component.onSet}).on({start:C.onStart,render:C.onRender,stop:C.onStop,open:C.onOpen,close:C.onClose,set:C.onSet}),T=n(M.$holder[0]),s.autofocus&&M.open(),M.trigger("start").trigger("render"))},render:function(e){return e?(M.$holder=v(),M.$root.html(M.$holder)):M.$root.find("."+L.box).html(M.component.nodes(N.open)),M.trigger("render")},stop:function(){return N.start?(M.close(),M._hidden&&M._hidden.parentNode.removeChild(M._hidden),M.$root.remove(),A.removeClass(L.input).removeData(o),setTimeout(function(){A.off("."+N.id)},0),s.type=N.type,s.readOnly=!1,M.trigger("stop"),N.methods={},N.start=!1,M):M},open:function(n){return N.open?M:(A.addClass(L.active),i(s,"expanded",!0),setTimeout(function(){M.$root.addClass(L.opened),i(M.$root[0],"hidden",!1)},0),n!==!1&&(N.open=!0,T&&l.css("overflow","hidden").css("padding-right","+="+r()),E(),f.on("click."+N.id+" focusin."+N.id,function(e){var t=e.target;t!=s&&t!=document&&3!=e.which&&M.close(t===M.$holder[0])}).on("keydown."+N.id,function(n){var r=n.keyCode,i=M.component.key[r],s=n.target;27==r?M.close(!0):s!=M.$holder[0]||!i&&13!=r?e.contains(M.$root[0],s)&&13==r&&(n.preventDefault(),s.click()):(n.preventDefault(),i?t._.trigger(M.component.key.go,M,[t._.trigger(i)]):M.$root.find("."+L.highlighted).hasClass(L.disabled)||(M.set("select",M.component.item.highlight),C.closeOnSelect&&M.close(!0)))})),M.trigger("open"))},close:function(e){return e&&(C.editable?s.focus():(M.$holder.off("focus.toOpen").focus(),setTimeout(function(){M.$holder.on("focus.toOpen",S)},0))),A.removeClass(L.active),i(s,"expanded",!1),setTimeout(function(){M.$root.removeClass(L.opened+" "+L.focused),i(M.$root[0],"hidden",!0)},0),N.open?(N.open=!1,T&&l.css("overflow","").css("padding-right","-="+r()),f.off("."+N.id),M.trigger("close")):M},clear:function(e){return M.set("clear",null,e)},set:function(t,n,r){var i,s,o=e.isPlainObject(t),u=o?t:{};if(r=o&&e.isPlainObject(n)?n:r||{},t){o||(u[t]=n);for(i in u)s=u[i],i in M.component.item&&(void 0===s&&(s=null),M.component.set(i,s,r)),("select"==i||"clear"==i)&&A.val("clear"==i?"":M.get(i,C.format)).trigger("change");M.render()}return r.muted?M:M.trigger("set",u)},get:function(e,n){if(e=e||"value",null!=N[e])return N[e];if("valueSubmit"==e){if(M._hidden)return M._hidden.value;e="value"}if("value"==e)return s.value;if(e in M.component.item){if("string"==typeof n){var r=M.component.get(e);return r?t._.trigger(M.component.formats.toString,M.component,[n,r]):""}return M.component.get(e)}},on:function(t,n,r){var i,s,o=e.isPlainObject(t),u=o?t:{};if(t){o||(u[t]=n);for(i in u)s=u[i],r&&(i="_"+i),N.methods[i]=N.methods[i]||[],N.methods[i].push(s)}return M},off:function(){var e,t,n=arguments;for(e=0,namesCount=n.length;e<namesCount;e+=1)t=n[e],t in N.methods&&delete N.methods[t];return M},trigger:function(e,n){var r=function(e){var r=N.methods[e];r&&r.map(function(e){t._.trigger(e,M,[n])})};return r("_"+e),r(e),M}};return new O}function n(e){var t,n="position";return e.currentStyle?t=e.currentStyle[n]:window.getComputedStyle&&(t=getComputedStyle(e)[n]),"fixed"==t}function r(){if(l.height()<=a.height())return 0;var t=e('<div style="visibility:hidden;width:100px" />').appendTo("body"),n=t[0].offsetWidth;t.css("overflow","scroll");var r=e('<div style="width:100%" />').appendTo(t),i=r[0].offsetWidth;return t.remove(),n-i}function i(t,n,r){if(e.isPlainObject(n))for(var i in n)s(t,i,n[i]);else s(t,n,r)}function s(e,t,n){e.setAttribute(("role"==t?"":"aria-")+t,n)}function o(t,n){e.isPlainObject(t)||(t={attribute:n}),n="";for(var r in t){var i=("role"==r?"":"aria-")+r,s=t[r];n+=null==s?"":i+'="'+t[r]+'"'}return n}function u(){try{return document.activeElement}catch(e){}}var a=e(window),f=e(document),l=e(document.documentElement),c=null!=document.body.style.transition;return t.klasses=function(e){return e=e||"picker",{picker:e,opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",target:e+"__input--target",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},t._={group:function(e){for(var n,r="",i=t._.trigger(e.min,e);i<=t._.trigger(e.max,e,[i]);i+=e.i)n=t._.trigger(e.item,e,[i]),r+=t._.node(e.node,n[0],n[1],n[2]);return r},node:function(t,n,r,i){return n?(n=e.isArray(n)?n.join(""):n,r=r?' class="'+r+'"':"",i=i?" "+i:"","<"+t+r+i+">"+n+"</"+t+">"):""},lead:function(e){return(10>e?"0":"")+e},trigger:function(e,t,n){return"function"==typeof e?e.apply(t,n||[]):e},digits:function(e){return/\d/.test(e[1])?2:1},isDate:function(e){return{}.toString.call(e).indexOf("Date")>-1&&this.isInteger(e.getDate())},isInteger:function(e){return{}.toString.call(e).indexOf("Number")>-1&&e%1===0},ariaAttr:o},t.extend=function(n,r){e.fn[n]=function(i,s){var o=this.data(n);return"picker"==i?o:o&&"string"==typeof i?t._.trigger(o[i],o,[s]):this.each(function(){var s=e(this);s.data(n)||new t(this,n,r,i)})},e.fn[n].defaults=r.defaults},t}),!function(e){"function"==typeof define&&define.amd?define("lib/pickadate.min",["picker","jquery"],e):"object"==typeof exports?module.exports=e(require("./picker.js"),require("jquery")):e(Picker,jQuery)}(function(e,t){function n(e,t){var n=this,r=e.$node[0],i=r.value,s=e.$node.data("value"),o=s||i,u=s?t.formatSubmit:t.format,a=function(){return r.currentStyle?"rtl"==r.currentStyle.direction:"rtl"==getComputedStyle(e.$root[0]).direction};n.settings=t,n.$node=e.$node,n.queue={min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"parse navigate create validate",view:"parse create validate viewset",disable:"deactivate",enable:"activate"},n.item={},n.item.clear=null,n.item.disable=(t.disable||[]).slice(0),n.item.enable=-function(e){return e[0]===!0?e.shift():-1}(n.item.disable),n.set("min",t.min).set("max",t.max).set("now"),o?n.set("select",o,{format:u,defaultValue:!0}):n.set("select",null).set("highlight",n.item.now),n.key={40:7,38:-7,39:function(){return a()?-1:1},37:function(){return a()?1:-1},go:function(e){var t=n.item.highlight,r=new Date(t.year,t.month,t.date+e);n.set("highlight",r,{interval:e}),this.render()}},e.on("render",function(){e.$root.find("."+t.klass.selectMonth).on("change",function(){var n=this.value;n&&(e.set("highlight",[e.get("view").year,n,e.get("highlight").date]),e.$root.find("."+t.klass.selectMonth).trigger("focus"))}),e.$root.find("."+t.klass.selectYear).on("change",function(){var n=this.value;n&&(e.set("highlight",[n,e.get("view").month,e.get("highlight").date]),e.$root.find("."+t.klass.selectYear).trigger("focus"))})},1).on("open",function(){var r="";n.disabled(n.get("now"))&&(r=":not(."+t.klass.buttonToday+")"),e.$root.find("button"+r+", select").attr("disabled",!1)},1).on("close",function(){e.$root.find("button, select").attr("disabled",!0)},1)}var r=7,i=6,s=e._;n.prototype.set=function(e,t,n){var r=this,i=r.item;return null===t?("clear"==e&&(e="select"),i[e]=t,r):(i["enable"==e?"disable":"flip"==e?"enable":e]=r.queue[e].split(" ").map(function(i){return t=r[i](e,t,n)}).pop(),"select"==e?r.set("highlight",i.select,n):"highlight"==e?r.set("view",i.highlight,n):e.match(/^(flip|min|max|disable|enable)$/)&&(i.select&&r.disabled(i.select)&&r.set("select",i.select,n),i.highlight&&r.disabled(i.highlight)&&r.set("highlight",i.highlight,n)),r)},n.prototype.get=function(e){return this.item[e]},n.prototype.create=function(e,n,r){var i,o=this;return n=void 0===n?e:n,n==-1/0||1/0==n?i=n:t.isPlainObject(n)&&s.isInteger(n.pick)?n=n.obj:t.isArray(n)?(n=new Date(n[0],n[1],n[2]),n=s.isDate(n)?n:o.create().obj):n=s.isInteger(n)||s.isDate(n)?o.normalize(new Date(n),r):o.now(e,n,r),{year:i||n.getFullYear(),month:i||n.getMonth(),date:i||n.getDate(),day:i||n.getDay(),obj:i||n,pick:i||n.getTime()}},n.prototype.createRange=function(e,n){var r=this,i=function(e){return e===!0||t.isArray(e)||s.isDate(e)?r.create(e):e};return s.isInteger(e)||(e=i(e)),s.isInteger(n)||(n=i(n)),s.isInteger(e)&&t.isPlainObject(n)?e=[n.year,n.month,n.date+e]:s.isInteger(n)&&t.isPlainObject(e)&&(n=[e.year,e.month,e.date+n]),{from:i(e),to:i(n)}},n.prototype.withinRange=function(e,t){return e=this.createRange(e.from,e.to),t.pick>=e.from.pick&&t.pick<=e.to.pick},n.prototype.overlapRanges=function(e,t){var n=this;return e=n.createRange(e.from,e.to),t=n.createRange(t.from,t.to),n.withinRange(e,t.from)||n.withinRange(e,t.to)||n.withinRange(t,e.from)||n.withinRange(t,e.to)},n.prototype.now=function(e,t,n){return t=new Date,n&&n.rel&&t.setDate(t.getDate()+n.rel),this.normalize(t,n)},n.prototype.navigate=function(e,n,r){var i,s,o,u,a=t.isArray(n),f=t.isPlainObject(n),l=this.item.view;if(a||f){for(f?(s=n.year,o=n.month,u=n.date):(s=+n[0],o=+n[1],u=+n[2]),r&&r.nav&&l&&l.month!==o&&(s=l.year,o=l.month),i=new Date(s,o+(r&&r.nav?r.nav:0),1),s=i.getFullYear(),o=i.getMonth();new Date(s,o,u).getMonth()!==o;)u-=1;n=[s,o,u]}return n},n.prototype.normalize=function(e){return e.setHours(0,0,0,0),e},n.prototype.measure=function(e,t){var n=this;return t?"string"==typeof t?t=n.parse(e,t):s.isInteger(t)&&(t=n.now(e,t,{rel:t})):t="min"==e?-1/0:1/0,t},n.prototype.viewset=function(e,t){return this.create([t.year,t.month,1])},n.prototype.validate=function(e,n,r){var i,o,u,a,l=this,c=n,h=r&&r.interval?r.interval:1,p=-1===l.item.enable,d=l.item.min,v=l.item.max,m=p&&l.item.disable.filter(function(e){if(t.isArray(e)){var r=l.create(e).pick;r<n.pick?i=!0:r>n.pick&&(o=!0)}return s.isInteger(e)}).length;if((!r||!r.nav&&!r.defaultValue)&&(!p&&l.disabled(n)||p&&l.disabled(n)&&(m||i||o)||!p&&(n.pick<=d.pick||n.pick>=v.pick)))for(p&&!m&&(!o&&h>0||!i&&0>h)&&(h*=-1);l.disabled(n)&&(Math.abs(h)>1&&(n.month<c.month||n.month>c.month)&&(n=c,h=h>0?1:-1),n.pick<=d.pick?(u=!0,h=1,n=l.create([d.year,d.month,d.date+(n.pick===d.pick?0:-1)])):n.pick>=v.pick&&(a=!0,h=-1,n=l.create([v.year,v.month,v.date+(n.pick===v.pick?0:1)])),!u||!a);)n=l.create([n.year,n.month,n.date+h]);return n},n.prototype.disabled=function(e){var n=this,r=n.item.disable.filter(function(r){return s.isInteger(r)?e.day===(n.settings.firstDay?r:r-1)%7:t.isArray(r)||s.isDate(r)?e.pick===n.create(r).pick:t.isPlainObject(r)?n.withinRange(r,e):void 0});return r=r.length&&!r.filter(function(e){return t.isArray(e)&&"inverted"==e[3]||t.isPlainObject(e)&&e.inverted}).length,-1===n.item.enable?!r:r||e.pick<n.item.min.pick||e.pick>n.item.max.pick},n.prototype.parse=function(e,t,n){var r=this,i={};return t&&"string"==typeof t?(n&&n.format||(n=n||{},n.format=r.settings.format),r.formats.toArray(n.format).map(function(e){var n=r.formats[e],o=n?s.trigger(n,r,[t,i]):e.replace(/^!/,"").length;n&&(i[e]=t.substr(0,o)),t=t.substr(o)}),[i.yyyy||i.yy,+(i.mm||i.m)-1,i.dd||i.d]):t},n.prototype.formats=function(){function e(e,t,n){var r=e.match(/[^\x00-\x7F]+|\w+/)[0];return n.mm||n.m||(n.m=t.indexOf(r)+1),r.length}function t(e){return e.match(/\w+/)[0].length}return{d:function(e,t){return e?s.digits(e):t.date},dd:function(e,t){return e?2:s.lead(t.date)},ddd:function(e,n){return e?t(e):this.settings.weekdaysShort[n.day]},dddd:function(e,n){return e?t(e):this.settings.weekdaysFull[n.day]},m:function(e,t){return e?s.digits(e):t.month+1},mm:function(e,t){return e?2:s.lead(t.month+1)},mmm:function(t,n){var r=this.settings.monthsShort;return t?e(t,r,n):r[n.month]},mmmm:function(t,n){var r=this.settings.monthsFull;return t?e(t,r,n):r[n.month]},yy:function(e,t){return e?2:(""+t.year).slice(2)},yyyy:function(e,t){return e?4:t.year},toArray:function(e){return e.split(/(d{1,4}|m{1,4}|y{4}|yy|!.)/g)},toString:function(e,t){var n=this;return n.formats.toArray(e).map(function(e){return s.trigger(n.formats[e],n,[0,t])||e.replace(/^!/,"")}).join("")}}}(),n.prototype.isDateExact=function(e,n){var r=this;return s.isInteger(e)&&s.isInteger(n)||"boolean"==typeof e&&"boolean"==typeof n?e===n:(s.isDate(e)||t.isArray(e))&&(s.isDate(n)||t.isArray(n))?r.create(e).pick===r.create(n).pick:t.isPlainObject(e)&&t.isPlainObject(n)?r.isDateExact(e.from,n.from)&&r.isDateExact(e.to,n.to):!1},n.prototype.isDateOverlap=function(e,n){var r=this,i=r.settings.firstDay?1:0;return s.isInteger(e)&&(s.isDate(n)||t.isArray(n))?(e=e%7+i,e===r.create(n).day+1):s.isInteger(n)&&(s.isDate(e)||t.isArray(e))?(n=n%7+i,n===r.create(e).day+1):t.isPlainObject(e)&&t.isPlainObject(n)?r.overlapRanges(e,n):!1},n.prototype.flipEnable=function(e){var t=this.item;t.enable=e||(-1==t.enable?1:-1)},n.prototype.deactivate=function(e,n){var r=this,i=r.item.disable.slice(0);return"flip"==n?r.flipEnable():n===!1?(r.flipEnable(1),i=[]):n===!0?(r.flipEnable(-1),i=[]):n.map(function(e){for(var n,o=0;o<i.length;o+=1)if(r.isDateExact(e,i[o])){n=!0;break}n||(s.isInteger(e)||s.isDate(e)||t.isArray(e)||t.isPlainObject(e)&&e.from&&e.to)&&i.push(e)}),i},n.prototype.activate=function(e,n){var r=this,i=r.item.disable,o=i.length;return"flip"==n?r.flipEnable():n===!0?(r.flipEnable(1),i=[]):n===!1?(r.flipEnable(-1),i=[]):n.map(function(e){var n,u,a,l;for(a=0;o>a;a+=1){if(u=i[a],r.isDateExact(u,e)){n=i[a]=null,l=!0;break}if(r.isDateOverlap(u,e)){t.isPlainObject(e)?(e.inverted=!0,n=e):t.isArray(e)?(n=e,n[3]||n.push("inverted")):s.isDate(e)&&(n=[e.getFullYear(),e.getMonth(),e.getDate(),"inverted"]);break}}if(n)for(a=0;o>a;a+=1)if(r.isDateExact(i[a],e)){i[a]=null;break}if(l)for(a=0;o>a;a+=1)if(r.isDateOverlap(i[a],e)){i[a]=null;break}n&&i.push(n)}),i.filter(function(e){return null!=e})},n.prototype.nodes=function(e){var t=this,n=t.settings,o=t.item,u=o.now,a=o.select,l=o.highlight,c=o.view,h=o.disable,p=o.min,v=o.max,m=function(e,t){return n.firstDay&&(e.push(e.shift()),t.push(t.shift())),s.node("thead",s.node("tr",s.group({min:0,max:r-1,i:1,node:"th",item:function(r){return[e[r],n.klass.weekdays,'scope=col title="'+t[r]+'"']}})))}((n.showWeekdaysFull?n.weekdaysFull:n.weekdaysShort).slice(0),n.weekdaysFull.slice(0)),g=function(e){return s.node("div"," ",n.klass["nav"+(e?"Next":"Prev")]+(e&&c.year>=v.year&&c.month>=v.month||!e&&c.year<=p.year&&c.month<=p.month?" "+n.klass.navDisabled:""),"data-nav="+(e||-1)+" "+s.ariaAttr({role:"button",controls:t.$node[0].id+"_table"})+' title="'+(e?n.labelMonthNext:n.labelMonthPrev)+'"')},y=function(){var r=n.showMonthsShort?n.monthsShort:n.monthsFull;return n.selectMonths?s.node("select",s.group({min:0,max:11,i:1,node:"option",item:function(e){return[r[e],0,"value="+e+(c.month==e?" selected":"")+(c.year==p.year&&e<p.month||c.year==v.year&&e>v.month?" disabled":"")]}}),n.klass.selectMonth,(e?"":"disabled")+" "+s.ariaAttr({controls:t.$node[0].id+"_table"})+' title="'+n.labelMonthSelect+'"'):s.node("div",r[c.month],n.klass.month)},b=function(){var r=c.year,i=n.selectYears===!0?5:~~(n.selectYears/2);if(i){var o=p.year,u=v.year,a=r-i,l=r+i;if(o>a&&(l+=o-a,a=o),l>u){var h=a-o,d=l-u;a-=h>d?d:h,l=u}return s.node("select",s.group({min:a,max:l,i:1,node:"option",item:function(e){return[e,0,"value="+e+(r==e?" selected":"")]}}),n.klass.selectYear,(e?"":"disabled")+" "+s.ariaAttr({controls:t.$node[0].id+"_table"})+' title="'+n.labelYearSelect+'"')}return s.node("div",r,n.klass.year)};return s.node("div",(n.selectYears?b()+y():y()+b())+g()+g(1),n.klass.header)+s.node("table",m+s.node("tbody",s.group({min:0,max:i-1,i:1,node:"tr",item:function(e){var i=n.firstDay&&0===t.create([c.year,c.month,1]).day?-7:0;return[s.group({min:r*e-c.day+i+1,max:function(){return this.min+r-1},i:1,node:"td",item:function(e){e=t.create([c.year,c.month,e+(n.firstDay?1:0)]);var r=a&&a.pick==e.pick,i=l&&l.pick==e.pick,o=h&&t.disabled(e)||e.pick<p.pick||e.pick>v.pick,d=s.trigger(t.formats.toString,t,[n.format,e]);return[s.node("div",e.date,function(t){return t.push(c.month==e.month?n.klass.infocus:n.klass.outfocus),u.pick==e.pick&&t.push(n.klass.now),r&&t.push(n.klass.selected),i&&t.push(n.klass.highlighted),o&&t.push(n.klass.disabled),t.join(" ")}([n.klass.day]),"data-pick="+e.pick+" "+s.ariaAttr({role:"gridcell",label:d,selected:r&&t.$node.val()===d?!0:null,activedescendant:i?!0:null,disabled:o?!0:null})),"",s.ariaAttr({role:"presentation"})]}})]}})),n.klass.table,'id="'+t.$node[0].id+'_table" '+s.ariaAttr({role:"grid",controls:t.$node[0].id,readonly:!0}))+s.node("div",s.node("button",n.today,n.klass.buttonToday,"type=button data-pick="+u.pick+(e&&!t.disabled(u)?"":" disabled")+" "+s.ariaAttr({controls:t.$node[0].id}))+s.node("button",n.clear,n.klass.buttonClear,"type=button data-clear=1"+(e?"":" disabled")+" "+s.ariaAttr({controls:t.$node[0].id}))+s.node("button",n.close,n.klass.buttonClose,"type=button data-close=true "+(e?"":" disabled")+" "+s.ariaAttr({controls:t.$node[0].id})),n.klass.footer)},n.defaults=function(e){return{labelMonthNext:"Next month",labelMonthPrev:"Previous month",labelMonthSelect:"Select a month",labelYearSelect:"Select a year",monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdaysFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],today:"Today",clear:"Clear",close:"Close",closeOnSelect:!0,closeOnClear:!0,format:"d mmmm, yyyy",klass:{table:e+"table",header:e+"header",navPrev:e+"nav--prev",navNext:e+"nav--next",navDisabled:e+"nav--disabled",month:e+"month",year:e+"year",selectMonth:e+"select--month",selectYear:e+"select--year",weekdays:e+"weekday",day:e+"day",disabled:e+"day--disabled",selected:e+"day--selected",highlighted:e+"day--highlighted",now:e+"day--today",infocus:e+"day--infocus",outfocus:e+"day--outfocus",footer:e+"footer",buttonClear:e+"button--clear",buttonToday:e+"button--today",buttonClose:e+"button--close"}}}(e.klasses().picker+"__"),e.extend("pickadate",n)}),define("view/task/save",["ext/underscore","jquery","view/page","view/editor","app-context","moment","api/collection/requests","api/collection/users","api/model/request","api/service/general","api/service/task","view/people/list","view/request/list","text!text/task/save.html","lib/pickadate.min"],function(e,t,n,r,s,o,u,a,f,l,c,h,p,d){return n.extend({tagName:"fieldset",events:{"keyup [name=friendlyName]":"onKeyup","click #save":"save"},initialize:function(e){n.prototype.initialize.apply(this,arguments);var t=this.resolveGroup();this.editor=new r({context:t,$page:this.$el,content:e.task?e.task.get("description"):null}),this.back={code:e.task?"m_task":"m_btn_tasks",link:e.task?"#task/"+e.task.getKey():"#tasks/"+t.getKey()},this.action={code:"m_assign",view:this},this.title=this.message(e.task?"m_update_task":"m_create_task"),this.requestList=new p({collection:this.createRequests(e),type:"task",deletable:!0}),this.requestList.collection.on("remove",this.renderRequests)},createRequests:function(e){var t=new u;return e.task?e.task.requests.each(function(e){t.add(new f(e.toJSON()))}):t.add(new f({target:s.getPrinciple(),status:"ACCEPT"})),t},resolveGroup:function(){return this.options.task?this.options.task.getGroup():this.options.tasks.group},render:function(){n.prototype.render.apply(this,arguments);var e=[],r=new Date(0,1,1,6,0,0);for(i=0;i<48;i++)(r.getMinutes()!=0||r.getHours()!=0)&&e.push(r.toString().match(/\d{2}:\d{2}/)[0]),r.setMinutes(r.getMinutes()+30);this.$el.html(this.template(d,{times:e,statuses:["NOT_STARTED","IN_PROGRESS","DEFERRED","WAITING","COMPLETED"],task:this.options.task}));var s=this;return t("[name=dueDate]",this.$el).pickadate({today:"",klass:{buttonClear:"btn",buttonClose:"btn"},onSet:function(e){var n=t("[name=dueTime]",s.$el);e.select?n.attr("disabled",!1):n.attr("disabled",!0).val("")}}),this.renderRequests(),this.editor.render_delayed(),this},renderRequests:function(){var e=t("#requests",this.$el).empty();this.requestList.collection.length>0&&e.append(this.requestList.render().el)},onKeyup:function(){t("#save",this.$el).attr("disabled",e.isBlank(t("[name=friendlyName]",this.el).val()))},doAction:function(e){var t=this.requestList.collection.map(function(e){return e.get("target").id}),n=this;l.getUsers(this.resolveGroup(),function(e){var r=new h({collection:e,callback:n.addRequest,filter:t});r.render()},!0)},addRequest:function(e){this.requestList.collection.add(new f({target:e.toJSON(),status:s.getPrinciple().id==e.id?"ACCEPT":"NONE"})),this.renderRequests()},save:function(){this.requestList.collection.off("remove",this.renderRequests);var n={friendlyName:t("[name=friendlyName]",this.el).val(),description:this.editor.getText(),status:t("[name=status]",this.el).val()},r=t("[name=dueDate]",this.$el).val();e.isBlank(r)||(r=r+" "+t("[name=dueTime]",this.$el).val(),n.dueDate=o(r,"DD MMM, YYYY HH:mm").valueOf()),c.saveTask(this.options.task?this.options.task:this.options.tasks,n,this.requestList.collection,function(e){s.navigate("#task/"+e.getKey())})}})}),define("text!text/task/view.html",[],function(){return"<div></div>\n<div class=\"task-status <%= isOverdue() ? 'OVERDUE' : get('status') %>\">\n	<span><%= messages['m_task_status_' + get('status')] %></span>\n</div>\n<div class=\"entity-info\" >\n	<%= get('description') %>\n	<p><%= when %></p>\n	<% if (get('status') == 'IN_PROGRESS') { %>\n		<p><%= m_task_progress %>: <%= get('progress') %>%</p>\n	<% } %>\n</div>\n<% if (answer) { %>\n	<a href='javascript:void(0)' class='btn btn-success'>\n		<%= m_task_ACCEPT %>\n	</a>\n	<a href='javascript:void(0)' class='btn btn-danger'>\n		<%= m_task_REJECT %>\n	</a>\n<% } %>\n<% if (permission.canEdit()) { %>\n	<a href=\"#task/<%= getKey() %>/edit\" class=\"btn btn-primary\">\n		<%= m_edit %>\n	</a>\n<% } %>\n"}),define("view/task/view",["ext/underscore","view/page","app-context","moment","view/navbar-factory","view/request/list","text!text/task/view.html"],function(e,t,n,r,i,s,o){return t.extend({tagName:"fieldset",events:{"click a.btn-success":function(){this.update("ACCEPT")},"click a.btn-danger":function(){this.update("REJECT")}},initialize:function(n){t.prototype.initialize.apply(this,arguments),this.group=this.model.getGroup(),this.back={code:"m_btn_tasks",link:"#tasks/"+this.group.getKey()},this.title=e.escape(this.model.get("friendlyName")),this.action={code:"m_comments",link:"#comments/"+this.model.getKey()}},update:function(e){this.answer.set("status",e),this.answer.once("sync",this.success),this.answer.save()},success:function(){n.navigate("#task/"+this.model.getKey(),!0)},render:function(){t.prototype.render.apply(this,arguments),this.answer=this.model.requests.find(function(e){return e.get("target").id==n.getPrinciple().id&&e.get("status")=="NONE"});var r=e.extend({answer:this.answer,when:this.getTime()},this.model);this.$el.html(this.template(o,r));var i=new s({collection:this.model.requests,type:"task"});return i.render().$el.appendTo(this.$el),this},getTime:function(){var e=this.model.get("dueDate");if(!e)return this.message("m_task_no_due");e=r(e);var t=e.format("DD/MM/YY");return this.model.get("timeSet")&&(t+=" "+this.message("m_at")+" "+e.format("HH:mm")),this.message("m_task_due")+": "+t},navbar:function(e){this.navbarCreate("tasks",this.group.id,e)}}).extend(i)}),define("router/task",["ext/underscore","router/group","app-context","api/cache","api/service/task","view/task/list","view/task/save","view/task/view"],function(e,t,n,r,i,s,o,u){return t.extend({routes:{"tasks/:groupKey/create":"createTask","tasks/:groupKey":"showTasks","task/:taskKey/edit":"editTask","task/:taskKey":"getTask"},createTask:function(e){var t=r.getFrom(i.createTasks(e,1));new o({tasks:t}).render()},showTasks:function(e){var t=r.getFrom(i.createTasks(e,1)),n=new s({collection:t});n.render(),n.handleRefresh()},getTask:function(e){var t=e.split(":"),n={id:parseInt(t[1].substr(1))};
i.getTask(n,t[3],function(e){new u({model:e}).render()})},editTask:function(e){var t=e.split(":"),n={id:parseInt(t[1].substr(1))};i.getTask(n,t[3],function(e){new o({task:e}).render()})}})}),define("api/collection/comments",["api/collection/base","api/model/comment"],function(e,t){return e.extend({model:t,initialize:function(e,t){this.context=t.context},url:function(){return this.context.url()+"/comments"}})}),define("api/service/comment",["ext/underscore","app-context","api/cache","api/service/file","api/service/note","api/service/event","api/service/task","api/collection/comments","api/model/comment","api/model/reply"],function(e,t,n,r,i,s,o,u,a,f){return{getComments:function(e,t){var n=this,u=e.split(":"),a={id:parseInt(u[1].substr(1))};u[2]=="files"?r.getFile(a,u[3],function(e){n._getComments(e,t)}):u[2]=="pages"?i.getPage(a,u[3],function(e){n._getComments(e,t)}):u[2]=="events"?s.getEvent(a,u[3],function(e){n._getComments(e,t)}):u[2]=="tasks"&&o.getTask(a,u[3],function(e){n._getComments(e,t)})},_getComments:function(e,t){var r=n.getFrom(new u([],{context:e}));r._expiry?t(r):(r.fetch(),r.once("sync",function(){n.putModel(r),t(r)}))},createComment:function(t,n,r){var i=new t.model({comment:n});t.add(i),i.save(),i.once("change",e.bind(r,this,i))}}}),define("view/comment/create",["app-context","view/editor-page","api/service/comment"],function(e,t,n){return t.extend({title:t.message("m_make_comment"),nosearch:!0,initialize:function(){t.prototype.initialize.apply(this,arguments),this.back={code:"m_comments",link:"#comments/"+this.options.entity.getKey()}},post:function(){var t=this.back.link;n.createComment(this.options.comments,this.editor.getText(),function(n){e.navigate(t+"/"+n.get("dateCreated"))})}})}),define("router/comment",["ext/underscore","app-context","router/base","api/cache","api/service/general","api/service/comment","view/comment/list","view/comment/create"],function(e,t,n,r,i,s,o,u){return n.extend({routes:{"comments/:contextKey/create":"createComment","comments/:contextKey/:dateOfSelection":"getComments","comments/:contextKey":"getComments","replies/:commentKey/create":"createReply"},getComments:function(n,u){s.getComments(n,function(n){n.each(function(e){r.putModel(e)});var s=n.context.type,a={back:{code:"m_"+s,link:"#"+s+"/"+n.context.getKey()},title:e.escape(n.context.get("friendlyName")),action:{code:"m_new",link:"#comments/"+n.context.getKey()+"/create"},collection:n,onDelete:function(e,t){i.deleteModel(e,t)},onReply:function(e){t.navigate("#replies/"+e.getKey()+"/create")}};u&&(a.dateOfSelection=parseInt(u));var f=new o(a);f.render()})},createComment:function(e){s.getComments(e,this.showCommentCreate)},createReply:function(e){var t=r.get(e);this.showCommentCreate(t.getReplies(),t.collection)},showCommentCreate:function(e,t){t||(t=e),new u({context:t.context.getGroup(),comments:e,entity:t.context}).render()}})});var io="undefined"==typeof module?{}:module.exports;(function(){(function(e,t){var n=e;n.version="0.9.16",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,r){var i=n.util.parseUri(e),s,o;t&&t.location&&(i.protocol=i.protocol||t.location.protocol.slice(0,-1),i.host=i.host||(t.document?t.document.domain:t.location.hostname),i.port=i.port||t.location.port),s=n.util.uniqueUri(i);var u={host:i.host,secure:"https"==i.protocol,port:i.port||("https"==i.protocol?443:80),query:i.query||""};n.util.merge(u,r);if(u["force new connection"]||!n.sockets[s])o=new n.Socket(u);return!u["force new connection"]&&o&&(n.sockets[s]=o),o=o||n.sockets[s],o.of(i.path.length>1?i.path:"")}})("object"==typeof module?module.exports:this.io={},this),function(e,t){var n=e.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){var t=r.exec(e||""),n={},s=14;while(s--)n[i[s]]=t[s]||"";return n},n.uniqueUri=function(e){var n=e.protocol,r=e.host,i=e.port;return"document"in t?(r=r||document.domain,i=i||(n=="https"&&document.location.protocol!=="https:"?443:document.location.port)):(r=r||"localhost",!i&&n=="https"&&(i=443)),(n||"http")+"://"+r+":"+(i||80)},n.query=function(e,t){var r=n.chunkQuery(e||""),i=[];n.merge(r,n.chunkQuery(t||""));for(var s in r)r.hasOwnProperty(s)&&i.push(s+"="+r[s]);return i.length?"?"+i.join("&"):""},n.chunkQuery=function(e){var t={},n=e.split("&"),r=0,i=n.length,s;for(;r<i;++r)s=n[r].split("="),s[0]&&(t[s[0]]=s[1]);return t};var s=!1;n.load=function(e){if("document"in t&&document.readyState==="complete"||s)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest&&!n.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}return null},"undefined"!=typeof window&&n.load(function(){s=!0}),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})},n.merge=function(t,r,i,s){var o=s||[],u=typeof i=="undefined"?2:i,a;for(a in r)r.hasOwnProperty(a)&&n.indexOf(o,a)<0&&(typeof t[a]!="object"||!u?(t[a]=r[a],o.push(r[a])):n.merge(t[a],r[a],u-1,o));return t},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},n.intersect=function(e,t){var r=[],i=e.length>t.length?e:t,s=e.length>t.length?t:e;for(var o=0,u=s.length;o<u;o++)~n.indexOf(i,s[o])&&r.push(s[o]);return r},n.indexOf=function(e,t,n){for(var r=e.length,n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++);return r<=n?-1:n},n.toArray=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return e.withCredentials!=undefined}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),n.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function r(){n.removeListener(e,r),t.apply(this,arguments)}var n=this;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var r=this.$events[e];if(t.util.isArray(r)){var i=-1;for(var s=0,o=r.length;s<o;s++)if(r[s]===n||r[s].listener&&r[s].listener===n){i=s;break}if(i<0)return this;r.splice(i,1),r.length||delete this.$events[e]}else(r===n||r.listener&&r.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return e===undefined?(this.$events={},this):(this.$events&&this.$events[e]&&(this.$events[e]=null),this)},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var r=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,r);else{if(!t.util.isArray(n))return!1;var i=n.slice();for(var s=0,o=i.length;s<o;s++)i[s].apply(this,r)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a instanceof Date&&(a=date(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")},JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,typeof JSON!="undefined"?JSON:undefined),function(e,t){var n=e.parser={},r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=n.reasons=["transport not supported","client not handshaken","unauthorized"],s=n.advice=["reconnect"],o=t.JSON,u=t.util.indexOf;n.encodePacket=function(e){var t=u(r,e.type),n=e.id||"",a=e.endpoint||"",f=e.ack,l=null;switch(e.type){case"error":var c=e.reason?u(i,e.reason):"",h=e.advice?u(s,e.advice):"";if(c!==""||h!=="")l=c+(h!==""?"+"+h:"");break;case"message":e.data!==""&&(l=e.data);break;case"event":var p={name:e.name};e.args&&e.args.length&&(p.args=e.args),l=o.stringify(p);break;case"json":l=o.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+o.stringify(e.args):"")}var d=[t,n+(f=="data"?"+":""),a];return l!==null&&l!==undefined&&d.push(l),d.join(":")},n.encodePayload=function(e){var t="";if(e.length==1)return e[0];for(var n=0,r=e.length;n<r;n++){var i=e[n];t+="�"+i.length+"�"+e[n]}return t};var a=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){var t=e.match(a);if(!t)return{};var n=t[2]||"",e=t[5]||"",u={type:r[t[1]],endpoint:t[4]||""};n&&(u.id=n,t[3]?u.ack="data":u.ack=!0);switch(u.type){case"error":var t=e.split("+");u.reason=i[t[0]]||"",u.advice=s[t[1]]||"";break;case"message":u.data=e||"";break;case"event":try{var f=o.parse(e);u.name=f.name,u.args=f.args}catch(l){}u.args=u.args||[];break;case"json":try{u.data=o.parse(e)}catch(l){}break;case"connect":u.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t){u.ackId=t[1],u.args=[];if(t[3])try{u.args=t[3]?o.parse(t[3]):[]}catch(l){}}break;case"disconnect":case"heartbeat":}return u},n.decodePayload=function(e){if(e.charAt(0)=="�"){var t=[];for(var r=1,i="";r<e.length;r++)e.charAt(r)=="�"?(t.push(n.decodePacket(e.substr(r+1).substr(0,i))),r+=Number(i)+1,i=""):i+=e.charAt(r);return t}return[n.decodePacket(e)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.heartbeats=function(){return!0},n.prototype.onData=function(e){this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout();if(e!==""){var n=t.parser.decodePayload(e);if(n&&n.length)for(var r=0,i=n.length;r<i;r++)this.onPacket(n[r])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),e.type=="heartbeat"?this.onHeartbeat():(e.type=="connect"&&e.endpoint==""&&this.onConnect(),e.type=="error"&&e.advice=="reconnect"&&(this.isOpen=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){var e=this;this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(e){this.options={port:80,secure:!1,document:"document"in n?document:!1,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(n,"beforeunload",function(){r.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=r,t.util.mixin(r,t.EventEmitter),r.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),e!==""&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},r.prototype.publish=function(){this.emit.apply(this,arguments);var e;for(var t in this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t),e.$emit.apply(e,arguments))},r.prototype.handshake=function(e){function s(t){t instanceof Error?(n.connecting=!1,n.onError(t.message)):e.apply(null,t.split(":"))}var n=this,r=this.options,o=["http"+(r.secure?"s":"")+":/",r.host+":"+r.port,r.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var u=document.getElementsByTagName("script")[0],a=document.createElement("script");a.src=o+"&jsonp="+t.j.length,u.parentNode.insertBefore(a,u),t.j.push(function(e){s(e),a.parentNode.removeChild(a)})}else{var f=t.util.request();f.open("GET",o,!0),this.isXDomain()&&(f.withCredentials=!0),f.onreadystatechange=function(){f.readyState==4&&(f.onreadystatechange=i,f.status==200?s(f.responseText):f.status==403?n.onError(f.responseText):(n.connecting=!1,!n.reconnecting&&n.onError(f.responseText)))},f.send(null)}},r.prototype.getTransport=function(e){var n=e||this.transports,r;for(var i=0,s;s=n[i];i++)if(t.Transport[s]&&t.Transport[s].check(this)&&(!this.isXDomain()||t.Transport[s].xdomainCheck(this)))return new t.Transport[s](this,this.sessionid);return null},r.prototype.connect=function(e){if(this.connecting)return this;var n=this;return n.connecting=!0,this.handshake(function(r,i,s,o){function u(e){n.transport&&n.transport.clearTimeouts(),n.transport=n.getTransport(e);if(!n.transport)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected){n.connecting=!1;if(n.options["try multiple transports"]){var e=n.transports;while(e.length>0&&e.splice(0,1)[0]!=n.transport.name);e.length?u(e):n.publish("connect_failed")}}},n.options["connect timeout"]))})}n.sessionid=r,n.closeTimeout=s*1e3,n.heartbeatTimeout=i*1e3,n.transports||(n.transports=n.origTransports=o?t.util.intersect(o.split(","),n.options.transports):n.options.transports),n.setHeartbeatTimeout(),u(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&typeof e=="function"&&e()})}),this},r.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);if(this.transport&&!this.transport.heartbeats())return;var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},r.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},r.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},r.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},r.prototype.disconnect=function(){if(this.connected||this.connecting)this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted");return this},r.prototype.disconnectSync=function(){var e=t.util.request(),n=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",n,!1),e.send(null),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},r.prototype.onOpen=function(){this.open=!0},r.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},r.prototype.onError=function(e){e&&e.advice&&e.advice==="reconnect"&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},r.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1;if(t||n)this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect())},r.prototype.reconnect=function(){function i(){if(e.connected){for(var t in e.namespaces)e.namespaces.hasOwnProperty(t)&&""!==t&&e.namespaces[t].packet({type:"connect"});e.publish("reconnect",e.transport.name,e.reconnectionAttempts)}clearTimeout(e.reconnectionTimer),e.removeListener("connect_failed",s),e.removeListener("connect",s),e.reconnecting=!1,delete e.reconnectionAttempts,delete e.reconnectionDelay,delete e.reconnectionTimer,delete e.redoTransports,e.options["try multiple transports"]=n}function s(){if(!e.reconnecting)return;if(e.connected)return i();if(e.connecting&&e.reconnecting)return e.reconnectionTimer=setTimeout(s,1e3);e.reconnectionAttempts++>=t?e.redoTransports?(e.publish("reconnect_failed"),i()):(e.on("connect_failed",s),e.options["try multiple transports"]=!0,e.transports=e.origTransports,e.transport=e.getTransport(),e.redoTransports=!0,e.connect()):(e.reconnectionDelay<r&&(e.reconnectionDelay*=2),e.connect(),e.publish("reconnecting",e.reconnectionDelay,e.reconnectionAttempts),e.reconnectionTimer=setTimeout(s,e.reconnectionDelay))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var e=this,t=this.options["max reconnection attempts"],n=this.options["try multiple transports"],r=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(s,this.reconnectionDelay),this.on("connect",s)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};return"function"==typeof n&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=n,t=t.slice(0,t.length-1)),r.args=t,this.packet(r)},n.prototype.disconnect=function(){return this.name===""?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function r(){n.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var n=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":this.name===""?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var i=["message",e.data];e.ack=="data"?i.push(r):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,i);break;case"event":var i=[e.name].concat(e.args);e.ack=="data"&&i.push(r),this.$emit.apply(this,i);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):e.reason=="unauthorized"?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(e){t.Transport.apply(this,arguments)}e.websocket=r,t.util.inherit(r,t.Transport),r.prototype.name="websocket",r.prototype.open=function(){var e=t.util.query(this.socket.options.query),r=this,i;return i||(i=n.MozWebSocket||n.WebSocket),this.websocket=new i(this.prepareUrl()+e),this.websocket.onopen=function(){r.onOpen(),r.socket.setBuffer(!1)},this.websocket.onmessage=function(e){r.onData(e.data)},this.websocket.onclose=function(){r.onClose(),r.socket.setBuffer(!0)},this.websocket.onerror=function(e){r.onError(e)},this},t.util.ua.iDevice?r.prototype.send=function(e){var t=this;return setTimeout(function(){t.websocket.send(e)},0),this}:r.prototype.send=function(e){return this.websocket.send(e),this},r.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(e){this.socket.onError(e)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},r.xdomainCheck=function(){return!0},t.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(){t.Transport.websocket.apply(this,arguments)}e.flashsocket=n,t.util.inherit(n,t.Transport.websocket),n.prototype.name="flashsocket",n.prototype.open=function(){var e=this,n=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.open.apply(e,n)}),this},n.prototype.send=function(){var e=this,n=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.send.apply(e,n)}),this},n.prototype.close=function(){return WebSocket.__tasks.length=0,t.Transport.websocket.prototype.close.call(this),this},n.prototype.ready=function(e,r){function i(){var t=e.options,i=t["flash policy port"],o=["http"+(t.secure?"s":"")+":/",t.host+":"+t.port,t.resource,"static/flashsocket","WebSocketMain"+(e.isXDomain()?"Insecure":"")+".swf"];n.loaded||(typeof WEB_SOCKET_SWF_LOCATION=="undefined"&&(WEB_SOCKET_SWF_LOCATION=o.join("/")),i!==843&&WebSocket.loadFlashPolicyFile("xmlsocket://"+t.host+":"+i),WebSocket.__initialize(),n.loaded=!0),r.call(s)}var s=this;if(document.body)return i();t.util.load(i)},n.check=function(){return typeof WebSocket!="undefined"&&"__initialize"in WebSocket&&!!swfobject?swfobject.getFlashPlayerVersion().major>=10:!1},n.xdomainCheck=function(){return!0},typeof window!="undefined"&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0),t.transports.push("flashsocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);if("undefined"!=typeof window)var swfobject=function(){function C(){if(b)return;try{var e=a.getElementsByTagName("body")[0].appendChild(U("span"));e.parentNode.removeChild(e)}catch(t){return}b=!0;var n=c.length;for(var r=0;r<n;r++)c[r]()}function k(e){b?e():c[c.length]=e}function L(t){if(typeof u.addEventListener!=e)u.addEventListener("load",t,!1);else if(typeof a.addEventListener!=e)a.addEventListener("load",t,!1);else if(typeof u.attachEvent!=e)z(u,"onload",t);else if(typeof u.onload=="function"){var n=u.onload;u.onload=function(){n(),t()}}else u.onload=t}function A(){l?O():M()}function O(){var n=a.getElementsByTagName("body")[0],r=U(t);r.setAttribute("type",i);var s=n.appendChild(r);if(s){var o=0;(function(){if(typeof s.GetVariable!=e){var t=s.GetVariable("$version");t&&(t=t.split(" ")[1].split(","),T.pv=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)])}else if(o<10){o++,setTimeout(arguments.callee,10);return}n.removeChild(r),s=null,M()})()}else M()}function M(){var t=h.length;if(t>0)for(var n=0;n<t;n++){var r=h[n].id,i=h[n].callbackFn,s={success:!1,id:r};if(T.pv[0]>0){var o=R(r);if(o)if(W(h[n].swfVersion)&&!(T.wk&&T.wk<312))V(r,!0),i&&(s.success=!0,s.ref=_(r),i(s));else if(h[n].expressInstall&&D()){var u={};u.data=h[n].expressInstall,u.width=o.getAttribute("width")||"0",u.height=o.getAttribute("height")||"0",o.getAttribute("class")&&(u.styleclass=o.getAttribute("class")),o.getAttribute("align")&&(u.align=o.getAttribute("align"));var a={},f=o.getElementsByTagName("param"),l=f.length;for(var c=0;c<l;c++)f[c].getAttribute("name").toLowerCase()!="movie"&&(a[f[c].getAttribute("name")]=f[c].getAttribute("value"));P(u,a,r,i)}else H(o),i&&i(s)}else{V(r,!0);if(i){var p=_(r);p&&typeof p.SetVariable!=e&&(s.success=!0,s.ref=p),i(s)}}}}function _(n){var r=null,i=R(n);if(i&&i.nodeName=="OBJECT")if(typeof i.SetVariable!=e)r=i;else{var s=i.getElementsByTagName(t)[0];s&&(r=s)}return r}function D(){return!w&&W("6.0.65")&&(T.win||T.mac)&&!(T.wk&&T.wk<312)}function P(t,n,r,i){w=!0,g=i||null,y={success:!1,id:r};var o=R(r);if(o){o.nodeName=="OBJECT"?(v=B(o),m=null):(v=o,m=r),t.id=s;if(typeof t.width==e||!/%$/.test(t.width)&&parseInt(t.width,10)<310)t.width="310";if(typeof t.height==e||!/%$/.test(t.height)&&parseInt(t.height,10)<137)t.height="137";a.title=a.title.slice(0,47)+" - Flash Player Installation";var f=T.ie&&T.win?["Active"].concat("").join("X"):"PlugIn",l="MMredirectURL="+u.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+a.title;typeof n.flashvars!=e?n.flashvars+="&"+l:n.flashvars=l;if(T.ie&&T.win&&o.readyState!=4){var c=U("div");r+="SWFObjectNew",c.setAttribute("id",r),o.parentNode.insertBefore(c,o),o.style.display="none",function(){o.readyState==4?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)}()}j(t,n,r)}}function H(e){if(T.ie&&T.win&&e.readyState!=4){var t=U("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(B(e),t),e.style.display="none",function(){e.readyState==4?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(B(e),e)}function B(e){var n=U("div");if(T.win&&T.ie)n.innerHTML=e.innerHTML;else{var r=e.getElementsByTagName(t)[0];if(r){var i=r.childNodes;if(i){var s=i.length;for(var o=0;o<s;o++)(i[o].nodeType!=1||i[o].nodeName!="PARAM")&&i[o].nodeType!=8&&n.appendChild(i[o].cloneNode(!0))}}}return n}function j(n,r,s){var o,u=R(s);if(T.wk&&T.wk<312)return o;if(u){typeof n.id==e&&(n.id=s);if(T.ie&&T.win){var a="";for(var f in n)n[f]!=Object.prototype[f]&&(f.toLowerCase()=="data"?r.movie=n[f]:f.toLowerCase()=="styleclass"?a+=' class="'+n[f]+'"':f.toLowerCase()!="classid"&&(a+=" "+f+'="'+n[f]+'"'));var l="";for(var c in r)r[c]!=Object.prototype[c]&&(l+='<param name="'+c+'" value="'+r[c]+'" />');u.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+l+"</object>",p[p.length]=n.id,o=R(n.id)}else{var h=U(t);h.setAttribute("type",i);for(var d in n)n[d]!=Object.prototype[d]&&(d.toLowerCase()=="styleclass"?h.setAttribute("class",n[d]):d.toLowerCase()!="classid"&&h.setAttribute(d,n[d]));for(var v in r)r[v]!=Object.prototype[v]&&v.toLowerCase()!="movie"&&F(h,v,r[v]);u.parentNode.replaceChild(h,u),o=h}}return o}function F(e,t,n){var r=U("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)}function I(e){var t=R(e);t&&t.nodeName=="OBJECT"&&(T.ie&&T.win?(t.style.display="none",function(){t.readyState==4?q(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function q(e){var t=R(e);if(t){for(var n in t)typeof t[n]=="function"&&(t[n]=null);t.parentNode.removeChild(t)}}function R(e){var t=null;try{t=a.getElementById(e)}catch(n){}return t}function U(e){return a.createElement(e)}function z(e,t,n){e.attachEvent(t,n),d[d.length]=[e,t,n]}function W(e){var t=T.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function X(n,r,i,s){if(T.ie&&T.mac)return;var o=a.getElementsByTagName("head")[0];if(!o)return;var u=i&&typeof i=="string"?i:"screen";s&&(E=null,S=null);if(!E||S!=u){var f=U("style");f.setAttribute("type","text/css"),f.setAttribute("media",u),E=o.appendChild(f),T.ie&&T.win&&typeof a.styleSheets!=e&&a.styleSheets.length>0&&(E=a.styleSheets[a.styleSheets.length-1]),S=u}T.ie&&T.win?E&&typeof E.addRule==t&&E.addRule(n,r):E&&typeof a.createTextNode!=e&&E.appendChild(a.createTextNode(n+" {"+r+"}"))}function V(e,t){if(!x)return;var n=t?"visible":"hidden";b&&R(e)?R(e).style.visibility=n:X("#"+e,"visibility:"+n)
}function $(t){var n=/[\\\"<>\.;]/,r=n.exec(t)!=null;return r&&typeof encodeURIComponent!=e?encodeURIComponent(t):t}var e="undefined",t="object",n="Shockwave Flash",r="ShockwaveFlash.ShockwaveFlash",i="application/x-shockwave-flash",s="SWFObjectExprInst",o="onreadystatechange",u=window,a=document,f=navigator,l=!1,c=[A],h=[],p=[],d=[],v,m,g,y,b=!1,w=!1,E,S,x=!0,T=function(){var s=typeof a.getElementById!=e&&typeof a.getElementsByTagName!=e&&typeof a.createElement!=e,o=f.userAgent.toLowerCase(),c=f.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(o),p=c?/mac/.test(c):/mac/.test(o),d=/webkit/.test(o)?parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,v=!1,m=[0,0,0],g=null;if(typeof f.plugins!=e&&typeof f.plugins[n]==t)g=f.plugins[n].description,g&&(typeof f.mimeTypes==e||!f.mimeTypes[i]||!!f.mimeTypes[i].enabledPlugin)&&(l=!0,v=!1,g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),m[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10),m[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10),m[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof u[["Active"].concat("Object").join("X")]!=e)try{var y=new(window[["Active"].concat("Object").join("X")])(r);y&&(g=y.GetVariable("$version"),g&&(v=!0,g=g.split(" ")[1].split(","),m=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]))}catch(b){}return{w3:s,pv:m,wk:d,ie:v,win:h,mac:p}}(),N=function(){if(!T.w3)return;(typeof a.readyState!=e&&a.readyState=="complete"||typeof a.readyState==e&&(a.getElementsByTagName("body")[0]||a.body))&&C(),b||(typeof a.addEventListener!=e&&a.addEventListener("DOMContentLoaded",C,!1),T.ie&&T.win&&(a.attachEvent(o,function(){a.readyState=="complete"&&(a.detachEvent(o,arguments.callee),C())}),u==top&&function(){if(b)return;try{a.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}C()}()),T.wk&&function(){if(b)return;if(!/loaded|complete/.test(a.readyState)){setTimeout(arguments.callee,0);return}C()}(),L(C))}(),J=function(){T.ie&&T.win&&window.attachEvent("onunload",function(){var e=d.length;for(var t=0;t<e;t++)d[t][0].detachEvent(d[t][1],d[t][2]);var n=p.length;for(var r=0;r<n;r++)I(p[r]);for(var i in T)T[i]=null;T=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}();return{registerObject:function(e,t,n,r){if(T.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=n,i.callbackFn=r,h[h.length]=i,V(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){if(T.w3)return _(e)},embedSWF:function(n,r,i,s,o,u,a,f,l,c){var h={success:!1,id:r};T.w3&&!(T.wk&&T.wk<312)&&n&&r&&i&&s&&o?(V(r,!1),k(function(){i+="",s+="";var p={};if(l&&typeof l===t)for(var d in l)p[d]=l[d];p.data=n,p.width=i,p.height=s;var v={};if(f&&typeof f===t)for(var m in f)v[m]=f[m];if(a&&typeof a===t)for(var g in a)typeof v.flashvars!=e?v.flashvars+="&"+g+"="+a[g]:v.flashvars=g+"="+a[g];if(W(o)){var y=j(p,v,r);p.id==r&&V(r,!0),h.success=!0,h.ref=y}else{if(u&&D()){p.data=u,P(p,v,r,c);return}V(r,!0)}c&&c(h)})):c&&c(h)},switchOffAutoHideShow:function(){x=!1},ua:T,getFlashPlayerVersion:function(){return{major:T.pv[0],minor:T.pv[1],release:T.pv[2]}},hasFlashPlayerVersion:W,createSWF:function(e,t,n){return T.w3?j(e,t,n):undefined},showExpressInstall:function(e,t,n,r){T.w3&&D()&&P(e,t,n,r)},removeSWF:function(e){T.w3&&I(e)},createCSS:function(e,t,n,r){T.w3&&X(e,t,n,r)},addDomLoadEvent:k,addLoadEvent:L,getQueryParamValue:function(e){var t=a.location.search||a.location.hash;if(t){/\?/.test(t)&&(t=t.split("?")[1]);if(e==null)return $(t);var n=t.split("&");for(var r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return $(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(w){var e=R(s);e&&v&&(e.parentNode.replaceChild(v,e),m&&(V(m,!0),T.ie&&T.win&&(v.style.display="block")),g&&g(y)),w=!1}}}}();(function(){if("undefined"==typeof window||window.WebSocket)return;var e=window.console;if(!e||!e.log||!e.error)e={log:function(){},error:function(){}};if(!swfobject.hasFlashPlayerVersion("10.0.0")){e.error("Flash Player >= 10.0.0 is required.");return}location.protocol=="file:"&&e.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(e,t,n,r,i){var s=this;s.__id=WebSocket.__nextId++,WebSocket.__instances[s.__id]=s,s.readyState=WebSocket.CONNECTING,s.bufferedAmount=0,s.__events={},t?typeof t=="string"&&(t=[t]):t=[],setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(s.__id,e,t,n||null,r||0,i||null)})},0)},WebSocket.prototype.send=function(e){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var t=WebSocket.__flash.send(this.__id,encodeURIComponent(e));return t<0?!0:(this.bufferedAmount+=t,!1)},WebSocket.prototype.close=function(){if(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING)return;this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id)},WebSocket.prototype.addEventListener=function(e,t,n){e in this.__events||(this.__events[e]=[]),this.__events[e].push(t)},WebSocket.prototype.removeEventListener=function(e,t,n){if(!(e in this.__events))return;var r=this.__events[e];for(var i=r.length-1;i>=0;--i)if(r[i]===t){r.splice(i,1);break}},WebSocket.prototype.dispatchEvent=function(e){var t=this.__events[e.type]||[];for(var n=0;n<t.length;++n)t[n](e);var r=this["on"+e.type];r&&r(e)},WebSocket.prototype.__handleEvent=function(e){"readyState"in e&&(this.readyState=e.readyState),"protocol"in e&&(this.protocol=e.protocol);var t;if(e.type=="open"||e.type=="error")t=this.__createSimpleEvent(e.type);else if(e.type=="close")t=this.__createSimpleEvent("close");else{if(e.type!="message")throw"unknown event type: "+e.type;var n=decodeURIComponent(e.message);t=this.__createMessageEvent("message",n)}this.dispatchEvent(t)},WebSocket.prototype.__createSimpleEvent=function(e){if(document.createEvent&&window.Event){var t=document.createEvent("Event");return t.initEvent(e,!1,!1),t}return{type:e,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(e,t){if(document.createEvent&&window.MessageEvent&&!window.opera){var n=document.createEvent("MessageEvent");return n.initMessageEvent("message",!1,!1,t,null,null,window,null),n}return{type:e,data:t,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(e){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(e)})},WebSocket.__initialize=function(){if(WebSocket.__flash)return;WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation);if(!window.WEB_SOCKET_SWF_LOCATION){e.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");return}var t=document.createElement("div");t.id="webSocketContainer",t.style.position="absolute",WebSocket.__isFlashLite()?(t.style.left="0px",t.style.top="0px"):(t.style.left="-100px",t.style.top="-100px");var n=document.createElement("div");n.id="webSocketFlash",t.appendChild(n),document.body.appendChild(t),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(t){t.success||e.error("[WebSocket] swfobject.embedSWF failed")})},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var e=0;e<WebSocket.__tasks.length;++e)WebSocket.__tasks[e]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{var t=WebSocket.__flash.receiveEvents();for(var n=0;n<t.length;++n)WebSocket.__instances[t[n].webSocketId].__handleEvent(t[n])}catch(r){e.error(r)}},0),!0},WebSocket.__log=function(t){e.log(decodeURIComponent(t))},WebSocket.__error=function(t){e.error(decodeURIComponent(t))},WebSocket.__addTask=function(e){WebSocket.__flash?e():WebSocket.__tasks.push(e)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var e=window.navigator.mimeTypes["application/x-shockwave-flash"];return!e||!e.enabledPlugin||!e.enabledPlugin.filename?!1:e.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))})(),function(e,t,n){function r(e){if(!e)return;t.Transport.apply(this,arguments),this.sendBuffer=[]}function i(){}e.XHR=r,t.util.inherit(r,t.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(e){var n=[];for(var r=0,i=e.length;r<i;r++)n.push(t.parser.encodePacket(e[r]));this.send(t.parser.encodePayload(n))},r.prototype.send=function(e){return this.post(e),this},r.prototype.post=function(e){function r(){this.readyState==4&&(this.onreadystatechange=i,t.posting=!1,this.status==200?t.socket.setBuffer(!1):t.onClose())}function s(){this.onload=i,t.socket.setBuffer(!1)}var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=s:this.sendXHR.onreadystatechange=r,this.sendXHR.send(e)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +new Date);n.open(e||"GET",this.prepareUrl()+r,!0);if(e=="POST")try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(i){}return n},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(e,r){try{var i=t.util.request(r),s=n.XDomainRequest&&i instanceof XDomainRequest,o=e&&e.options&&e.options.secure?"https:":"http:",u=n.location&&o!=n.location.protocol;if(i&&(!s||!u))return!0}catch(a){}return!1},r.xdomainCheck=function(e){return r.check(e,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(e){t.Transport.XHR.apply(this,arguments)}e.htmlfile=n,t.util.inherit(n,t.Transport.XHR),n.prototype.name="htmlfile",n.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var e=this.doc.createElement("div");e.className="socketio",this.doc.body.appendChild(e),this.iframe=this.doc.createElement("iframe"),e.appendChild(this.iframe);var n=this,r=t.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+r,t.util.on(window,"unload",function(){n.destroy()})},n.prototype._=function(e,t){e=e.replace(/\\\//g,"/"),this.onData(e);try{var n=t.getElementsByTagName("script")[0];n.parentNode.removeChild(n)}catch(r){}},n.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},n.prototype.close=function(){return this.destroy(),t.Transport.XHR.prototype.close.call(this)},n.check=function(e){if(typeof window!="undefined"&&["Active"].concat("Object").join("X")in window)try{var n=new(window[["Active"].concat("Object").join("X")])("htmlfile");return n&&t.Transport.XHR.check(e)}catch(r){}return!1},n.xdomainCheck=function(){return!1},t.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=r,t.util.inherit(r,t.Transport.XHR),t.util.merge(r,t.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.heartbeats=function(){return!1},r.prototype.open=function(){var e=this;return t.Transport.XHR.prototype.open.call(e),!1},r.prototype.get=function(){function t(){this.readyState==4&&(this.onreadystatechange=i,this.status==200?(e.onData(this.responseText),e.get()):e.onClose())}function r(){this.onload=i,this.onerror=i,e.retryCounter=1,e.onData(this.responseText),e.get()}function s(){e.retryCounter++,!e.retryCounter||e.retryCounter>3?e.onClose():e.get()}if(!this.isOpen)return;var e=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=r,this.xhr.onerror=s):this.xhr.onreadystatechange=t,this.xhr.send(null)},r.prototype.onClose=function(){t.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},r.prototype.ready=function(e,n){var r=this;t.util.defer(function(){n.call(r)})},t.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t,n){function i(e){t.Transport["xhr-polling"].apply(this,arguments),this.index=t.j.length;var n=this;t.j.push(function(e){n._(e)})}var r=n.document&&"MozAppearance"in n.document.documentElement.style;e["jsonp-polling"]=i,t.util.inherit(i,t.Transport["xhr-polling"]),i.prototype.name="jsonp-polling",i.prototype.post=function(e){function a(){f(),n.socket.setBuffer(!1)}function f(){n.iframe&&n.form.removeChild(n.iframe);try{u=document.createElement('<iframe name="'+n.iframeId+'">')}catch(e){u=document.createElement("iframe"),u.name=n.iframeId}u.id=n.iframeId,n.form.appendChild(u),n.iframe=u}var n=this,r=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var i=document.createElement("form"),s=document.createElement("textarea"),o=this.iframeId="socketio_iframe_"+this.index,u;i.className="socketio",i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.style.display="none",i.target=o,i.method="POST",i.setAttribute("accept-charset","utf-8"),s.name="d",i.appendChild(s),document.body.appendChild(i),this.form=i,this.area=s}this.form.action=this.prepareUrl()+r,f(),this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(l){}this.iframe.attachEvent?u.onreadystatechange=function(){n.iframe.readyState=="complete"&&a()}:this.iframe.onload=a,this.socket.setBuffer(!0)},i.prototype.get=function(){var e=this,n=document.createElement("script"),i=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),n.async=!0,n.src=this.prepareUrl()+i,n.onerror=function(){e.onClose()};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(n,s),this.script=n,r&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},i.prototype._=function(e){return this.onData(e),this.isOpen&&this.get(),this},i.prototype.ready=function(e,n){var i=this;if(!r)return n.call(this);t.util.load(function(){n.call(i)})},i.check=function(){return"document"in n},i.xdomainCheck=function(){return!0},t.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),typeof define=="function"&&define.amd&&define("io",[],function(){return io})})(),define("pubsub",["ext/underscore","jquery","lib/json2","app-context","io"],function(e,t,n,r,i){var s={},o=function(i,o){s[i]?o(s[i]):t.ajax({url:r.fullUrl("/v2/messages/"+i+"/participants"),success:function(t){e.assert(t.length==1,"only 1 participant expected");var n=t[0].id.split(":");e.assert(n[1]=="group","not a group participant: "+n[1]),s[i]=n[3],o(s[i])},error:function(e,t,i){console.log(n.stringify(e)),console.log(n.stringify(t)),console.log(n.stringify(i)),r.navigate("#error",!0)}})},u=function(n){console.log("creating socket ..");var s=i.connect(r.resolvePubsubEndPoint()+"?auth_type=token&token="+n.access_token+"&subscribe=chat");return s.on("connect",function(){setInterval(function(){s.emit("ping")},3e4)}),s.on("buddies",function(n,r){var i=t(".receiver-"+n);e.each(r,function(e){i.trigger("buddy",e)})}),s.on("chat-message",function(e){var n=t(".receiver-"+e.conversation);n.length==1?n.trigger("chatmsg",e):e.type=="text"&&o(e.conversation,function(e){r.addNotification("#messages/groups:@"+e)})}),s.on("unread",function(t){e.each(t,function(e){o(e.id,function(e){r.addNotification("#messages/groups:@"+e)})})}),s},a=null,f=r.getAccessToken();return f&&(a=u(f)),r.on("accessToken",function(){a&&(a.removeAllListeners("unread"),a.removeAllListeners("chat-message"),a.removeAllListeners("buddies"),a.removeAllListeners("connect")),a=u(r.getAccessToken())}),{emit:function(e,t){if(!a)throw"no socket available";a.emit(e,t)}}}),define("api/model/message",["ext/underscore","moment","api/model/base"],function(e,t,n){return n.extend({initialize:function(e,t){this.principle=t.principle,this.created=new Date},getSourceId:function(){var e=this.get("source");return e?e.id.split(":")[3]:this.principle.id},getSourceName:function(){var e=this.get("source");return e?e.name:this.principle.name},getDateReceived:function(){var e=t(this.get("dateReceived"));return e?new Date(t(e,"YYYY-MM-DDTHH:mm:ss.SSSZ").valueOf()):this.created},isType:function(){return this.get("type")=="type"},isTyping:function(){return e.assert(this.isType(),"not a type message"),this.get("body")=="yes"},noThumb:function(){var t=e.find(this.get("properties"),function(e){return e=="nothumb"});return!!t}})}),define("api/collection/messages",["api/collection/base","api/model/message"],function(e,t){return e.extend({model:t,initialize:function(e,t){t.current?(this.conversation=t.current.conversation,t.current.offset?this.params={offset:t.current.offset}:t.current.length>0&&(this.params={"condition.offset":t.current.length})):this.conversation=t.conversation},url:function(){return"/v2/messages/"+this.conversation.id+"/history"},parse:function(e){return e instanceof Array?(this.more=e.length>0,e):(this.offset=e.offset,this.more=e.more,e.items)},addPage:function(e){this.add(e.models),this.offset=e.offset,this.more=e.more},comparator:function(e){return-e.getDateReceived().getTime()}})}),define("text!text/message/item.html",[],function(){return'\n<% if (noThumb()) { %>\n	<img src="<%= appurl %>/styles/images/default_thumbnail.png">\n<% } else { %>\n	<img src="<%= cdn %>/users/<%= getSourceId() %>/thumbnail">\n<% } %>\n<div class="info <% if (getSourceId() == me.id) { print(\'self\') } %>">\n	<p>\n		<strong class="name"><%= getSourceName() %></strong>\n		<abbr data-time="<%= getDateReceived().getTime() %>" class="timeago">\n			<%= $.timeago(getDateReceived()) %>\n		</abbr>\n	</p>\n	<p class="body"><%= get(\'body\') %></p>\n</div>	\n'}),define("view/message/item",["ext/underscore","jquery","app-context","view/base","text!text/message/item.html"],function(e,t,n,r,i){return r.extend({tagName:"li",events:{"click div.self":"update"},initialize:function(t){e.bindToMethods(this),this.options=t,this.model.on("change",this.change)},render:function(){var t=e.extend({cdn:n.cdn,me:n.getPrinciple()},this.model);return this.$el.html(this.template(i,t)),this},change:function(){t(".body",this.$el).html(this.model.get("body"))},update:function(){this.options.inputView.update(this.model)}})}),define("text!text/message/input.html",[],function(){return'<textarea placeholder="<%= m_message_placeholder %>"></textarea>\n<a href="javascript:void(0)" class="send hidden">\n	<span class="glyphicon glyphicon-send"></span>\n</a>\n<div class="update-btns hidden">\n	<a href="javascript:void(0)" class="update">\n		<span class="glyphicon glyphicon-ok"></span>\n	</a>\n	<a href="javascript:void(0)" class="cancel">\n		<span class="glyphicon glyphicon-remove"></span>\n	</a>\n</div>\n'}),define("view/message/input",["ext/underscore","jquery","view/base","app-context","pubsub","text!text/message/input.html"],function(e,t,n,r,i,s){return n.extend({back:{code:"m_btn_context",link:"#context"},className:"messages-input",events:{"keyup textarea":"keyup","click .send,.update":"send","click .cancel":"cancel"},initialize:function(t){e.bindToMethods(this),this.options=t},render:function(){return this.$el.html(this.template(s)),this.$input=t("textarea",this.$el),this.$send=t(".send",this.$el),this},keyup:function(){e.trim(this.$input.val()).length==0?this.target?this.cancel():(this.stopTyping,this.sendBtn(!1)):(this.typing||this.emitMessage("type","yes"),this.typing=!0,this.stopTyping_debounced(),this.target||this.sendBtn(!0))},send:function(){var t=e.trim(this.$input.val()).replace(/\n/gm,"<br/>");this.target?(this.emitMessage("update",t,this.target),this.cancel()):(this.emitMessage("text",t),this.$input.val(""),this.stopTyping(),this.sendBtn(!1))},cancel:function(){this.target=null,this.$input.val(""),this.updateBtns(!1),this.stopTyping()},emitMessage:function(e,n,s){var o=this.options.conversation.id,u={conversation:o,deliveryId:o+Math.random().toString(36).substr(2),body:n,type:e,properties:[]};typeof s!="undefined"&&(u.id=s.id,u.deliveryId=s.get("deliveryId")),r.getPrinciple().logo||u.properties.push("nothumb"),i.emit("chat-message",u),t(".receiver-"+o).trigger("chatmsg",u)},stopTyping:function(){this.emitMessage("type","no"),this.typing=!1},stopTyping_debounced:e.debounce(function(){this.stopTyping()},5e3),update:function(e){this.target=e,this.$input.val(e.get("body").replace(/<br ?\/>/g,"\n")).focus(),this.sendBtn(!1),this.updateBtns(!0)},updateBtns:function(e){var n=t(".update-btns",this.$el);e?(n.removeClass("hidden"),this.$input.width(this.$el.width()-65)):(n.addClass("hidden"),this.$input.css("width","100%"))},sendBtn:function(e){e?(this.$send.removeClass("hidden"),this.$input.width(this.$el.width()-40)):(this.$send.addClass("hidden"),this.$input.css("width","100%"))}})}),define("view/message/list",["ext/underscore","jquery","app-context","view/page","api/collection/messages","api/model/message","view/navbar-factory","view/message/item","view/message/input"],function(e,t,n,r,i,s,o,u,a){return r.extend({back:{code:"m_btn_context",link:"#context"},tagName:"ul",className:"messages list-unstyled",events:{buddy:"receiveBuddy",chatmsg:"receiveMessage"},initialize:function(t){r.prototype.initialize.apply(this,arguments),this.title=e.escape(this.collection.conversation.group.get("friendlyName")),this.timer=setInterval(this.updateTime,6e4)},render:function(){return r.prototype.render.apply(this,arguments),this.inputView=new a({conversation:this.collection.conversation}),this.addFooter(this.inputView.render().$el),this.$el.addClass("receiver-"+this.collection.conversation.id),this.$header=t("<div>").addClass("messages-header"),this.addHeader(this.$header),this.retrievePage(),this},receiveBuddy:function(e,r){var i=t(".user-"+r.user.id,this.$header);if(r.online&&i.length==0){var s=n.defaultThumb;r.user.logo&&(s=n.cdn+"/users/"+r.user.id+"/thumbnail"),t("<img>").addClass("user-"+r.user.id).attr("src",s).appendTo(this.$header)}else!r.online&&i.length>0&&i.remove()},receiveMessage:function(e,r){r=new s(r,{principle:n.getPrinciple()});if(r.isType())if(r.isTyping()){if(r.get("source")){var i=r.get("source").name+" typing..";t("<li>").addClass("typing").html(i).appendTo(this.$el)}}else t("li.typing",this.$el).remove();else{var o=this.collection.findWhere({deliveryId:r.get("deliveryId")});if(o)o.set("body",r.get("body"));else{var a=new u({model:r,inputView:this.inputView});this.$el.append(a.render().el),this.collection.add(r)}}this.scrollToEnd()},retrievePage:function(){var e=new i([],{current:this.collection});e.once("sync",this.renderPage),e.fetch()},renderPage:function(n){var r=t("li",this.$el).first();n.each(function(e){var t=new u({model:e,inputView:this.inputView});this.$el.prepend(t.render().el)},this),this.collection.length==0?this.scrollToEnd():this.scroll(r.position().top-1),n.more&&e.defer(e.bind(function(){t("li",this.$el).first().one("inview",this.retrievePage)},this)),this.collection.addPage(n)},scrollToEnd:function(){var e=t("li",this.$el).last();e.length>0&&this.scroll(e.position().top+e.height())},updateTime:function(){t("abbr.timeago",this.$el).each(function(){var e=t(this);e.html(t.timeago(new Date(e.data("time"))))})},remove:function(){r.prototype.remove.apply(this,arguments),clearInterval(this.timer),this.removeMarginal(this.$header),this.removeMarginal(this.inputView.$el)},navbar:function(e){this.navbarCreate("messages",this.collection.conversation.group.id,e)}}).extend(o)}),define("api/model/conversation",["api/model/base"],function(e){return e.extend({initialize:function(e,t){this.group=t.group},url:function(){return this.group.url()+"/conversation"}})}),define("router/message",["ext/underscore","jquery","lib/json2","router/group","app-context","pubsub","view/message/list","api/model/conversation","api/collection/messages"],function(e,t,n,r,i,s,o,u,a){var f=function(e){var r=new o({collection:new a([],{conversation:e})});r.render(),s.emit("buddies-notify",e.id),t.ajax({type:"POST",url:i.fullUrl("/v2/messages"),data:n.stringify({conversations:[e.id]}),error:function(){i.navigate("#error",!0)},contentType:"application/json"})};return r.extend({routes:{"messages/:groupKey":"getConversation"},getConversation:function(e){var t=new u({},{group:e});t.once("sync",f),t.fetch()}})}),jQuery(function(){requirejs.config({baseUrl:"app",paths:{io:"lib/socket.io","native":"../native",underscore:"lib/underscore-min","underscore.string":"lib/underscore.string",backbone:"lib/backbone",moment:"lib/moment.min"},shim:{"lib/iscroll":{exports:"iScroll"}}}),define("lib/json2",[],function(){return JSON}),define("jquery",[],function(){return jQuery}),require(["backbone","app-context","api/model/account","native","router/default","router/update","router/file","router/note","router/discussion","router/event","router/task","router/comment","router/message"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){new i,new s,new o,new u,new a,new f,new l,new c,new h,e.history.start({silent:!0}),r.resumeAt(function(e){console.log("initialising: "+e),t.navigate(e?e:"#updates/dashboard",!0)})})}),define("main",function(){});